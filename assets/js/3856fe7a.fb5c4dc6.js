"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[27928],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},55251:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"skills/bot_developer/references/moderation-system","title":"Moderation System","description":"Production moderation with escalation, decay, and auto-mod.","source":"@site/docs/skills/bot_developer/references/moderation-system.md","sourceDirName":"skills/bot_developer/references","slug":"/skills/bot_developer/references/moderation-system","permalink":"/docs/skills/bot_developer/references/moderation-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Moderation System","sidebar_label":"Moderation System","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Architecture Patterns","permalink":"/docs/skills/bot_developer/references/architecture-patterns"},"next":{"title":"Platform Templates","permalink":"/docs/skills/bot_developer/references/platform-templates"}}');var s=t(74848),r=t(28453);const o={title:"Moderation System",sidebar_label:"Moderation System",sidebar_position:2},d="Moderation System",a={},l=[{value:"Point-Based Moderation Service",id:"point-based-moderation-service",level:2},{value:"Escalation Thresholds",id:"escalation-thresholds",level:2},{value:"Auto-Mod Rules",id:"auto-mod-rules",level:2},{value:"Auto-Mod Rule Types",id:"auto-mod-rule-types",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"moderation-system",children:"Moderation System"})}),"\n",(0,s.jsx)(n.p,{children:"Production moderation with escalation, decay, and auto-mod."}),"\n",(0,s.jsx)(n.h2,{id:"point-based-moderation-service",children:"Point-Based Moderation Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from datetime import datetime, timedelta\nfrom enum import IntEnum\nfrom typing import Optional\nimport asyncpg\n\nclass ActionSeverity(IntEnum):\n    NOTE = 0        # Just a record, no action\n    WARNING = 1     # Formal warning\n    MUTE = 2        # Temporary mute\n    KICK = 3        # Remove from server\n    TEMP_BAN = 4    # Temporary ban\n    BAN = 5         # Permanent ban\n\nclass ModerationService:\n    """\n    Production moderation system with:\n    - Point-based escalation\n    - Automatic decay\n    - Appeal system\n    - Audit logging\n    """\n\n    POINT_CONFIG = {\n        ActionSeverity.NOTE: 0,\n        ActionSeverity.WARNING: 1,\n        ActionSeverity.MUTE: 2,\n        ActionSeverity.KICK: 3,\n        ActionSeverity.TEMP_BAN: 5,\n        ActionSeverity.BAN: 10,\n    }\n\n    DECAY_RATE = 0.1  # Points per day\n\n    def __init__(self, db: asyncpg.Pool):\n        self.db = db\n\n    async def add_infraction(\n        self,\n        guild_id: int,\n        user_id: int,\n        moderator_id: int,\n        action: ActionSeverity,\n        reason: str,\n        duration: Optional[timedelta] = None\n    ) -> dict:\n        """Record an infraction and return recommended action."""\n\n        # Get current points (with decay applied)\n        current_points = await self._get_user_points(guild_id, user_id)\n        new_points = current_points + self.POINT_CONFIG[action]\n\n        # Record infraction\n        infraction_id = await self.db.fetchval("""\n            INSERT INTO infractions (guild_id, user_id, moderator_id, action, reason, duration, points)\n            VALUES ($1, $2, $3, $4, $5, $6, $7)\n            RETURNING id\n        """, guild_id, user_id, moderator_id, action.value, reason, duration, self.POINT_CONFIG[action])\n\n        # Check escalation thresholds\n        recommended_action = self._get_recommended_action(new_points)\n\n        # Log to audit\n        await self._audit_log(guild_id, {\n            \'type\': \'INFRACTION_ADDED\',\n            \'infraction_id\': infraction_id,\n            \'user_id\': user_id,\n            \'action\': action.name,\n            \'new_total_points\': new_points,\n            \'recommended_escalation\': recommended_action.name if recommended_action else None\n        })\n\n        return {\n            \'infraction_id\': infraction_id,\n            \'current_points\': new_points,\n            \'recommended_action\': recommended_action,\n            \'history_count\': await self._get_infraction_count(guild_id, user_id)\n        }\n\n    async def _get_user_points(self, guild_id: int, user_id: int) -> float:\n        """Get current points with time decay applied."""\n        rows = await self.db.fetch("""\n            SELECT points, created_at FROM infractions\n            WHERE guild_id = $1 AND user_id = $2 AND pardoned = FALSE\n        """, guild_id, user_id)\n\n        total = 0.0\n        now = datetime.utcnow()\n\n        for row in rows:\n            age_days = (now - row[\'created_at\']).days\n            decayed_points = max(0, row[\'points\'] - (age_days * self.DECAY_RATE))\n            total += decayed_points\n\n        return total\n\n    def _get_recommended_action(self, points: float) -> Optional[ActionSeverity]:\n        """Get recommended escalation based on point total."""\n        if points >= 15:\n            return ActionSeverity.BAN\n        elif points >= 10:\n            return ActionSeverity.TEMP_BAN\n        elif points >= 6:\n            return ActionSeverity.KICK\n        elif points >= 3:\n            return ActionSeverity.MUTE\n        return None\n'})}),"\n",(0,s.jsx)(n.h2,{id:"escalation-thresholds",children:"Escalation Thresholds"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Points"}),(0,s.jsx)(n.th,{children:"Recommended Action"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0-2"}),(0,s.jsx)(n.td,{children:"No action"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3-5"}),(0,s.jsx)(n.td,{children:"Mute"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6-9"}),(0,s.jsx)(n.td,{children:"Kick"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10-14"}),(0,s.jsx)(n.td,{children:"Temp Ban"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"15+"}),(0,s.jsx)(n.td,{children:"Permanent Ban"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"auto-mod-rules",children:"Auto-Mod Rules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class AutoMod:\n    \"\"\"Automatic moderation with configurable rules.\"\"\"\n\n    def __init__(self, config: dict):\n        self.rules = config.get('rules', {})\n\n    async def check_message(self, message) -> list[dict]:\n        \"\"\"Check message against all rules, return violations.\"\"\"\n        violations = []\n\n        # Spam detection (message frequency)\n        if self.rules.get('spam_enabled'):\n            if await self._check_spam(message):\n                violations.append({\n                    'rule': 'spam',\n                    'action': self.rules['spam_action'],\n                    'reason': 'Message spam detected'\n                })\n\n        # Caps lock abuse\n        if self.rules.get('caps_enabled'):\n            caps_ratio = sum(1 for c in message.content if c.isupper()) / max(len(message.content), 1)\n            if caps_ratio > self.rules.get('caps_threshold', 0.7) and len(message.content) > 10:\n                violations.append({\n                    'rule': 'caps',\n                    'action': self.rules['caps_action'],\n                    'reason': 'Excessive caps lock'\n                })\n\n        # Link filtering\n        if self.rules.get('links_enabled'):\n            import re\n            urls = re.findall(r'https?://\\S+', message.content)\n            for url in urls:\n                if not any(allowed in url for allowed in self.rules.get('link_whitelist', [])):\n                    violations.append({\n                        'rule': 'links',\n                        'action': self.rules['links_action'],\n                        'reason': f'Unauthorized link: {url}'\n                    })\n\n        # Word filter (with Levenshtein for bypass attempts)\n        if self.rules.get('words_enabled'):\n            from rapidfuzz import fuzz\n            words = message.content.lower().split()\n            for word in words:\n                for banned in self.rules.get('banned_words', []):\n                    if fuzz.ratio(word, banned) > 85:  # Catches l33t speak, typos\n                        violations.append({\n                            'rule': 'banned_word',\n                            'action': self.rules['words_action'],\n                            'reason': 'Banned word detected'\n                        })\n                        break\n\n        return violations\n"})}),"\n",(0,s.jsx)(n.h2,{id:"auto-mod-rule-types",children:"Auto-Mod Rule Types"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Rule"}),(0,s.jsx)(n.th,{children:"Detection"}),(0,s.jsx)(n.th,{children:"Bypass Prevention"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Spam"})}),(0,s.jsx)(n.td,{children:"Message frequency tracking"}),(0,s.jsx)(n.td,{children:"Per-user sliding window"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Caps"})}),(0,s.jsx)(n.td,{children:"Character ratio analysis"}),(0,s.jsx)(n.td,{children:"Minimum length threshold"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Links"})}),(0,s.jsx)(n.td,{children:"URL regex extraction"}),(0,s.jsx)(n.td,{children:"Whitelist approved domains"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Words"})}),(0,s.jsx)(n.td,{children:"Dictionary matching"}),(0,s.jsx)(n.td,{children:"Levenshtein fuzzy matching (85%)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Mentions"})}),(0,s.jsx)(n.td,{children:"@mention counting"}),(0,s.jsx)(n.td,{children:"Role/user/everyone variants"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Invites"})}),(0,s.jsx)(n.td,{children:"Discord invite regex"}),(0,s.jsx)(n.td,{children:"Shortened URL expansion"})]})]})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);