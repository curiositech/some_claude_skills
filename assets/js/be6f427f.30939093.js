"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[44661],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>d});var r=s(96540);const t={},o=r.createContext(t);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:n},e.children)}},51470:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"skills/recovery_social_features/references/moderation","title":"Safety & Moderation","description":"Content moderation and user blocking patterns for recovery apps.","source":"@site/docs/skills/recovery_social_features/references/moderation.md","sourceDirName":"skills/recovery_social_features/references","slug":"/skills/recovery_social_features/references/moderation","permalink":"/docs/skills/recovery_social_features/references/moderation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Safety & Moderation","sidebar_label":"Safety & Moderation","sidebar_position":5}}');var t=s(74848),o=s(28453);const i={title:"Safety & Moderation",sidebar_label:"Safety & Moderation",sidebar_position:5},d="Safety & Moderation",a={},c=[{value:"Content Moderation Hook",id:"content-moderation-hook",level:2},{value:"User Blocking Hook",id:"user-blocking-hook",level:2},{value:"Moderation Categories",id:"moderation-categories",level:2},{value:"Blocking Behavior",id:"blocking-behavior",level:2},{value:"RLS Policy for Blocks",id:"rls-policy-for-blocks",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"safety--moderation",children:"Safety & Moderation"})}),"\n",(0,t.jsx)(n.p,{children:"Content moderation and user blocking patterns for recovery apps."}),"\n",(0,t.jsx)(n.h2,{id:"content-moderation-hook",children:"Content Moderation Hook"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// hooks/useContentModeration.ts\n'use client';\n\ninterface ModerationResult {\n  approved: boolean;\n  flags: string[];\n  crisisDetected: boolean;\n}\n\nexport function useContentModeration() {\n  const checkContent = async (content: string): Promise<ModerationResult> => {\n    const response = await fetch(\n      'https://your-moderation-worker.workers.dev',\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ content }),\n      }\n    );\n\n    return response.json();\n  };\n\n  return { checkContent };\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"user-blocking-hook",children:"User Blocking Hook"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// hooks/useBlocking.ts\n'use client';\n\nimport { supabase } from '@/lib/supabase';\n\nexport function useBlocking() {\n  const blockUser = async (userId: string) => {\n    const currentUser = (await supabase.auth.getUser()).data.user?.id;\n\n    // Create or update friendship to blocked\n    await supabase\n      .from('friendships')\n      .upsert({\n        requester_id: currentUser,\n        addressee_id: userId,\n        status: 'blocked',\n      });\n  };\n\n  const unblockUser = async (userId: string) => {\n    const currentUser = (await supabase.auth.getUser()).data.user?.id;\n\n    await supabase\n      .from('friendships')\n      .delete()\n      .eq('requester_id', currentUser)\n      .eq('addressee_id', userId)\n      .eq('status', 'blocked');\n  };\n\n  const isBlocked = async (userId: string): Promise<boolean> => {\n    const currentUser = (await supabase.auth.getUser()).data.user?.id;\n\n    const { data } = await supabase\n      .from('friendships')\n      .select('id')\n      .or(`\n        and(requester_id.eq.${currentUser},addressee_id.eq.${userId},status.eq.blocked),\n        and(requester_id.eq.${userId},addressee_id.eq.${currentUser},status.eq.blocked)\n      `)\n      .limit(1);\n\n    return (data?.length ?? 0) > 0;\n  };\n\n  return { blockUser, unblockUser, isBlocked };\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"moderation-categories",children:"Moderation Categories"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Category"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Action"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"crisis"})}),(0,t.jsx)(n.td,{children:"Suicidal ideation, self-harm"}),(0,t.jsx)(n.td,{children:"Show resources, don't block"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sourcing"})}),(0,t.jsx)(n.td,{children:"Drug seeking, dealing"}),(0,t.jsx)(n.td,{children:"Block + flag for review"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"harassment"})}),(0,t.jsx)(n.td,{children:"Personal attacks, threats"}),(0,t.jsx)(n.td,{children:"Block + flag for review"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spam"})}),(0,t.jsx)(n.td,{children:"Promotional content"}),(0,t.jsx)(n.td,{children:"Block"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"explicit"})}),(0,t.jsx)(n.td,{children:"Sexual/graphic content"}),(0,t.jsx)(n.td,{children:"Block"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"blocking-behavior",children:"Blocking Behavior"}),"\n",(0,t.jsx)(n.p,{children:"When a user blocks another:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Blocked user cannot send messages"}),"\n",(0,t.jsx)(n.li,{children:"Blocked user cannot see blocker's profile"}),"\n",(0,t.jsx)(n.li,{children:"Blocked user cannot see blocker in groups"}),"\n",(0,t.jsx)(n.li,{children:"Existing messages are hidden (not deleted)"}),"\n",(0,t.jsx)(n.li,{children:"Blocking is one-way (blocked user doesn't know)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"rls-policy-for-blocks",children:"RLS Policy for Blocks"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Hide content from blocked users\nCREATE POLICY \"Hide messages from blocked users\" ON messages\n  FOR SELECT USING (\n    NOT EXISTS (\n      SELECT 1 FROM friendships\n      WHERE status = 'blocked'\n      AND (\n        (requester_id = auth.uid() AND addressee_id = sender_id)\n        OR (addressee_id = auth.uid() AND requester_id = sender_id)\n      )\n    )\n  );\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);