"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[38892],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(96540);const o={},t=s.createContext(o);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},63340:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"skills/geospatial_data_pipeline/references/postgis-guide","title":"PostGIS Guide","description":"Complete guide to setting up PostGIS, creating spatial indexes, and writing efficient spatial queries.","source":"@site/docs/skills/geospatial_data_pipeline/references/postgis-guide.md","sourceDirName":"skills/geospatial_data_pipeline/references","slug":"/skills/geospatial_data_pipeline/references/postgis-guide","permalink":"/docs/skills/geospatial_data_pipeline/references/postgis-guide","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"PostGIS Guide","sidebar_label":"PostGIS Guide","sidebar_position":3}}');var o=i(74848),t=i(28453);const l={title:"PostGIS Guide",sidebar_label:"PostGIS Guide",sidebar_position:3},a="PostGIS Guide",r={},d=[{value:"Installation",id:"installation",level:2},{value:"macOS (Homebrew)",id:"macos-homebrew",level:3},{value:"Ubuntu/Debian",id:"ubuntudebian",level:3},{value:"Docker",id:"docker",level:3},{value:"Data Types",id:"data-types",level:2},{value:"GEOMETRY vs GEOGRAPHY",id:"geometry-vs-geography",level:3},{value:"Geometry Types",id:"geometry-types",level:2},{value:"Creating Spatial Data",id:"creating-spatial-data",level:2},{value:"From Lat/Lon",id:"from-latlon",level:3},{value:"From GeoJSON",id:"from-geojson",level:3},{value:"From WKT (Well-Known Text)",id:"from-wkt-well-known-text",level:3},{value:"Spatial Indexes",id:"spatial-indexes",level:2},{value:"GiST Index (Most Common)",id:"gist-index-most-common",level:3},{value:"SP-GiST Index (Space-Partitioning)",id:"sp-gist-index-space-partitioning",level:3},{value:"Common Spatial Queries",id:"common-spatial-queries",level:2},{value:"1. Find Nearby (Within Radius)",id:"1-find-nearby-within-radius",level:3},{value:"2. Calculate Distance",id:"2-calculate-distance",level:3},{value:"3. Point in Polygon",id:"3-point-in-polygon",level:3},{value:"4. Bounding Box Query",id:"4-bounding-box-query",level:3},{value:"5. Nearest Neighbor (kNN)",id:"5-nearest-neighbor-knn",level:3},{value:"6. Clustering (Group by Proximity)",id:"6-clustering-group-by-proximity",level:3},{value:"Output Formats",id:"output-formats",level:2},{value:"GeoJSON",id:"geojson",level:3},{value:"WKT (Well-Known Text)",id:"wkt-well-known-text",level:3},{value:"Coordinates",id:"coordinates",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Use Bounding Box Before Expensive Operations",id:"use-bounding-box-before-expensive-operations",level:3},{value:"Simplify Geometries",id:"simplify-geometries",level:3},{value:"Avoid GEOGRAPHY for Local Queries",id:"avoid-geography-for-local-queries",level:3},{value:"Vector Tile Generation",id:"vector-tile-generation",level:2},{value:"Mapbox Vector Tiles (MVT)",id:"mapbox-vector-tiles-mvt",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"1. Forgetting to Set SRID",id:"1-forgetting-to-set-srid",level:3},{value:"2. Mixing GEOMETRY and GEOGRAPHY",id:"2-mixing-geometry-and-geography",level:3},{value:"3. Using ST_Distance Without Index",id:"3-using-st_distance-without-index",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Check if Extension is Enabled",id:"check-if-extension-is-enabled",level:3},{value:"Verify SRID",id:"verify-srid",level:3},{value:"Explain Query Plan",id:"explain-query-plan",level:3},{value:"Resources",id:"resources",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"postgis-guide",children:"PostGIS Guide"})}),"\n",(0,o.jsx)(n.p,{children:"Complete guide to setting up PostGIS, creating spatial indexes, and writing efficient spatial queries."}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsx)(n.h3,{id:"macos-homebrew",children:"macOS (Homebrew)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Install PostgreSQL with PostGIS\nbrew install postgresql postgis\n\n# Start PostgreSQL\nbrew services start postgresql\n\n# Create database\ncreatedb myapp_dev\n\n# Enable PostGIS extension\npsql myapp_dev -c "CREATE EXTENSION postgis;"\npsql myapp_dev -c "CREATE EXTENSION postgis_topology;"  # Optional\n\n# Verify\npsql myapp_dev -c "SELECT PostGIS_version();"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"ubuntudebian",children:"Ubuntu/Debian"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Install\nsudo apt-get update\nsudo apt-get install postgresql postgresql-contrib postgis\n\n# Enable extension\nsudo -u postgres psql -d myapp_dev -c "CREATE EXTENSION postgis;"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Official PostGIS image\ndocker run --name postgis -e POSTGRES_PASSWORD=password -p 5432:5432 -d postgis/postgis\n\n# Connect\npsql -h localhost -U postgres\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"data-types",children:"Data Types"}),"\n",(0,o.jsx)(n.h3,{id:"geometry-vs-geography",children:"GEOMETRY vs GEOGRAPHY"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Units"}),(0,o.jsx)(n.th,{children:"Use When"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GEOMETRY"})}),(0,o.jsx)(n.td,{children:"Cartesian (meters/degrees)"}),(0,o.jsx)(n.td,{children:"Projected data, local areas"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GEOGRAPHY"})}),(0,o.jsx)(n.td,{children:"Spheroid (meters)"}),(0,o.jsx)(n.td,{children:"Global data, accurate distances"})]})]})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"GEOMETRY"})," (projected, flat Earth):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE locations_geometry (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255),\n  location GEOMETRY(POINT, 4326)  -- Stores as degrees, treats as flat\n);\n\n-- Distance in "degree units" (NOT meters!)\nSELECT ST_Distance(\n  ST_MakePoint(-122.4194, 37.7749),\n  ST_MakePoint(-122.4294, 37.7849)\n);\n-- Returns: 0.0141 (degrees, meaningless for distance)\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"GEOGRAPHY"})," (spherical, curved Earth):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE locations_geography (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255),\n  location GEOGRAPHY(POINT, 4326)  -- Treats Earth as sphere\n);\n\n-- Distance in meters (accurate!)\nSELECT ST_Distance(\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography,\n  ST_SetSRID(ST_MakePoint(-122.4294, 37.7849), 4326)::geography\n);\n-- Returns: 1568.5 (meters) \u2705\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Rule of thumb"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"GEOGRAPHY"})," for WGS84 data (GPS coordinates)"]}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"GEOMETRY"})," for projected data (UTM, Web Mercator)"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"geometry-types",children:"Geometry Types"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Point\nGEOMETRY(POINT, 4326)\n-- Example: ST_MakePoint(-122.4194, 37.7749)\n\n-- LineString\nGEOMETRY(LINESTRING, 4326)\n-- Example: ST_MakeLine(ARRAY[point1, point2, point3])\n\n-- Polygon\nGEOMETRY(POLYGON, 4326)\n-- Example: ST_MakePolygon(ST_MakeLine(ARRAY[p1, p2, p3, p4, p1]))\n\n-- MultiPoint\nGEOMETRY(MULTIPOINT, 4326)\n\n-- MultiLineString (e.g., roads network)\nGEOMETRY(MULTILINESTRING, 4326)\n\n-- MultiPolygon (e.g., islands)\nGEOMETRY(MULTIPOLYGON, 4326)\n\n-- GeometryCollection (mixed types)\nGEOMETRY(GEOMETRYCOLLECTION, 4326)\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"creating-spatial-data",children:"Creating Spatial Data"}),"\n",(0,o.jsx)(n.h3,{id:"from-latlon",children:"From Lat/Lon"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Single point\nINSERT INTO locations (name, location)\nVALUES ('San Francisco', ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326));\n\n-- From coordinates table\nUPDATE locations\nSET location = ST_SetSRID(ST_MakePoint(longitude, latitude), 4326)\nWHERE location IS NULL;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"from-geojson",children:"From GeoJSON"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Insert GeoJSON feature\nINSERT INTO locations (name, location)\nVALUES (\n  'Golden Gate Park',\n  ST_SetSRID(\n    ST_GeomFromGeoJSON('{\"type\":\"Point\",\"coordinates\":[-122.4862,37.7694]}'),\n    4326\n  )\n);\n\n-- Bulk import from GeoJSON file\n\\copy locations(name, location)\nFROM PROGRAM 'cat features.geojson | jq -r ''.features[] | [.properties.name, .geometry | tostring] | @csv'''\nWITH CSV DELIMITER ',';\n"})}),"\n",(0,o.jsx)(n.h3,{id:"from-wkt-well-known-text",children:"From WKT (Well-Known Text)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"INSERT INTO locations (name, location)\nVALUES (\n  'Line',\n  ST_SetSRID(\n    ST_GeomFromText('LINESTRING(-122.4194 37.7749, -122.4294 37.7849)'),\n    4326\n  )\n);\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"spatial-indexes",children:"Spatial Indexes"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"CRITICAL"}),": Without indexes, spatial queries are O(N) sequential scans."]}),"\n",(0,o.jsx)(n.h3,{id:"gist-index-most-common",children:"GiST Index (Most Common)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Create table\nCREATE TABLE drone_images (\n  id SERIAL PRIMARY KEY,\n  image_url VARCHAR(255),\n  location GEOGRAPHY(POINT, 4326),\n  captured_at TIMESTAMP\n);\n\n-- GiST index for spatial queries\nCREATE INDEX idx_drone_images_location ON drone_images USING GIST(location);\n\n-- Analyze table (update statistics)\nANALYZE drone_images;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Performance impact"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"10M points, 5km radius query"}),"\n",(0,o.jsx)(n.li,{children:"Without index: 3.2 seconds (seq scan)"}),"\n",(0,o.jsx)(n.li,{children:"With GiST index: 12ms (99.6% faster)"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"sp-gist-index-space-partitioning",children:"SP-GiST Index (Space-Partitioning)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Better for point data with high cardinality\nCREATE INDEX idx_locations_spgist ON locations USING SPGIST(location);\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"When to use"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"GiST: General-purpose, works for all geometry types"}),"\n",(0,o.jsx)(n.li,{children:"SP-GiST: Optimized for points, faster for kNN queries"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"common-spatial-queries",children:"Common Spatial Queries"}),"\n",(0,o.jsx)(n.h3,{id:"1-find-nearby-within-radius",children:"1. Find Nearby (Within Radius)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Find all locations within 5km of point\nSELECT id, name, ST_AsGeoJSON(location) as geojson\nFROM locations\nWHERE ST_DWithin(\n  location,\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography,\n  5000  -- 5000 meters = 5km\n)\nORDER BY location <-> ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography\nLIMIT 10;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Key functions"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ST_DWithin"}),": Returns true if distance <= threshold"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"<->"}),": Distance operator (for ORDER BY)"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"2-calculate-distance",children:"2. Calculate Distance"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Distance between two points (meters)\nSELECT ST_Distance(\n  (SELECT location FROM locations WHERE id = 1)::geography,\n  (SELECT location FROM locations WHERE id = 2)::geography\n) AS distance_meters;\n\n-- Distance from all locations to a point\nSELECT\n  id,\n  name,\n  ST_Distance(\n    location,\n    ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography\n  ) / 1000 AS distance_km\nFROM locations\nORDER BY distance_km\nLIMIT 10;\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"3-point-in-polygon",children:"3. Point in Polygon"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Check if point is inside polygon\nSELECT ST_Within(\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326),\n  (SELECT boundary FROM jurisdictions WHERE name = 'San Francisco')\n) AS is_inside;\n\n-- Find all points inside a polygon\nSELECT p.id, p.name\nFROM points p\nWHERE ST_Within(\n  p.location,\n  (SELECT boundary FROM jurisdictions WHERE name = 'California')\n);\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"4-bounding-box-query",children:"4. Bounding Box Query"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Find all points in bounding box\nSELECT id, name, ST_AsGeoJSON(location) as geojson\nFROM locations\nWHERE ST_Intersects(\n  location,\n  ST_MakeEnvelope(\n    -122.5194, 37.7049,  -- west, south\n    -122.3194, 37.8449,  -- east, north\n    4326\n  )\n);\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Optimization"}),": Bounding box queries use spatial index efficiently."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"5-nearest-neighbor-knn",children:"5. Nearest Neighbor (kNN)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Find 10 nearest locations\nSELECT id, name, ST_AsGeoJSON(location) as geojson\nFROM locations\nORDER BY location <-> ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography\nLIMIT 10;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": ",(0,o.jsx)(n.code,{children:"<->"})," operator uses index for fast kNN search."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"6-clustering-group-by-proximity",children:"6. Clustering (Group by Proximity)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Group locations within 1km of each other\nSELECT\n  ST_ClusterDBSCAN(location, eps := 1000, minpoints := 2) OVER () AS cluster_id,\n  id,\n  name,\n  ST_AsGeoJSON(location) as geojson\nFROM locations;\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"output-formats",children:"Output Formats"}),"\n",(0,o.jsx)(n.h3,{id:"geojson",children:"GeoJSON"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Single feature\nSELECT ST_AsGeoJSON(location) FROM locations WHERE id = 1;\n\n-- Feature with properties\nSELECT json_build_object(\n  'type', 'Feature',\n  'geometry', ST_AsGeoJSON(location)::json,\n  'properties', json_build_object('name', name, 'id', id)\n) FROM locations WHERE id = 1;\n\n-- FeatureCollection\nSELECT json_build_object(\n  'type', 'FeatureCollection',\n  'features', json_agg(\n    json_build_object(\n      'type', 'Feature',\n      'geometry', ST_AsGeoJSON(location)::json,\n      'properties', json_build_object('name', name, 'id', id)\n    )\n  )\n) FROM locations;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"wkt-well-known-text",children:"WKT (Well-Known Text)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT ST_AsText(location) FROM locations WHERE id = 1;\n-- Returns: POINT(-122.4194 37.7749)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"coordinates",children:"Coordinates"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Longitude\nSELECT ST_X(location) FROM locations WHERE id = 1;\n\n-- Latitude\nSELECT ST_Y(location) FROM locations WHERE id = 1;\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,o.jsx)(n.h3,{id:"use-bounding-box-before-expensive-operations",children:"Use Bounding Box Before Expensive Operations"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow: ST_Distance on all rows\nSELECT id, name\nFROM locations\nWHERE ST_Distance(\n  location,\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography\n) < 5000;\n\n-- \u2705 Fast: Bounding box pre-filter + ST_Distance\nSELECT id, name\nFROM locations\nWHERE ST_DWithin(\n  location,\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography,\n  5000\n)\nAND ST_Distance(\n  location,\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography\n) < 5000;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Why"}),": ",(0,o.jsx)(n.code,{children:"ST_DWithin"})," uses bounding box from index, then ",(0,o.jsx)(n.code,{children:"ST_Distance"})," refines."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"simplify-geometries",children:"Simplify Geometries"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Simplify polygon (reduce points)\nSELECT ST_Simplify(geometry, 0.001) FROM complex_polygons;\n\n-- Simplify preserving topology\nSELECT ST_SimplifyPreserveTopology(geometry, 0.001) FROM complex_polygons;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use when"}),": Rendering at low zoom levels (don't need full detail)."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"avoid-geography-for-local-queries",children:"Avoid GEOGRAPHY for Local Queries"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow: GEOGRAPHY on local data\nCREATE TABLE local_points (\n  location GEOGRAPHY(POINT, 4326)\n);\n\n-- \u2705 Fast: GEOMETRY in local UTM projection\nCREATE TABLE local_points (\n  location GEOMETRY(POINT, 32610)  -- UTM 10N\n);\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Why"}),": GEOGRAPHY calculations are slower (spheroid math). For local areas, projected coordinates are faster and accurate."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"vector-tile-generation",children:"Vector Tile Generation"}),"\n",(0,o.jsx)(n.h3,{id:"mapbox-vector-tiles-mvt",children:"Mapbox Vector Tiles (MVT)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Generate tile at z/x/y\nSELECT ST_AsMVT(q, 'layer', 4096, 'geom') AS mvt\nFROM (\n  SELECT\n    id,\n    name,\n    ST_AsMVTGeom(\n      ST_Transform(location, 3857),  -- Transform to Web Mercator\n      ST_TileEnvelope(:z, :x, :y),\n      4096,  -- Tile extent\n      256    -- Buffer\n    ) AS geom\n  FROM locations\n  WHERE ST_Intersects(\n    location,\n    ST_Transform(ST_TileEnvelope(:z, :x, :y), 4326)\n  )\n) AS q;\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use in Express"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"app.get('/tiles/:z/:x/:y.mvt', async (req, res) => {\n  const { z, x, y } = req.params;\n\n  const result = await db.query(\n    'SELECT ST_AsMVT(q, $1, 4096, $2) AS mvt FROM ...',\n    ['layer', 'geom']\n  );\n\n  res.set('Content-Type', 'application/x-protobuf');\n  res.send(result.rows[0].mvt);\n});\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,o.jsx)(n.h3,{id:"1-forgetting-to-set-srid",children:"1. Forgetting to Set SRID"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- \u274c WRONG - no SRID\nINSERT INTO locations (location) VALUES (ST_MakePoint(-122.4194, 37.7749));\n\n-- \u2705 CORRECT\nINSERT INTO locations (location) VALUES (\n  ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)\n);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"2-mixing-geometry-and-geography",children:"2. Mixing GEOMETRY and GEOGRAPHY"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- \u274c WRONG - can't compare GEOMETRY with GEOGRAPHY\nSELECT ST_Distance(geometry_col, geography_col);\n\n-- \u2705 CORRECT - cast to same type\nSELECT ST_Distance(geometry_col::geography, geography_col);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-using-st_distance-without-index",children:"3. Using ST_Distance Without Index"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- \u274c SLOW - ST_Distance doesn't use index\nSELECT * FROM locations\nWHERE ST_Distance(location, point) < 5000;\n\n-- \u2705 FAST - ST_DWithin uses index\nSELECT * FROM locations\nWHERE ST_DWithin(location, point, 5000);\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"check-if-extension-is-enabled",children:"Check if Extension is Enabled"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM pg_extension WHERE extname = 'postgis';\n"})}),"\n",(0,o.jsx)(n.h3,{id:"verify-srid",children:"Verify SRID"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT ST_SRID(location) FROM locations LIMIT 1;\n-- Should return 4326 for WGS84\n"})}),"\n",(0,o.jsx)(n.h3,{id:"explain-query-plan",children:"Explain Query Plan"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"EXPLAIN ANALYZE\nSELECT * FROM locations\nWHERE ST_DWithin(location, ST_SetSRID(ST_MakePoint(-122.4194, 37.7749), 4326)::geography, 5000);\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Look for"}),': "Index Scan using idx_..." (good) vs "Seq Scan" (bad)']}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://postgis.net/docs/",children:"PostGIS Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://postgis.net/docs/PostGIS_FAQ.html",children:"PostGIS Cheat Sheet"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://postgis.net/workshops/postgis-intro/joins.html",children:"Spatial Joins"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://postgis.net/workshops/postgis-intro/performance.html",children:"Performance Tuning"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);