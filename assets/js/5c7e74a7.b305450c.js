"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[57770],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},94439:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"skills/sobriety_tools_guardian/references/PERFORMANCE_PATTERNS","title":"Performance Patterns for Recovery Apps","description":"Why Performance is Life-or-Death","source":"@site/docs/skills/sobriety_tools_guardian/references/PERFORMANCE_PATTERNS.md","sourceDirName":"skills/sobriety_tools_guardian/references","slug":"/skills/sobriety_tools_guardian/references/PERFORMANCE_PATTERNS","permalink":"/docs/skills/sobriety_tools_guardian/references/PERFORMANCE_PATTERNS","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Performance Patterns for Recovery Apps","sidebar_label":"Performance Patterns for Re...","sidebar_position":2}}');var t=i(74848),r=i(28453);const a={title:"Performance Patterns for Recovery Apps",sidebar_label:"Performance Patterns for Re...",sidebar_position:2},l="Performance Patterns for Recovery Apps",c={},o=[{value:"Why Performance is Life-or-Death",id:"why-performance-is-life-or-death",level:2},{value:"Critical Path Priorities",id:"critical-path-priorities",level:2},{value:"Tier 1: Must Load in &lt;200ms (Crisis Critical)",id:"tier-1-must-load-in-200ms-crisis-critical",level:3},{value:"Tier 2: Must Load in &lt;500ms (High Priority)",id:"tier-2-must-load-in-500ms-high-priority",level:3},{value:"Tier 3: Can Load in &lt;2s (Standard)",id:"tier-3-can-load-in-2s-standard",level:3},{value:"Offline-First Architecture",id:"offline-first-architecture",level:2},{value:"Service Worker Cache Strategy",id:"service-worker-cache-strategy",level:3},{value:"IndexedDB for Critical Data",id:"indexeddb-for-critical-data",level:3},{value:"React Query Configuration",id:"react-query-configuration",level:2},{value:"For Crisis-Critical Data",id:"for-crisis-critical-data",level:3},{value:"For Non-Critical Data",id:"for-non-critical-data",level:3},{value:"Edge Caching with Cloudflare KV",id:"edge-caching-with-cloudflare-kv",level:2},{value:"Geohash-Based Meeting Cache",id:"geohash-based-meeting-cache",level:3},{value:"Cache Warming Strategy",id:"cache-warming-strategy",level:3},{value:"Bundle Optimization",id:"bundle-optimization",level:2},{value:"Dynamic Imports for Non-Critical Features",id:"dynamic-imports-for-non-critical-features",level:3},{value:"Tree-Shaking Dependencies",id:"tree-shaking-dependencies",level:3},{value:"Database Query Optimization",id:"database-query-optimization",level:2},{value:"PostGIS Spatial Queries",id:"postgis-spatial-queries",level:3},{value:"Index Strategy",id:"index-strategy",level:3},{value:"Crisis Detection Patterns",id:"crisis-detection-patterns",level:2},{value:"Journal Sentiment Analysis",id:"journal-sentiment-analysis",level:3},{value:"Proactive Help Surfacing",id:"proactive-help-surfacing",level:3},{value:"Monitoring &amp; Alerting",id:"monitoring--alerting",level:2},{value:"Key Metrics",id:"key-metrics",level:3},{value:"Automated Alerts",id:"automated-alerts",level:3},{value:"Testing Checklist",id:"testing-checklist",level:2},{value:"Before Every Deploy",id:"before-every-deploy",level:3},{value:"Weekly",id:"weekly",level:3},{value:"Monthly",id:"monthly",level:3},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"performance-patterns-for-recovery-apps",children:"Performance Patterns for Recovery Apps"})}),"\n",(0,t.jsx)(n.h2,{id:"why-performance-is-life-or-death",children:"Why Performance is Life-or-Death"}),"\n",(0,t.jsx)(n.p,{children:"This isn't a business app. The user opening sobriety.tools might be:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A fentanyl addict with seconds before relapse"}),"\n",(0,t.jsx)(n.li,{children:"Someone in emotional crisis needing their sponsor's number"}),"\n",(0,t.jsx)(n.li,{children:"A person at 2am looking for a meeting to survive until morning"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every second of load time is a second they might give up."})}),"\n",(0,t.jsx)(n.h2,{id:"critical-path-priorities",children:"Critical Path Priorities"}),"\n",(0,t.jsx)(n.h3,{id:"tier-1-must-load-in-200ms-crisis-critical",children:"Tier 1: Must Load in <200ms (Crisis Critical)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Contacts/Sponsors"})," - Phone numbers for immediate support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Safety Plan"})," - User's personalized coping strategies"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Crisis Resources"})," - Hotline numbers"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"tier-2-must-load-in-500ms-high-priority",children:"Tier 2: Must Load in <500ms (High Priority)"}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Meeting Search"})," - Find nearby meetings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check-in Form"})," - Record current state"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"tier-3-can-load-in-2s-standard",children:"Tier 3: Can Load in <2s (Standard)"}),"\n",(0,t.jsxs)(n.ol,{start:"6",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Journal"})," - Review past entries"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Progress Charts"})," - Analytics and trends"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Settings"})," - Configuration"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"offline-first-architecture",children:"Offline-First Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"service-worker-cache-strategy",children:"Service Worker Cache Strategy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Workbox configuration for crisis-critical routes\nconst PRECACHE_ROUTES = [\n  '/contacts',\n  '/safety-plan',\n  '/crisis',\n  '/check-in',\n];\n\nconst CACHE_FIRST_ROUTES = [\n  '/meetings?saved=true',  // Saved meetings\n  '/api/contacts',         // Sponsor data\n];\n\nconst STALE_WHILE_REVALIDATE = [\n  '/meetings',            // General search (prefer fresh)\n  '/api/meetings',        // Meeting API\n];\n"})}),"\n",(0,t.jsx)(n.h3,{id:"indexeddb-for-critical-data",children:"IndexedDB for Critical Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Always cache these locally\nconst OFFLINE_CRITICAL = {\n  contacts: {\n    store: 'contacts',\n    maxAge: Infinity,  // Never expire\n    syncStrategy: 'background',\n  },\n  safetyPlan: {\n    store: 'safety_plan',\n    maxAge: Infinity,\n    syncStrategy: 'background',\n  },\n  savedMeetings: {\n    store: 'saved_meetings',\n    maxAge: 24 * 60 * 60 * 1000,  // 24 hours\n    syncStrategy: 'background',\n  },\n  recentCheckins: {\n    store: 'checkins',\n    maxAge: 7 * 24 * 60 * 60 * 1000,  // 7 days\n    syncStrategy: 'background',\n  },\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"react-query-configuration",children:"React Query Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"for-crisis-critical-data",children:"For Crisis-Critical Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Contacts query - show cached data IMMEDIATELY\nconst useContacts = () => useQuery({\n  queryKey: ['contacts'],\n  queryFn: fetchContacts,\n  initialData: () => getFromIndexedDB('contacts'),\n  staleTime: Infinity,  // Never consider stale\n  gcTime: Infinity,     // Never garbage collect\n  refetchOnMount: false,\n  refetchOnWindowFocus: false,\n  refetchOnReconnect: 'always',  // Sync when back online\n});\n\n// Meeting search - aggressive caching\nconst useMeetings = (geohash: string) => useQuery({\n  queryKey: ['meetings', 'nearby', geohash],\n  queryFn: () => fetchMeetings(geohash),\n  staleTime: 6 * 60 * 60 * 1000,  // 6 hours (match harvester schedule)\n  gcTime: 24 * 60 * 60 * 1000,    // 24 hours\n  refetchOnMount: false,\n  refetchOnWindowFocus: false,\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"for-non-critical-data",children:"For Non-Critical Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Journal entries - standard caching\nconst useJournal = () => useQuery({\n  queryKey: ['journal'],\n  queryFn: fetchJournal,\n  staleTime: 5 * 60 * 1000,  // 5 minutes\n  gcTime: 30 * 60 * 1000,    // 30 minutes\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"edge-caching-with-cloudflare-kv",children:"Edge Caching with Cloudflare KV"}),"\n",(0,t.jsx)(n.h3,{id:"geohash-based-meeting-cache",children:"Geohash-Based Meeting Cache"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"User Location (45.52, -122.68)\n    \u2193\nGeohash: c20 (Portland metro, ~150km cell)\n    \u2193\nKV Key: meetings:c20:25 (25-mile radius)\n    \u2193\nCache HIT \u2192 Return immediately (~5ms)\nCache MISS \u2192 Query Supabase \u2192 Store in KV \u2192 Return (~200-500ms)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cache-warming-strategy",children:"Cache Warming Strategy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Top 30 US metros to pre-warm after each harvest\nconst WARM_METROS = [\n  { lat: 40.71, lng: -74.01 },  // NYC\n  { lat: 34.05, lng: -118.24 }, // LA\n  { lat: 41.88, lng: -87.63 },  // Chicago\n  // ... 27 more\n];\n\n// Run after harvester completes\nasync function warmCache() {\n  for (const metro of WARM_METROS) {\n    await fetch(`/api/all?lat=${metro.lat}&lng=${metro.lng}&radius=25`);\n    await sleep(100);  // Rate limit\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"bundle-optimization",children:"Bundle Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"dynamic-imports-for-non-critical-features",children:"Dynamic Imports for Non-Critical Features"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad - loads everything upfront\nimport { JournalAI } from '@/components/JournalAI';\nimport { Charts } from '@/components/Charts';\nimport { CalendarExport } from '@/components/CalendarExport';\n\n// \u2705 Good - loads on demand\nconst JournalAI = dynamic(() => import('@/components/JournalAI'), {\n  ssr: false,\n  loading: () => <FeatureSkeleton />,\n});\n\nconst Charts = dynamic(() => import('@/components/Charts'), {\n  ssr: false,\n  loading: () => <ChartSkeleton />,\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tree-shaking-dependencies",children:"Tree-Shaking Dependencies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad - imports entire library\nimport _ from 'lodash';\nimport dayjs from 'dayjs';\n\n// \u2705 Good - imports only what's needed\nimport debounce from 'lodash/debounce';\nimport { format, parseISO } from 'date-fns';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"database-query-optimization",children:"Database Query Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"postgis-spatial-queries",children:"PostGIS Spatial Queries"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow - calculates distance for all meetings\nSELECT * FROM meetings\nORDER BY ST_Distance(geog, ST_MakePoint($lng, $lat)::geography)\nLIMIT 100;\n\n-- \u2705 Fast - filters by bounding box first\nSELECT * FROM meetings\nWHERE ST_DWithin(geog, ST_MakePoint($lng, $lat)::geography, $radius_meters)\nORDER BY ST_Distance(geog, ST_MakePoint($lng, $lat)::geography)\nLIMIT 100;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"index-strategy",children:"Index Strategy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Spatial index for location queries\nCREATE INDEX idx_meetings_geog ON meetings USING GIST (geog);\n\n-- Compound index for filtered searches\nCREATE INDEX idx_meetings_day_program ON meetings (day_of_week, program)\nWHERE day_of_week IS NOT NULL;\n\n-- Index for user-specific queries\nCREATE INDEX idx_contacts_user_active ON contacts (user_id)\nWHERE status = 'active';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"crisis-detection-patterns",children:"Crisis Detection Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"journal-sentiment-analysis",children:"Journal Sentiment Analysis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface CrisisIndicators {\n  anger_spike: boolean;      // HALT angry score jumps 3+ points\n  ex_mentions: boolean;      // Ex-partner mentioned 3+ times/week\n  isolation: boolean;        // No check-ins for 3+ days after daily streak\n  time_distortion: boolean;  // Check-ins at 2-5am\n  negative_spiral: boolean;  // Consecutive declining mood scores\n}\n\nfunction detectCrisis(recentCheckins: Checkin[], journals: Journal[]): CrisisIndicators {\n  // Implementation details...\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"proactive-help-surfacing",children:"Proactive Help Surfacing"}),"\n",(0,t.jsx)(n.p,{children:"When crisis indicators are detected:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't alarm"})," - No scary warnings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Gentle nudge"}),' - "Your sponsor Sarah is available"']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Surface tools"})," - Show safety plan link prominently"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reduce friction"})," - One-tap call to sponsor"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"monitoring--alerting",children:"Monitoring & Alerting"}),"\n",(0,t.jsx)(n.h3,{id:"key-metrics",children:"Key Metrics"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Threshold"}),(0,t.jsx)(n.th,{children:"Action"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Contacts FCP"}),(0,t.jsx)(n.td,{children:">200ms"}),(0,t.jsx)(n.td,{children:"P0 - Fix immediately"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Meetings LCP"}),(0,t.jsx)(n.td,{children:">500ms"}),(0,t.jsx)(n.td,{children:"P1 - Fix within 24h"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cache hit rate"}),(0,t.jsx)(n.td,{children:"<80%"}),(0,t.jsx)(n.td,{children:"Warm cache"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Lighthouse perf"}),(0,t.jsx)(n.td,{children:"<90"}),(0,t.jsx)(n.td,{children:"Investigate bundle"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"API P95"}),(0,t.jsx)(n.td,{children:">500ms"}),(0,t.jsx)(n.td,{children:"Check Supabase"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"automated-alerts",children:"Automated Alerts"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// In perf-audit.ts\nif (contactsFCP > 200) {\n  await createGitHubIssue({\n    title: '[CRITICAL] Contacts page FCP regression',\n    body: `FCP is ${contactsFCP}ms (threshold: 200ms).\n\nUsers in crisis cannot access sponsor numbers quickly enough.\nThis is a life-safety issue.`,\n    labels: ['critical', 'performance', 'crisis-path'],\n  });\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"before-every-deploy",children:"Before Every Deploy"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Lighthouse performance \u226590"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Contacts page FCP <200ms"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Meeting search <500ms"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Bundle delta <5KB"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Offline mode tested (DevTools \u2192 Network \u2192 Offline)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"weekly",children:"Weekly"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Review slow query logs in Supabase"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Check KV cache hit rate (>80%)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test on real device with 3G throttling"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Review RUM data for P95 load times"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"monthly",children:"Monthly"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Profile React renders"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Audit third-party scripts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Prune unused dependencies"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Full crisis flow test on real device"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://web.dev/vitals/",children:"Web Vitals"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developers.cloudflare.com/workers/runtime-apis/kv/",children:"Cloudflare Workers KV"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://postgis.net/docs/using_postgis_dbmanagement.html#idm2264",children:"PostGIS Spatial Indexing"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tanstack.com/query/latest/docs/framework/react/guides/caching",children:"React Query Caching"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);