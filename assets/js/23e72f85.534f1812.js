"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[97983],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(96540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}},67606:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"skills/code_necromancer/references/integration-test-patterns","title":"Integration Test Patterns","description":"Resurrection tests to verify legacy systems are working.","source":"@site/docs/skills/code_necromancer/references/integration-test-patterns.md","sourceDirName":"skills/code_necromancer/references","slug":"/skills/code_necromancer/references/integration-test-patterns","permalink":"/docs/skills/code_necromancer/references/integration-test-patterns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Integration Test Patterns","sidebar_label":"Integration Test Patterns","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Infrastructure Mapping","permalink":"/docs/skills/code_necromancer/references/infrastructure-mapping"},"next":{"title":"Archaeology Report: [PROJEC...","permalink":"/docs/skills/code_necromancer/templates/archaeology-report"}}');var r=t(74848),a=t(28453);const i={title:"Integration Test Patterns",sidebar_label:"Integration Test Patterns",sidebar_position:5},o="Integration Test Patterns",c={},l=[{value:"Test Categories",id:"test-categories",level:2},{value:"1. Service Startup Tests",id:"1-service-startup-tests",level:3},{value:"2. Database Connection Tests",id:"2-database-connection-tests",level:3},{value:"3. Inter-Service Communication Tests",id:"3-inter-service-communication-tests",level:3},{value:"Critical Path Tests",id:"critical-path-tests",level:2},{value:"User Authentication Flow",id:"user-authentication-flow",level:3},{value:"E-commerce Order Flow",id:"e-commerce-order-flow",level:3},{value:"External Service Tests",id:"external-service-tests",level:2},{value:"Third-Party API Connectivity",id:"third-party-api-connectivity",level:3},{value:"Smoke Test Checklist",id:"smoke-test-checklist",level:2},{value:"Docker Compose Test Environment",id:"docker-compose-test-environment",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"integration-test-patterns",children:"Integration Test Patterns"})}),"\n",(0,r.jsx)(n.p,{children:"Resurrection tests to verify legacy systems are working."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"test-categories",children:"Test Categories"}),"\n",(0,r.jsx)(n.h3,{id:"1-service-startup-tests",children:"1. Service Startup Tests"}),"\n",(0,r.jsx)(n.p,{children:"Verify each service can start without crashing."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// Node.js service startup test\ndescribe('Service Startup', () => {\n  let server;\n\n  beforeAll(async () => {\n    // Set test environment\n    process.env.NODE_ENV = 'test';\n    process.env.DATABASE_URL = 'postgresql://localhost:5432/test_db';\n\n    // Import and start\n    const app = require('../src/app');\n    server = app.listen(0);  // Random port\n  });\n\n  afterAll(async () => {\n    await server.close();\n  });\n\n  test('server starts without error', () => {\n    expect(server.listening).toBe(true);\n  });\n\n  test('health endpoint responds', async () => {\n    const response = await fetch(`http://localhost:${server.address().port}/health`);\n    expect(response.status).toBe(200);\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-database-connection-tests",children:"2. Database Connection Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Database Connection', () => {\n  test('can connect to database', async () => {\n    const { Pool } = require('pg');\n    const pool = new Pool({ connectionString: process.env.DATABASE_URL });\n\n    const result = await pool.query('SELECT NOW()');\n    expect(result.rows).toHaveLength(1);\n\n    await pool.end();\n  });\n\n  test('migrations are applied', async () => {\n    const result = await pool.query(`\n      SELECT table_name FROM information_schema.tables\n      WHERE table_schema = 'public'\n    `);\n\n    expect(result.rows.map(r => r.table_name)).toContain('users');\n    expect(result.rows.map(r => r.table_name)).toContain('orders');\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-inter-service-communication-tests",children:"3. Inter-Service Communication Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Service Communication', () => {\n  test('API can reach Auth service', async () => {\n    const response = await fetch(`${process.env.AUTH_SERVICE_URL}/health`);\n    expect(response.ok).toBe(true);\n  });\n\n  test('API can authenticate with Auth service', async () => {\n    const response = await fetch(`${process.env.AUTH_SERVICE_URL}/verify`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ token: 'test-token' })\n    });\n\n    // Even if invalid token, should get structured response\n    expect(response.status).toBeLessThan(500);\n  });\n\n  test('Worker can connect to message queue', async () => {\n    const amqp = require('amqplib');\n    const conn = await amqp.connect(process.env.RABBITMQ_URL);\n    const channel = await conn.createChannel();\n\n    // Verify queue exists\n    const queue = await channel.checkQueue('tasks');\n    expect(queue).toBeDefined();\n\n    await conn.close();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"critical-path-tests",children:"Critical Path Tests"}),"\n",(0,r.jsx)(n.h3,{id:"user-authentication-flow",children:"User Authentication Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Authentication Flow', () => {\n  test('can register new user', async () => {\n    const response = await api.post('/auth/register', {\n      email: `test-${Date.now()}@example.com`,\n      password: 'SecurePassword123!'\n    });\n\n    expect(response.status).toBe(201);\n    expect(response.data.token).toBeDefined();\n  });\n\n  test('can login existing user', async () => {\n    const response = await api.post('/auth/login', {\n      email: 'existing@example.com',\n      password: 'KnownPassword123!'\n    });\n\n    expect(response.status).toBe(200);\n    expect(response.data.token).toBeDefined();\n  });\n\n  test('can access protected route with token', async () => {\n    const loginResponse = await api.post('/auth/login', {\n      email: 'existing@example.com',\n      password: 'KnownPassword123!'\n    });\n\n    const token = loginResponse.data.token;\n\n    const response = await api.get('/api/me', {\n      headers: { Authorization: `Bearer ${token}` }\n    });\n\n    expect(response.status).toBe(200);\n    expect(response.data.email).toBe('existing@example.com');\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"e-commerce-order-flow",children:"E-commerce Order Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Order Flow', () => {\n  let authToken;\n\n  beforeAll(async () => {\n    const login = await api.post('/auth/login', {\n      email: 'test@example.com',\n      password: 'password'\n    });\n    authToken = login.data.token;\n  });\n\n  test('can view products', async () => {\n    const response = await api.get('/api/products');\n    expect(response.status).toBe(200);\n    expect(response.data.length).toBeGreaterThan(0);\n  });\n\n  test('can add to cart', async () => {\n    const response = await api.post('/api/cart', {\n      productId: 1,\n      quantity: 2\n    }, {\n      headers: { Authorization: `Bearer ${authToken}` }\n    });\n\n    expect(response.status).toBe(200);\n  });\n\n  test('can checkout', async () => {\n    const response = await api.post('/api/checkout', {\n      paymentMethod: 'test',\n      shippingAddress: {\n        street: '123 Test St',\n        city: 'Test City',\n        zip: '12345'\n      }\n    }, {\n      headers: { Authorization: `Bearer ${authToken}` }\n    });\n\n    expect(response.status).toBe(201);\n    expect(response.data.orderId).toBeDefined();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"external-service-tests",children:"External Service Tests"}),"\n",(0,r.jsx)(n.h3,{id:"third-party-api-connectivity",children:"Third-Party API Connectivity"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('External Services', () => {\n  test('Stripe API is reachable', async () => {\n    const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);\n\n    // Simple API call to verify credentials\n    const balance = await stripe.balance.retrieve();\n    expect(balance.object).toBe('balance');\n  });\n\n  test('SendGrid API is reachable', async () => {\n    const sgMail = require('@sendgrid/mail');\n    sgMail.setApiKey(process.env.SENDGRID_API_KEY);\n\n    // Don't actually send, just verify client\n    expect(sgMail).toBeDefined();\n  });\n\n  test('AWS S3 bucket is accessible', async () => {\n    const { S3Client, HeadBucketCommand } = require('@aws-sdk/client-s3');\n    const s3 = new S3Client({ region: process.env.AWS_REGION });\n\n    const command = new HeadBucketCommand({ Bucket: process.env.S3_BUCKET });\n    const response = await s3.send(command);\n\n    expect(response.$metadata.httpStatusCode).toBe(200);\n  });\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"smoke-test-checklist",children:"Smoke Test Checklist"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"## Resurrection Smoke Tests\n\n### Infrastructure\n- [ ] All databases reachable\n- [ ] All caches (Redis) reachable\n- [ ] Message queues accessible\n- [ ] S3/storage buckets accessible\n- [ ] DNS resolves correctly\n\n### Services\n- [ ] API gateway starts\n- [ ] Auth service starts\n- [ ] Core service starts\n- [ ] Background workers start\n- [ ] All health endpoints respond\n\n### Communication\n- [ ] Frontend can reach API\n- [ ] API can reach auth service\n- [ ] API can reach core service\n- [ ] Services can reach databases\n- [ ] Workers can receive from queue\n\n### Critical Paths\n- [ ] User can register\n- [ ] User can login\n- [ ] User can view main page\n- [ ] User can perform primary action\n- [ ] Admin can access admin panel\n\n### External\n- [ ] Payment provider reachable\n- [ ] Email service reachable\n- [ ] CDN working\n- [ ] OAuth providers working\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"docker-compose-test-environment",children:"Docker Compose Test Environment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  test-db:\n    image: postgres:14\n    environment:\n      POSTGRES_DB: test_db\n      POSTGRES_USER: test\n      POSTGRES_PASSWORD: test\n    ports:\n      - "5433:5432"\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U test"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n\n  test-redis:\n    image: redis:7\n    ports:\n      - "6380:6379"\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n\n  test-rabbitmq:\n    image: rabbitmq:3-management\n    ports:\n      - "5673:5672"\n      - "15673:15672"\n    healthcheck:\n      test: ["CMD", "rabbitmq-diagnostics", "check_running"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  integration-tests:\n    build:\n      context: .\n      dockerfile: Dockerfile.test\n    depends_on:\n      test-db:\n        condition: service_healthy\n      test-redis:\n        condition: service_healthy\n      test-rabbitmq:\n        condition: service_healthy\n    environment:\n      DATABASE_URL: postgresql://test:test@test-db:5432/test_db\n      REDIS_URL: redis://test-redis:6379\n      RABBITMQ_URL: amqp://guest:guest@test-rabbitmq:5672\n    command: npm run test:integration\n'})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);