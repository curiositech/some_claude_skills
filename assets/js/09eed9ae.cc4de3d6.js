"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[76343],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},49312:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"skills/large_scale_map_visualization/index","title":"\ud83d\udcca Large Scale Map Visualization","description":"Master of high-performance web map implementations handling 5,000-100,000+ geographic data points. Specializes in Leaflet.js optimization, Supercluster algorithms, viewport-based loading, canvas rendering, and progressive disclosure UX patterns.","source":"@site/docs/skills/large_scale_map_visualization/index.md","sourceDirName":"skills/large_scale_map_visualization","slug":"/skills/large_scale_map_visualization/","permalink":"/docs/skills/large_scale_map_visualization/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Large Scale Map Visualization","sidebar_position":1}}');var r=s(74848),t=s(28453);const l={sidebar_label:"Large Scale Map Visualization",sidebar_position:1},a="\ud83d\udcca Large Scale Map Visualization",o={},c=[{value:"Allowed Tools",id:"allowed-tools",level:2},{value:"Tags",id:"tags",level:2},{value:"Activation Triggers",id:"activation-triggers",level:2},{value:"Core Expertise",id:"core-expertise",level:2},{value:"Performance Architecture",id:"performance-architecture",level:3},{value:"Technology Stack Decisions",id:"technology-stack-decisions",level:3},{value:"Key Techniques",id:"key-techniques",level:2},{value:"1. Marker Clustering with Supercluster",id:"1-marker-clustering-with-supercluster",level:3},{value:"2. Viewport-Based Loading (Supabase + PostGIS)",id:"2-viewport-based-loading-supabase--postgis",level:3},{value:"3. Progressive Disclosure Strategy",id:"3-progressive-disclosure-strategy",level:3},{value:"4. Canvas Rendering for Performance",id:"4-canvas-rendering-for-performance",level:3},{value:"5. Efficient Cluster Icons",id:"5-efficient-cluster-icons",level:3},{value:"6. Debounced Map Events",id:"6-debounced-map-events",level:3},{value:"Performance Benchmarks",id:"performance-benchmarks",level:2},{value:"UX Patterns",id:"ux-patterns",level:2},{value:"Cluster Interaction Patterns",id:"cluster-interaction-patterns",level:3},{value:"Loading States",id:"loading-states",level:3},{value:"Empty States",id:"empty-states",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"\u274c Anti-patterns to Avoid",id:"-anti-patterns-to-avoid",level:3},{value:"\u2705 Best Practices",id:"-best-practices",level:3},{value:"Real-World Examples",id:"real-world-examples",level:2},{value:"Zillow Pattern",id:"zillow-pattern",level:3},{value:"Airbnb Pattern",id:"airbnb-pattern",level:3},{value:"OpenStreetMap Pattern",id:"openstreetmap-pattern",level:3},{value:"Tech Stack Compatibility",id:"tech-stack-compatibility",level:2},{value:"Frameworks",id:"frameworks",level:3},{value:"Databases",id:"databases",level:3},{value:"Map Libraries",id:"map-libraries",level:3},{value:"Migration Checklist",id:"migration-checklist",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"References",id:"references",level:2},{value:"Research Papers",id:"research-papers",level:3},{value:"Technical Guides",id:"technical-guides",level:3},{value:"UX Research",id:"ux-research",level:3},{value:"Version History",id:"version-history",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-large-scale-map-visualization",children:"\ud83d\udcca Large Scale Map Visualization"})}),"\n",(0,r.jsx)(n.p,{children:"Master of high-performance web map implementations handling 5,000-100,000+ geographic data points. Specializes in Leaflet.js optimization, Supercluster algorithms, viewport-based loading, canvas rendering, and progressive disclosure UX patterns."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"allowed-tools",children:"Allowed Tools"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Read, Write, Edit, Bash, Glob, Grep, WebSearch, WebFetch\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tags",children:"Tags"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"maps"})," ",(0,r.jsx)(n.code,{children:"leaflet"})," ",(0,r.jsx)(n.code,{children:"geospatial"})," ",(0,r.jsx)(n.code,{children:"clustering"})," ",(0,r.jsx)(n.code,{children:"performance"})," ",(0,r.jsx)(n.code,{children:"visualization"})," ",(0,r.jsx)(n.code,{children:"supercluster"})," ",(0,r.jsx)(n.code,{children:"react"})]}),"\n",(0,r.jsx)(n.h1,{id:"large-scale-map-visualization-expert",children:"Large-Scale Map Visualization Expert"}),"\n",(0,r.jsx)(n.p,{children:"Master of high-performance web map implementations handling 5,000-100,000+ geographic data points. Specializes in Leaflet.js optimization, spatial clustering algorithms, viewport-based loading, and progressive disclosure UX patterns for map-based applications."}),"\n",(0,r.jsx)(n.h2,{id:"activation-triggers",children:"Activation Triggers"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Activate on:"}),' "map performance", "too many markers", "slow map", "clustering", "10k points", "marker clustering", "leaflet performance", "spatial visualization", "geospatial clustering", "viewport loading", "map data optimization", "real-time map", "Supercluster", "marker cluster"']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOT for:"})," Static map images (use Mapbox/Google Static) | 3D visualizations (use Maplibre GL) | Non-geographic data visualization (use D3.js/Chart.js) | Simple maps with <100 markers (vanilla Leaflet is fine)"]}),"\n",(0,r.jsx)(n.h2,{id:"core-expertise",children:"Core Expertise"}),"\n",(0,r.jsx)(n.h3,{id:"performance-architecture",children:"Performance Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              MAP PERFORMANCE TIERS                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  0-100 markers    \u2192 Vanilla Leaflet (no optimization)      \u2502\n\u2502  100-1,000        \u2192 Basic clustering (react-leaflet-cluster)\u2502\n\u2502  1,000-10,000     \u2192 Supercluster + viewport loading        \u2502\n\u2502  10,000-50,000    \u2192 Supercluster + canvas + sampling       \u2502\n\u2502  50,000-500,000   \u2192 Web Workers + server-side clustering   \u2502\n\u2502  500,000+         \u2192 MVT tiles + backend pre-aggregation    \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"technology-stack-decisions",children:"Technology Stack Decisions"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Best Library"}),(0,r.jsx)(n.th,{children:"Why"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"React + <5k points"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"react-leaflet-cluster"})}),(0,r.jsx)(n.td,{children:"Simple drop-in, wraps Leaflet.markercluster"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"React + 5-50k points"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"use-supercluster"})," hook"]}),(0,r.jsx)(n.td,{children:"3-5x faster, viewport-aware, GeoJSON native"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"React + 50k+ points"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"supercluster"})," + Web Workers"]}),(0,r.jsx)(n.td,{children:"Offload clustering to background thread"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Static sites"}),(0,r.jsx)(n.td,{children:"Server-side clustering"}),(0,r.jsx)(n.td,{children:"Pre-compute at build time"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Real-time updates"}),(0,r.jsx)(n.td,{children:"Canvas renderer + sampling"}),(0,r.jsx)(n.td,{children:"Minimize DOM manipulation"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"key-techniques",children:"Key Techniques"}),"\n",(0,r.jsx)(n.h3,{id:"1-marker-clustering-with-supercluster",children:"1. Marker Clustering with Supercluster"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why Supercluster beats alternatives:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Handles 500k points in 1-2 seconds vs 8+ seconds for Leaflet.markercluster"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Architecture"}),": Index-based k-d tree clustering, can run server-side or in Workers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API"}),": Simple GeoJSON input/output"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Viewport-aware"}),": Only clusters visible points"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation Pattern:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import useSupercluster from "use-supercluster";\n\nexport function OptimizedMap({ locations }: { locations: Place[] }) {\n  const mapRef = useRef<L.Map | null>(null);\n  const [bounds, setBounds] = useState<BBox | null>(null);\n  const [zoom, setZoom] = useState(10);\n\n  // Convert to GeoJSON Feature collection\n  const points = useMemo(() =>\n    locations.map(place => ({\n      type: "Feature" as const,\n      properties: {\n        cluster: false,\n        placeId: place.id,\n        place\n      },\n      geometry: {\n        type: "Point" as const,\n        coordinates: [place.longitude, place.latitude]\n      }\n    })),\n    [locations]\n  );\n\n  // Cluster points based on viewport\n  const { clusters, supercluster } = useSupercluster({\n    points,\n    bounds,\n    zoom,\n    options: {\n      radius: 75,        // Cluster radius in pixels\n      maxZoom: 16,       // Stop clustering at street level\n      minPoints: 2       // Minimum points to form cluster\n    }\n  });\n\n  // Update viewport on map move\n  useEffect(() => {\n    if (!mapRef.current) return;\n\n    const handleMove = () => {\n      const map = mapRef.current!;\n      const b = map.getBounds();\n      setBounds([b.getWest(), b.getSouth(), b.getEast(), b.getNorth()]);\n      setZoom(map.getZoom());\n    };\n\n    mapRef.current.on("moveend", handleMove);\n    handleMove(); // Initial load\n\n    return () => mapRef.current?.off("moveend", handleMove);\n  }, []);\n\n  return (\n    <MapContainer ref={mapRef} preferCanvas={true}>\n      {clusters.map(cluster => {\n        const [lng, lat] = cluster.geometry.coordinates;\n        const { cluster: isCluster, point_count } = cluster.properties;\n\n        if (isCluster) {\n          return (\n            <Marker\n              key={`cluster-${cluster.id}`}\n              position={[lat, lng]}\n              icon={createClusterIcon(point_count, zoom)}\n              eventHandlers={{\n                click: () => {\n                  const expansionZoom = Math.min(\n                    supercluster!.getClusterExpansionZoom(cluster.id),\n                    18\n                  );\n                  mapRef.current?.setView([lat, lng], expansionZoom, {\n                    animate: true\n                  });\n                }\n              }}\n            />\n          );\n        }\n\n        return (\n          <PlaceMarker\n            key={cluster.properties.placeId}\n            place={cluster.properties.place}\n          />\n        );\n      })}\n    </MapContainer>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-viewport-based-loading-supabase--postgis",children:"2. Viewport-Based Loading (Supabase + PostGIS)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Database Function:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION find_in_viewport(\n  min_lng DOUBLE PRECISION,\n  min_lat DOUBLE PRECISION,\n  max_lng DOUBLE PRECISION,\n  max_lat DOUBLE PRECISION,\n  zoom_level INTEGER DEFAULT 11,\n  max_results INTEGER DEFAULT 10000\n)\nRETURNS TABLE (\n  id UUID,\n  name TEXT,\n  latitude DOUBLE PRECISION,\n  longitude DOUBLE PRECISION\n  /* other fields */\n) AS $$\nBEGIN\n  -- At low zoom levels, sample to reduce density\n  IF zoom_level < 9 THEN\n    RETURN QUERY\n    SELECT\n      p.id, p.name,\n      ST_Y(p.geog::geometry) as latitude,\n      ST_X(p.geog::geometry) as longitude\n    FROM places p\n    WHERE p.geog && ST_MakeEnvelope(min_lng, min_lat, max_lng, max_lat, 4326)::geography\n    AND random() < 0.2  -- Show 20% for performance\n    LIMIT max_results / 2;\n  ELSE\n    -- Full data at higher zoom\n    RETURN QUERY\n    SELECT\n      p.id, p.name,\n      ST_Y(p.geog::geometry) as latitude,\n      ST_X(p.geog::geometry) as longitude\n    FROM places p\n    WHERE p.geog && ST_MakeEnvelope(min_lng, min_lat, max_lng, max_lat, 4326)::geography\n    LIMIT max_results;\n  END IF;\nEND;\n$$ LANGUAGE plpgsql STABLE;\n\n-- Ensure spatial index exists\nCREATE INDEX IF NOT EXISTS idx_places_geog ON places USING GIST (geog);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"React Query Hook:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import { useQuery } from "@tanstack/react-query";\nimport { supabase } from "@/lib/supabase";\n\ntype BBox = [number, number, number, number]; // [west, south, east, north]\n\nexport function usePlacesInViewport(\n  bounds: BBox | null,\n  zoom: number,\n  enabled = true\n) {\n  return useQuery({\n    queryKey: ["places", "viewport", bounds?.join(","), zoom],\n    queryFn: async () => {\n      if (!bounds) return [];\n\n      const [west, south, east, north] = bounds;\n\n      const { data, error } = await supabase.rpc("find_in_viewport", {\n        min_lng: west,\n        min_lat: south,\n        max_lng: east,\n        max_lat: north,\n        zoom_level: zoom\n      });\n\n      if (error) throw error;\n      return data || [];\n    },\n    enabled: enabled && !!bounds,\n    staleTime: 5 * 60 * 1000,    // 5 min (locations rarely change)\n    gcTime: 30 * 60 * 1000,       // 30 min in cache\n    refetchOnWindowFocus: false\n  });\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-progressive-disclosure-strategy",children:"3. Progressive Disclosure Strategy"}),"\n",(0,r.jsx)(n.p,{children:"Show appropriate detail levels based on zoom:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const getClusterOptions = (zoom: number) => ({\n  radius: zoom < 10 ? 100 : zoom < 14 ? 75 : 50,\n  maxZoom: 16,\n  minPoints: zoom < 10 ? 5 : 2\n});\n\nconst getMarkerSize = (zoom: number) =>\n  zoom < 12 ? 24 : zoom < 15 ? 32 : 40;\n\nconst shouldShowLabel = (zoom: number) => zoom >= 14;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-canvas-rendering-for-performance",children:"4. Canvas Rendering for Performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import L from "leaflet";\n\n// Enable canvas renderer globally\nconst canvasRenderer = L.canvas({\n  tolerance: 10,      // Hit detection tolerance\n  padding: 0.5        // Extra render area (0.5 = 50% of viewport)\n});\n\nconst mapOptions = {\n  preferCanvas: true,\n  renderer: canvasRenderer,\n  // Disable animations on mobile\n  zoomAnimation: !isMobile(),\n  fadeAnimation: !isMobile(),\n  markerZoomAnimation: !isMobile()\n};\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance gain"}),": 3-5x faster rendering with 1,000+ markers"]}),"\n",(0,r.jsx)(n.h3,{id:"5-efficient-cluster-icons",children:"5. Efficient Cluster Icons"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import L from "leaflet";\n\n// Use divIcon (faster than custom components)\nfunction createClusterIcon(count: number, zoom: number) {\n  const size = getMarkerSize(zoom);\n\n  return L.divIcon({\n    html: `\n      <div style="\n        width: ${size}px;\n        height: ${size}px;\n        background: linear-gradient(135deg, #d97706, #f59e0b);\n        border-radius: 50%;\n        border: 3px solid #1a1410;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-weight: bold;\n        font-size: ${zoom < 12 ? \'10px\' : \'14px\'};\n        box-shadow: 0 4px 12px rgba(0,0,0,0.4);\n      ">\n        ${count}\n      </div>\n    `,\n    className: "cluster-icon",\n    iconSize: [size, size],\n    iconAnchor: [size / 2, size / 2]\n  });\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"6-debounced-map-events",children:"6. Debounced Map Events"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import { useDebouncedCallback } from "use-debounce";\n\nconst handleMapMove = useDebouncedCallback(() => {\n  const bounds = mapRef.current?.getBounds();\n  const zoom = mapRef.current?.getZoom();\n  if (bounds && zoom) {\n    setBounds([\n      bounds.getWest(),\n      bounds.getSouth(),\n      bounds.getEast(),\n      bounds.getNorth()\n    ]);\n    setZoom(zoom);\n  }\n}, 300); // 300ms debounce\n\nuseEffect(() => {\n  mapRef.current?.on("moveend", handleMapMove);\n  return () => mapRef.current?.off("moveend", handleMapMove);\n}, []);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"performance-benchmarks",children:"Performance Benchmarks"}),"\n",(0,r.jsx)(n.p,{children:"Based on real-world testing and research (sources in references):"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Strategy"}),(0,r.jsx)(n.th,{children:"1k points"}),(0,r.jsx)(n.th,{children:"5k points"}),(0,r.jsx)(n.th,{children:"10k points"}),(0,r.jsx)(n.th,{children:"Mobile (4G)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"No clustering"}),(0,r.jsx)(n.td,{children:"800ms"}),(0,r.jsx)(n.td,{children:"3.5s \u274c"}),(0,r.jsx)(n.td,{children:"8s \u274c"}),(0,r.jsx)(n.td,{children:"12s \u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Basic clustering"}),(0,r.jsx)(n.td,{children:"400ms"}),(0,r.jsx)(n.td,{children:"1.8s \u26a0\ufe0f"}),(0,r.jsx)(n.td,{children:"4s \u26a0\ufe0f"}),(0,r.jsx)(n.td,{children:"6s \u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Leaflet.markercluster"}),(0,r.jsx)(n.td,{children:"200ms"}),(0,r.jsx)(n.td,{children:"800ms \u26a0\ufe0f"}),(0,r.jsx)(n.td,{children:"2s \u26a0\ufe0f"}),(0,r.jsx)(n.td,{children:"3s \u26a0\ufe0f"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Supercluster + viewport"}),(0,r.jsx)(n.td,{children:"150ms \u2705"}),(0,r.jsx)(n.td,{children:"300ms \u2705"}),(0,r.jsx)(n.td,{children:"500ms \u2705"}),(0,r.jsx)(n.td,{children:"800ms \u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Supercluster + canvas"}),(0,r.jsx)(n.td,{children:"100ms \u2705"}),(0,r.jsx)(n.td,{children:"200ms \u2705"}),(0,r.jsx)(n.td,{children:"350ms \u2705"}),(0,r.jsx)(n.td,{children:"500ms \u2705"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Target Performance Goals:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Initial load: <500ms (perceived)"}),"\n",(0,r.jsx)(n.li,{children:"Pan/zoom: <200ms response"}),"\n",(0,r.jsx)(n.li,{children:"Marker click: <100ms"}),"\n",(0,r.jsx)(n.li,{children:"Mobile: 2x desktop times acceptable"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ux-patterns",children:"UX Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"cluster-interaction-patterns",children:"Cluster Interaction Patterns"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Click to Expand"})," (Recommended)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Click cluster \u2192 zoom to expansion zoom level"}),"\n",(0,r.jsx)(n.li,{children:'Shows "spider" view of underlying points'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Click to List"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Click cluster \u2192 show sidebar with all items"}),"\n",(0,r.jsx)(n.li,{children:"Good for dense areas (downtown cores)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Hover Preview"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hover cluster \u2192 show count + top 3 items"}),"\n",(0,r.jsx)(n.li,{children:"Good for discovery UX"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"loading-states",children:"Loading States"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'{isLoading && (\n  <div className="absolute inset-0 bg-leather-900/50 backdrop-blur-sm z-[1000] flex items-center justify-center">\n    <div className="text-sand-100">\n      Loading {loadedCount} of {totalCount} locations...\n    </div>\n  </div>\n)}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"empty-states",children:"Empty States"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'{!isLoading && clusters.length === 0 && (\n  <div className="absolute inset-0 flex items-center justify-center z-[999]">\n    <div className="text-center max-w-md p-6">\n      <MapPin className="h-12 w-12 text-sand-400 mx-auto mb-4" />\n      <h3 className="font-bitter text-xl text-sand-100 mb-2">\n        No locations in this area\n      </h3>\n      <p className="text-sand-400 mb-4">\n        Try zooming out or searching a different location.\n      </p>\n      <button onClick={resetView} className="btn-primary">\n        Reset View\n      </button>\n    </div>\n  </div>\n)}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsx)(n.h3,{id:"-anti-patterns-to-avoid",children:"\u274c Anti-patterns to Avoid"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Loading all data upfront"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'// BAD: Fetches 10k records on mount\nconst { data } = useQuery(["all-places"], fetchAllPlaces);\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Re-rendering on every map move"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'// BAD: Updates state on every pixel\nmap.on("move", () => setBounds(map.getBounds()));\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Complex marker components"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// BAD: React component per marker\n<Marker icon={<ComplexSVGComponent />} />\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"No zoom-level adaptation"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// BAD: Same clustering at all zoom levels\nconst clusterOptions = { radius: 80, maxZoom: 20 };\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-best-practices",children:"\u2705 Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Viewport-based loading with debouncing"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Simple marker icons (divIcon with inline styles)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Progressive disclosure (adapt to zoom level)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Canvas rendering for large datasets"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Proper React Query cache configuration"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"real-world-examples",children:"Real-World Examples"}),"\n",(0,r.jsx)(n.h3,{id:"zillow-pattern",children:"Zillow Pattern"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Low zoom"}),": Neighborhood price clusters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Medium zoom"}),": Individual properties with price"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"High zoom"}),": Full property cards"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Click"}),": Expand cluster or open details"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"airbnb-pattern",children:"Airbnb Pattern"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server-side"}),": Pre-cluster at 10 zoom levels"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client-side"}),": Viewport API with 300ms debounce"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rendering"}),": Canvas for price labels"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Interaction"}),": Hover for preview, click for details"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"openstreetmap-pattern",children:"OpenStreetMap Pattern"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tile-based"}),": Pre-rendered raster tiles"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vector tiles"}),": For 100k+ POIs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Simplification"}),": Reduce detail at low zoom"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Caching"}),": Aggressive CDN + browser cache"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"tech-stack-compatibility",children:"Tech Stack Compatibility"}),"\n",(0,r.jsx)(n.h3,{id:"frameworks",children:"Frameworks"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Next.js 13+ (App Router + Server Components)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Next.js Pages Router"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Vite + React"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Remix"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Astro (with client islands)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"databases",children:"Databases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Supabase (PostGIS)"})," - Recommended, built-in spatial indexing"]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 PostgreSQL + PostGIS"}),"\n",(0,r.jsx)(n.li,{children:"\u26a0\ufe0f MongoDB (geospatial queries slower than PostGIS)"}),"\n",(0,r.jsx)(n.li,{children:"\u26a0\ufe0f Firebase (limited spatial query support)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"map-libraries",children:"Map Libraries"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Leaflet.js"})," - Best for static tiles + markers"]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Mapbox GL JS - Better for vector tiles"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Maplibre GL JS - Open-source Mapbox alternative"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Google Maps API - Expensive, less flexible"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"migration-checklist",children:"Migration Checklist"}),"\n",(0,r.jsx)(n.p,{children:"When optimizing an existing slow map:"}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Measure current performance (Chrome DevTools Performance tab)"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Count total markers/points in dataset"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Check if spatial index exists on database (",(0,r.jsx)(n.code,{children:"EXPLAIN ANALYZE"}),")"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Install clustering library (",(0,r.jsx)(n.code,{children:"npm install use-supercluster"}),")"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement viewport-based loading"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add canvas renderer option"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test on mobile device (4G throttling)"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add loading states"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement progressive disclosure"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up performance monitoring"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Document zoom-level behaviors"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "dependencies": {\n    "leaflet": "^1.9.4",\n    "react-leaflet": "^4.2.1",\n    "supercluster": "^8.0.1",\n    "use-supercluster": "^1.2.0",\n    "@tanstack/react-query": "^5.0.0",\n    "use-debounce": "^10.0.0"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsx)(n.h3,{id:"research-papers",children:"Research Papers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.researchgate.net/publication/334853181",children:"Performance Testing on Marker Clustering (2019)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://postgis.net/workshops/postgis-intro/indexing.html",children:"Spatial Indexing Performance in PostgreSQL"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"technical-guides",children:"Technical Guides"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://andrejgajdos.com/leaflet-developer-guide-to-high-performance-map-visualizations-in-react/",children:"Leaflet Performance Guide (Andrej Gajdos)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://supabase.com/docs/guides/database/extensions/postgis",children:"PostGIS Spatial Queries | Supabase Docs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/mapbox/supercluster",children:"Supercluster GitHub"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/leighhalliday/use-supercluster",children:"use-supercluster React Hook"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ux-research",children:"UX Research"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://raw.studio/blog/using-maps-as-the-core-ux-in-real-estate-platforms/",children:"Map-Based UX in Real Estate (RAW Studio)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.uxmatters.com/mt/archives/2020/05/designing-for-progressive-disclosure.php",children:"Progressive Disclosure in Maps (UX Matters)"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"version-history",children:"Version History"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"2026-01-09: Initial skill creation based on sobriety.tools places map optimization"}),"\n",(0,r.jsx)(n.li,{children:"Research synthesized from 8 authoritative sources"}),"\n",(0,r.jsx)(n.li,{children:"Tested with Next.js 15, Leaflet 1.9.4, Supabase PostGIS"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Skill Author"}),": Claude Code (Sonnet 4.5)\n",(0,r.jsx)(n.strong,{children:"Domain"}),": Geospatial Data Visualization, Web Performance\n",(0,r.jsx)(n.strong,{children:"Complexity"}),": Advanced (requires PostGIS, React, spatial algorithms knowledge)"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);