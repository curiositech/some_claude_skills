"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[38582],{11446:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"skills/rest_api_design/index","title":"\u2705 Rest Api Design","description":"Design REST API endpoints with Zod validation and OpenAPI documentation. Use when creating new API routes, validating request/response schemas, or updating API documentation. Activates for endpoint design, schema validation, error handling, and API docs.","source":"@site/docs/skills/rest_api_design/index.md","sourceDirName":"skills/rest_api_design","slug":"/skills/rest_api_design/","permalink":"/docs/skills/rest_api_design/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Rest Api Design","sidebar_position":1}}');var r=t(74848),i=t(28453);const a={sidebar_label:"Rest Api Design",sidebar_position:1},o="\u2705 Rest Api Design",d={},c=[{value:"Allowed Tools",id:"allowed-tools",level:2},{value:"Tags",id:"tags",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"API Route Structure",id:"api-route-structure",level:2},{value:"Standard Route Template",id:"standard-route-template",level:2},{value:"Zod Schema Patterns",id:"zod-schema-patterns",level:2},{value:"Basic Types",id:"basic-types",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:3},{value:"Query Parameter Validation",id:"query-parameter-validation",level:3},{value:"Error Response Format",id:"error-response-format",level:2},{value:"HTTP Status Codes",id:"http-status-codes",level:2},{value:"OpenAPI Documentation",id:"openapi-documentation",level:2},{value:"Route Handler Patterns",id:"route-handler-patterns",level:2},{value:"Dynamic Routes",id:"dynamic-routes",level:3},{value:"Pagination",id:"pagination",level:3},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-rest-api-design",children:"\u2705 Rest Api Design"})}),"\n",(0,r.jsx)(n.p,{children:"Design REST API endpoints with Zod validation and OpenAPI documentation. Use when creating new API routes, validating request/response schemas, or updating API documentation. Activates for endpoint design, schema validation, error handling, and API docs."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"allowed-tools",children:"Allowed Tools"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Read, Write, Edit, Bash(npm:*, npx:*)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tags",children:"Tags"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"api"})," ",(0,r.jsx)(n.code,{children:"code"})," ",(0,r.jsx)(n.code,{children:"validation"})," ",(0,r.jsx)(n.code,{children:"documentation"})]}),"\n",(0,r.jsx)(n.h1,{id:"rest-api-design",children:"REST API Design"}),"\n",(0,r.jsx)(n.p,{children:"This skill helps you design and implement REST API endpoints following project patterns with Zod validation and OpenAPI documentation."}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"USE this skill for:"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creating new REST API endpoints with Next.js App Router"}),"\n",(0,r.jsx)(n.li,{children:"Designing request/response schemas with Zod"}),"\n",(0,r.jsx)(n.li,{children:"Implementing proper error handling and status codes"}),"\n",(0,r.jsx)(n.li,{children:"Adding rate limiting and authentication"}),"\n",(0,r.jsx)(n.li,{children:"Generating OpenAPI documentation"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"DO NOT use for:"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"GraphQL APIs \u2192 different paradigm entirely"}),"\n",(0,r.jsxs)(n.li,{children:["Cloudflare Workers \u2192 use ",(0,r.jsx)(n.code,{children:"cloudflare-worker-dev"})," skill"]}),"\n",(0,r.jsx)(n.li,{children:"Supabase Edge Functions \u2192 use Supabase docs"}),"\n",(0,r.jsx)(n.li,{children:"WebSocket/real-time APIs \u2192 different patterns"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"api-route-structure",children:"API Route Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"src/app/api/\n\u251c\u2500\u2500 auth/           # Authentication endpoints\n\u251c\u2500\u2500 check-in/       # Daily check-in CRUD\n\u251c\u2500\u2500 chat/           # AI coaching chat\n\u251c\u2500\u2500 journal/        # Journal entries\n\u251c\u2500\u2500 admin/          # Admin-only endpoints\n\u2514\u2500\u2500 health/         # Health check\n"})}),"\n",(0,r.jsx)(n.h2,{id:"standard-route-template",children:"Standard Route Template"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// src/app/api/[feature]/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { getSession } from '@/lib/auth';\nimport { createRateLimiter } from '@/lib/rate-limit';\nimport { logPHIAccess } from '@/lib/hipaa/audit';\nimport { db } from '@/db';\n\n// 1. Define schemas\nconst RequestSchema = z.object({\n  field: z.string().min(1).max(1000),\n  optional: z.string().optional(),\n  enumField: z.enum(['option1', 'option2']),\n  number: z.number().int().positive(),\n});\n\nconst ResponseSchema = z.object({\n  id: z.string(),\n  createdAt: z.string().datetime(),\n});\n\n// 2. Configure rate limiter\nconst rateLimiter = createRateLimiter({\n  windowMs: 60000,    // 1 minute\n  maxRequests: 30,    // 30 requests per window\n  keyPrefix: 'api:feature',\n});\n\n// 3. Implement handlers\nexport async function GET(request: NextRequest) {\n  // Auth check\n  const session = await getSession();\n  if (!session) {\n    return NextResponse.json(\n      { error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  // Rate limit\n  const rateLimitResult = await rateLimiter.check(session.userId);\n  if (!rateLimitResult.allowed) {\n    return NextResponse.json(\n      { error: 'Rate limit exceeded' },\n      { status: 429, headers: rateLimitResult.headers }\n    );\n  }\n\n  // Query data\n  const data = await db.query.features.findMany({\n    where: eq(features.userId, session.userId),\n  });\n\n  // Audit log (if PHI)\n  await logPHIAccess(session.userId, 'feature', null, 'LIST');\n\n  return NextResponse.json(data);\n}\n\nexport async function POST(request: NextRequest) {\n  // Auth check\n  const session = await getSession();\n  if (!session) {\n    return NextResponse.json(\n      { error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  // Rate limit\n  const rateLimitResult = await rateLimiter.check(session.userId);\n  if (!rateLimitResult.allowed) {\n    return NextResponse.json(\n      { error: 'Rate limit exceeded' },\n      { status: 429, headers: rateLimitResult.headers }\n    );\n  }\n\n  // Parse and validate body\n  let body: unknown;\n  try {\n    body = await request.json();\n  } catch {\n    return NextResponse.json(\n      { error: 'Invalid JSON' },\n      { status: 400 }\n    );\n  }\n\n  const parsed = RequestSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json(\n      {\n        error: 'Validation failed',\n        details: parsed.error.issues.map(i => ({\n          path: i.path.join('.'),\n          message: i.message,\n        })),\n      },\n      { status: 400 }\n    );\n  }\n\n  // Create resource\n  const [created] = await db.insert(features).values({\n    id: generateId(),\n    userId: session.userId,\n    ...parsed.data,\n    createdAt: new Date(),\n  }).returning();\n\n  // Audit log\n  await logPHIAccess(session.userId, 'feature', created.id, 'CREATE');\n\n  return NextResponse.json(created, { status: 201 });\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"zod-schema-patterns",children:"Zod Schema Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"basic-types",children:"Basic Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod';\n\nconst Schema = z.object({\n  // Strings\n  name: z.string().min(1).max(100),\n  email: z.string().email(),\n  url: z.string().url(),\n  uuid: z.string().uuid(),\n\n  // Numbers\n  count: z.number().int().positive(),\n  rating: z.number().min(1).max(5),\n  price: z.number().nonnegative(),\n\n  // Booleans\n  isActive: z.boolean(),\n\n  // Dates\n  date: z.string().datetime(),\n  dateOnly: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/),\n\n  // Enums\n  status: z.enum(['pending', 'approved', 'denied']),\n\n  // Arrays\n  tags: z.array(z.string()).min(1).max(10),\n\n  // Optional fields\n  notes: z.string().optional(),\n  metadata: z.record(z.string()).optional(),\n\n  // Nullable\n  deletedAt: z.string().datetime().nullable(),\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Discriminated unions\nconst EventSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('click'), x: z.number(), y: z.number() }),\n  z.object({ type: z.literal('keypress'), key: z.string() }),\n]);\n\n// Refinements\nconst PasswordSchema = z.string()\n  .min(12, 'Password must be at least 12 characters')\n  .regex(/[A-Z]/, 'Must contain uppercase')\n  .regex(/[a-z]/, 'Must contain lowercase')\n  .regex(/[0-9]/, 'Must contain number')\n  .regex(/[^A-Za-z0-9]/, 'Must contain special character');\n\n// Transform\nconst DateSchema = z.string()\n  .datetime()\n  .transform(str => new Date(str));\n\n// Preprocess (coerce types)\nconst NumberFromString = z.preprocess(\n  val => typeof val === 'string' ? parseInt(val, 10) : val,\n  z.number()\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"query-parameter-validation",children:"Query Parameter Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n\n  const QuerySchema = z.object({\n    page: z.coerce.number().int().positive().default(1),\n    limit: z.coerce.number().int().min(1).max(100).default(20),\n    sort: z.enum(['asc', 'desc']).default('desc'),\n    status: z.enum(['all', 'active', 'archived']).optional(),\n  });\n\n  const query = QuerySchema.safeParse({\n    page: searchParams.get('page'),\n    limit: searchParams.get('limit'),\n    sort: searchParams.get('sort'),\n    status: searchParams.get('status'),\n  });\n\n  if (!query.success) {\n    return NextResponse.json(\n      { error: 'Invalid query parameters', details: query.error.issues },\n      { status: 400 }\n    );\n  }\n\n  const { page, limit, sort, status } = query.data;\n  // Use validated params...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"error-response-format",children:"Error Response Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Standard error response\ninterface APIError {\n  error: string;           // Human-readable message\n  code?: string;           // Machine-readable code\n  details?: ErrorDetail[]; // Validation details\n}\n\ninterface ErrorDetail {\n  path: string;\n  message: string;\n}\n\n// Error responses\nreturn NextResponse.json(\n  { error: 'Not found', code: 'NOT_FOUND' },\n  { status: 404 }\n);\n\nreturn NextResponse.json(\n  {\n    error: 'Validation failed',\n    code: 'VALIDATION_ERROR',\n    details: [\n      { path: 'email', message: 'Invalid email format' },\n    ],\n  },\n  { status: 400 }\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"http-status-codes",children:"HTTP Status Codes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Code"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"200"}),(0,r.jsx)(n.td,{children:"Successful GET, PUT, PATCH"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"201"}),(0,r.jsx)(n.td,{children:"Successful POST (created)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"204"}),(0,r.jsx)(n.td,{children:"Successful DELETE (no content)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"400"}),(0,r.jsx)(n.td,{children:"Invalid request/validation error"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"401"}),(0,r.jsx)(n.td,{children:"Not authenticated"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"403"}),(0,r.jsx)(n.td,{children:"Not authorized (authenticated but forbidden)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"404"}),(0,r.jsx)(n.td,{children:"Resource not found"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"409"}),(0,r.jsx)(n.td,{children:"Conflict (duplicate, etc.)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"429"}),(0,r.jsx)(n.td,{children:"Rate limit exceeded"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"500"}),(0,r.jsx)(n.td,{children:"Server error"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"openapi-documentation",children:"OpenAPI Documentation"}),"\n",(0,r.jsxs)(n.p,{children:["Update ",(0,r.jsx)(n.code,{children:"docs/openapi.yaml"})," when adding endpoints:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"paths:\n  /api/feature:\n    get:\n      summary: List features\n      tags: [Features]\n      security:\n        - cookieAuth: []\n      parameters:\n        - name: page\n          in: query\n          schema:\n            type: integer\n            default: 1\n        - name: limit\n          in: query\n          schema:\n            type: integer\n            default: 20\n            maximum: 100\n      responses:\n        '200':\n          description: Success\n          content:\n            application/json:\n              schema:\n                type: array\n                items:\n                  $ref: '#/components/schemas/Feature'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n\n    post:\n      summary: Create feature\n      tags: [Features]\n      security:\n        - cookieAuth: []\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateFeatureRequest'\n      responses:\n        '201':\n          description: Created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Feature'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n\ncomponents:\n  schemas:\n    Feature:\n      type: object\n      properties:\n        id:\n          type: string\n          format: uuid\n        name:\n          type: string\n        createdAt:\n          type: string\n          format: date-time\n      required: [id, name, createdAt]\n\n    CreateFeatureRequest:\n      type: object\n      properties:\n        name:\n          type: string\n          minLength: 1\n          maxLength: 100\n      required: [name]\n\n  responses:\n    Unauthorized:\n      description: Not authenticated\n      content:\n        application/json:\n          schema:\n            type: object\n            properties:\n              error:\n                type: string\n                example: Unauthorized\n\n    ValidationError:\n      description: Validation failed\n      content:\n        application/json:\n          schema:\n            type: object\n            properties:\n              error:\n                type: string\n              details:\n                type: array\n                items:\n                  type: object\n                  properties:\n                    path:\n                      type: string\n                    message:\n                      type: string\n"})}),"\n",(0,r.jsx)(n.h2,{id:"route-handler-patterns",children:"Route Handler Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"dynamic-routes",children:"Dynamic Routes"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// src/app/api/feature/[id]/route.ts\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n\n  // Validate ID format\n  if (!isValidUUID(id)) {\n    return NextResponse.json(\n      { error: 'Invalid ID format' },\n      { status: 400 }\n    );\n  }\n\n  const item = await db.query.features.findFirst({\n    where: eq(features.id, id),\n  });\n\n  if (!item) {\n    return NextResponse.json(\n      { error: 'Not found' },\n      { status: 404 }\n    );\n  }\n\n  return NextResponse.json(item);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pagination",children:"Pagination"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface PaginatedResponse<T> {\n  data: T[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n  };\n}\n\nasync function getPaginated(page: number, limit: number) {\n  const offset = (page - 1) * limit;\n\n  const [data, [{ count }]] = await Promise.all([\n    db.query.features.findMany({\n      limit,\n      offset,\n      orderBy: desc(features.createdAt),\n    }),\n    db.select({ count: count() }).from(features),\n  ]);\n\n  return {\n    data,\n    pagination: {\n      page,\n      limit,\n      total: count,\n      totalPages: Math.ceil(count / limit),\n    },\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://zod.dev",children:"Zod Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/route-handlers",children:"Next.js Route Handlers"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://swagger.io/specification/",children:"OpenAPI Specification"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://dub.co/blog/zod-api-validation",children:"Dub.co Zod Validation"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(96540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);