"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[51708],{20095:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"skills/mcp_creator/references/security-hardening","title":"MCP Security Hardening Guide","description":"Security Checklist","source":"@site/docs/skills/mcp_creator/references/security-hardening.md","sourceDirName":"skills/mcp_creator/references","slug":"/skills/mcp_creator/references/security-hardening","permalink":"/docs/skills/mcp_creator/references/security-hardening","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"MCP Security Hardening Guide","sidebar_label":"MCP Security Hardening Guide","sidebar_position":2}}');var i=r(74848),s=r(28453);const o={title:"MCP Security Hardening Guide",sidebar_label:"MCP Security Hardening Guide",sidebar_position:2},a="MCP Security Hardening Guide",c={},l=[{value:"Security Checklist",id:"security-checklist",level:2},{value:"Input Validation Patterns",id:"input-validation-patterns",level:2},{value:"Using Zod (Recommended)",id:"using-zod-recommended",level:3},{value:"SQL Injection Prevention",id:"sql-injection-prevention",level:3},{value:"Command Injection Prevention",id:"command-injection-prevention",level:3},{value:"Path Traversal Prevention",id:"path-traversal-prevention",level:3},{value:"Secret Management",id:"secret-management",level:2},{value:"Environment Variables (Minimum)",id:"environment-variables-minimum",level:3},{value:"Secret Manager Integration",id:"secret-manager-integration",level:3},{value:"Secret Rotation",id:"secret-rotation",level:3},{value:"Rate Limiting Implementation",id:"rate-limiting-implementation",level:2},{value:"Token Bucket Algorithm",id:"token-bucket-algorithm",level:3},{value:"Sliding Window Counter",id:"sliding-window-counter",level:3},{value:"OWASP Top 10 Mitigations",id:"owasp-top-10-mitigations",level:2},{value:"A01: Broken Access Control",id:"a01-broken-access-control",level:3},{value:"A02: Cryptographic Failures",id:"a02-cryptographic-failures",level:3},{value:"A03: Injection",id:"a03-injection",level:3},{value:"A05: Security Misconfiguration",id:"a05-security-misconfiguration",level:3},{value:"A10: Server-Side Request Forgery (SSRF)",id:"a10-server-side-request-forgery-ssrf",level:3},{value:"Error Handling Security",id:"error-handling-security",level:2},{value:"Sanitize Error Messages",id:"sanitize-error-messages",level:3},{value:"Secure Logging",id:"secure-logging",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mcp-security-hardening-guide",children:"MCP Security Hardening Guide"})}),"\n",(0,i.jsx)(n.h2,{id:"security-checklist",children:"Security Checklist"}),"\n",(0,i.jsx)(n.p,{children:"Before deploying any MCP server, verify:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"INPUT VALIDATION\n\u251c\u2500\u2500 [ ] All inputs validated with schema (Zod/JSON Schema)\n\u251c\u2500\u2500 [ ] String lengths limited\n\u251c\u2500\u2500 [ ] Numeric ranges constrained\n\u251c\u2500\u2500 [ ] Regex patterns for format validation\n\u251c\u2500\u2500 [ ] No SQL/command injection vectors\n\u2514\u2500\u2500 [ ] Arrays have max length limits\n\nAUTHENTICATION & AUTHORIZATION\n\u251c\u2500\u2500 [ ] Credentials in environment variables only\n\u251c\u2500\u2500 [ ] Secrets never logged or returned in errors\n\u251c\u2500\u2500 [ ] API keys rotated regularly\n\u251c\u2500\u2500 [ ] Minimum required permissions\n\u2514\u2500\u2500 [ ] Token validation on every request\n\nRATE LIMITING\n\u251c\u2500\u2500 [ ] Per-user rate limits\n\u251c\u2500\u2500 [ ] Per-tool rate limits\n\u251c\u2500\u2500 [ ] Global rate limits\n\u251c\u2500\u2500 [ ] Graceful degradation on limit\n\u2514\u2500\u2500 [ ] Rate limit headers in responses\n\nERROR HANDLING\n\u251c\u2500\u2500 [ ] No stack traces in production\n\u251c\u2500\u2500 [ ] Sensitive data sanitized from errors\n\u251c\u2500\u2500 [ ] Generic errors for auth failures\n\u251c\u2500\u2500 [ ] Structured error responses\n\u2514\u2500\u2500 [ ] All errors logged securely\n\nNETWORK SECURITY\n\u251c\u2500\u2500 [ ] HTTPS for all external calls\n\u251c\u2500\u2500 [ ] Certificate validation enabled\n\u251c\u2500\u2500 [ ] Timeouts on all requests\n\u251c\u2500\u2500 [ ] No SSRF vulnerabilities\n\u2514\u2500\u2500 [ ] IP allowlisting where appropriate\n"})}),"\n",(0,i.jsx)(n.h2,{id:"input-validation-patterns",children:"Input Validation Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"using-zod-recommended",children:"Using Zod (Recommended)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { z } from "zod";\n\n// Define strict schemas\nconst UserQuerySchema = z.object({\n  userId: z.string()\n    .min(1)\n    .max(100)\n    .regex(/^[a-zA-Z0-9_-]+$/, "Invalid userId format"),\n\n  query: z.string()\n    .max(10000)\n    .refine(\n      (q) => !containsSqlInjection(q),\n      { message: "Invalid query content" }\n    ),\n\n  options: z.object({\n    limit: z.number().int().min(1).max(1000).default(100),\n    offset: z.number().int().min(0).default(0),\n    sortBy: z.enum(["created", "updated", "name"]).default("created"),\n  }).optional(),\n});\n\n// Validate in handler\nasync function handleUserQuery(args: unknown) {\n  const validated = UserQuerySchema.parse(args);\n  // Safe to use validated.userId, validated.query, etc.\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"sql-injection-prevention",children:"SQL Injection Prevention"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// \u2705 Good: Parameterized queries\nconst result = await pool.query(\n  "SELECT * FROM users WHERE id = $1 AND status = $2",\n  [userId, status]\n);\n\n// \u2705 Good: Query builder with escaping\nconst users = await knex("users")\n  .where({ id: userId, status })\n  .select("*");\n\n// \u274c BAD: String concatenation\nconst result = await pool.query(\n  `SELECT * FROM users WHERE id = \'${userId}\'`  // SQL INJECTION!\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"command-injection-prevention",children:"Command Injection Prevention"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { execFile } from "child_process";\nimport { promisify } from "util";\n\nconst execFileAsync = promisify(execFile);\n\n// \u2705 Good: execFile with array arguments\nasync function runGitCommand(args: string[]) {\n  // Validate args don\'t contain shell metacharacters\n  for (const arg of args) {\n    if (/[;&|`$]/.test(arg)) {\n      throw new Error("Invalid characters in argument");\n    }\n  }\n\n  const { stdout } = await execFileAsync("git", args);\n  return stdout;\n}\n\n// \u274c BAD: exec with string\nimport { exec } from "child_process";\nexec(`git ${userInput}`);  // COMMAND INJECTION!\n'})}),"\n",(0,i.jsx)(n.h3,{id:"path-traversal-prevention",children:"Path Traversal Prevention"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import path from "path";\n\nfunction safePath(basePath: string, userPath: string): string {\n  const resolved = path.resolve(basePath, userPath);\n\n  // Ensure resolved path is within base\n  if (!resolved.startsWith(path.resolve(basePath))) {\n    throw new Error("Path traversal attempt detected");\n  }\n\n  return resolved;\n}\n\n// Usage\nconst filePath = safePath("/app/data", userSuppliedPath);\nawait fs.readFile(filePath);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"secret-management",children:"Secret Management"}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables-minimum",children:"Environment Variables (Minimum)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// config.ts\nfunction requireEnv(name: string): string {\n  const value = process.env[name];\n  if (!value) {\n    throw new Error(`Required environment variable ${name} is not set`);\n  }\n  return value;\n}\n\nexport const CONFIG = {\n  apiKey: requireEnv("SERVICE_API_KEY"),\n  dbUrl: requireEnv("DATABASE_URL"),\n  jwtSecret: requireEnv("JWT_SECRET"),\n};\n'})}),"\n",(0,i.jsx)(n.h3,{id:"secret-manager-integration",children:"Secret Manager Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { SecretManagerServiceClient } from "@google-cloud/secret-manager";\n\nconst client = new SecretManagerServiceClient();\n\nasync function getSecret(name: string): Promise<string> {\n  const [version] = await client.accessSecretVersion({\n    name: `projects/my-project/secrets/${name}/versions/latest`,\n  });\n\n  return version.payload?.data?.toString() || "";\n}\n\n// Cache secrets on startup\nlet cachedSecrets: Record<string, string> = {};\n\nasync function initializeSecrets(): Promise<void> {\n  const secretNames = ["API_KEY", "DB_PASSWORD", "JWT_SECRET"];\n\n  const results = await Promise.all(\n    secretNames.map(async (name) => [name, await getSecret(name)])\n  );\n\n  cachedSecrets = Object.fromEntries(results);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"secret-rotation",children:"Secret Rotation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class RotatingSecret {\n  private currentSecret: string;\n  private previousSecret: string | null = null;\n  private rotationInterval: NodeJS.Timeout;\n\n  constructor(\n    private fetchSecret: () => Promise<string>,\n    rotationMs: number = 3600000  // 1 hour\n  ) {\n    this.rotationInterval = setInterval(() => this.rotate(), rotationMs);\n  }\n\n  async initialize(): Promise<void> {\n    this.currentSecret = await this.fetchSecret();\n  }\n\n  private async rotate(): Promise<void> {\n    this.previousSecret = this.currentSecret;\n    this.currentSecret = await this.fetchSecret();\n\n    // Keep previous valid for grace period\n    setTimeout(() => {\n      this.previousSecret = null;\n    }, 60000);  // 1 minute grace\n  }\n\n  validate(token: string): boolean {\n    return token === this.currentSecret ||\n           (this.previousSecret && token === this.previousSecret);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limiting-implementation",children:"Rate Limiting Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"token-bucket-algorithm",children:"Token Bucket Algorithm"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class TokenBucket {\n  private tokens: number;\n  private lastRefill: number;\n\n  constructor(\n    private capacity: number,\n    private refillRate: number  // tokens per second\n  ) {\n    this.tokens = capacity;\n    this.lastRefill = Date.now();\n  }\n\n  consume(tokens: number = 1): boolean {\n    this.refill();\n\n    if (this.tokens >= tokens) {\n      this.tokens -= tokens;\n      return true;\n    }\n\n    return false;\n  }\n\n  private refill(): void {\n    const now = Date.now();\n    const elapsed = (now - this.lastRefill) / 1000;\n    const newTokens = elapsed * this.refillRate;\n\n    this.tokens = Math.min(this.capacity, this.tokens + newTokens);\n    this.lastRefill = now;\n  }\n}\n\n// Per-user buckets\nconst userBuckets = new Map<string, TokenBucket>();\n\nfunction getRateLimiter(userId: string): TokenBucket {\n  if (!userBuckets.has(userId)) {\n    userBuckets.set(userId, new TokenBucket(100, 10));  // 100 capacity, 10/sec\n  }\n  return userBuckets.get(userId)!;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sliding-window-counter",children:"Sliding Window Counter"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class SlidingWindowCounter {\n  private windows: Map<string, Map<number, number>> = new Map();\n\n  constructor(\n    private windowSizeMs: number,\n    private limit: number\n  ) {}\n\n  isAllowed(key: string): boolean {\n    const now = Date.now();\n    const windowStart = Math.floor(now / this.windowSizeMs) * this.windowSizeMs;\n    const prevWindowStart = windowStart - this.windowSizeMs;\n\n    let keyWindows = this.windows.get(key);\n    if (!keyWindows) {\n      keyWindows = new Map();\n      this.windows.set(key, keyWindows);\n    }\n\n    // Get counts\n    const currentCount = keyWindows.get(windowStart) || 0;\n    const prevCount = keyWindows.get(prevWindowStart) || 0;\n\n    // Weight previous window by overlap\n    const prevWeight = (this.windowSizeMs - (now - windowStart)) / this.windowSizeMs;\n    const totalCount = currentCount + Math.floor(prevCount * prevWeight);\n\n    if (totalCount >= this.limit) {\n      return false;\n    }\n\n    // Increment current window\n    keyWindows.set(windowStart, currentCount + 1);\n\n    // Cleanup old windows\n    for (const [windowTime] of keyWindows) {\n      if (windowTime < prevWindowStart) {\n        keyWindows.delete(windowTime);\n      }\n    }\n\n    return true;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"owasp-top-10-mitigations",children:"OWASP Top 10 Mitigations"}),"\n",(0,i.jsx)(n.h3,{id:"a01-broken-access-control",children:"A01: Broken Access Control"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Verify permissions on every request\nasync function checkPermission(\n  userId: string,\n  resource: string,\n  action: string\n): Promise<boolean> {\n  const permissions = await getPermissions(userId);\n  return permissions.includes(`${resource}:${action}`);\n}\n\n// In handler\nif (!await checkPermission(userId, "documents", "read")) {\n  throw new McpError(ErrorCode.InvalidRequest, "Access denied");\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"a02-cryptographic-failures",children:"A02: Cryptographic Failures"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { scrypt, randomBytes, timingSafeEqual } from "crypto";\nimport { promisify } from "util";\n\nconst scryptAsync = promisify(scrypt);\n\n// \u2705 Good: Use strong hashing\nasync function hashPassword(password: string): Promise<string> {\n  const salt = randomBytes(16).toString("hex");\n  const hash = await scryptAsync(password, salt, 64) as Buffer;\n  return `${salt}:${hash.toString("hex")}`;\n}\n\n// \u2705 Good: Timing-safe comparison\nasync function verifyPassword(password: string, stored: string): Promise<boolean> {\n  const [salt, hash] = stored.split(":");\n  const hashBuffer = Buffer.from(hash, "hex");\n  const suppliedHash = await scryptAsync(password, salt, 64) as Buffer;\n  return timingSafeEqual(hashBuffer, suppliedHash);\n}\n\n// \u274c BAD: Weak algorithms\nimport { createHash } from "crypto";\ncreateHash("md5").update(password).digest("hex");  // INSECURE!\n'})}),"\n",(0,i.jsx)(n.h3,{id:"a03-injection",children:"A03: Injection"}),"\n",(0,i.jsx)(n.p,{children:"See SQL and Command Injection sections above."}),"\n",(0,i.jsx)(n.h3,{id:"a05-security-misconfiguration",children:"A05: Security Misconfiguration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Validate all configuration\nfunction validateConfig(config: Config): void {\n  // No default credentials\n  if (config.adminPassword === "admin") {\n    throw new Error("Default admin password detected");\n  }\n\n  // HTTPS required in production\n  if (config.nodeEnv === "production" && !config.apiUrl.startsWith("https")) {\n    throw new Error("HTTPS required in production");\n  }\n\n  // Debug mode off in production\n  if (config.nodeEnv === "production" && config.debug) {\n    throw new Error("Debug mode must be off in production");\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"a10-server-side-request-forgery-ssrf",children:"A10: Server-Side Request Forgery (SSRF)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { URL } from "url";\nimport dns from "dns/promises";\n\nconst PRIVATE_RANGES = [\n  /^10\\./,\n  /^172\\.(1[6-9]|2[0-9]|3[01])\\./,\n  /^192\\.168\\./,\n  /^127\\./,\n  /^169\\.254\\./,\n  /^0\\./,\n];\n\nasync function safeFetch(urlString: string): Promise<Response> {\n  const url = new URL(urlString);\n\n  // Only allow HTTPS\n  if (url.protocol !== "https:") {\n    throw new Error("Only HTTPS URLs allowed");\n  }\n\n  // Resolve hostname and check for private IPs\n  const addresses = await dns.resolve4(url.hostname);\n  for (const addr of addresses) {\n    if (PRIVATE_RANGES.some(r => r.test(addr))) {\n      throw new Error("Private IP addresses not allowed");\n    }\n  }\n\n  // Allow-list domains if possible\n  const allowedDomains = ["api.example.com", "service.example.org"];\n  if (!allowedDomains.includes(url.hostname)) {\n    throw new Error("Domain not in allow list");\n  }\n\n  return fetch(urlString);\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling-security",children:"Error Handling Security"}),"\n",(0,i.jsx)(n.h3,{id:"sanitize-error-messages",children:"Sanitize Error Messages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'class SecureError extends Error {\n  constructor(\n    public userMessage: string,\n    public internalMessage: string,\n    public code: string\n  ) {\n    super(internalMessage);\n  }\n}\n\nfunction handleError(error: unknown): McpError {\n  // Log full error internally\n  console.error("Internal error:", error);\n\n  // Return safe message to user\n  if (error instanceof SecureError) {\n    return new McpError(ErrorCode.InternalError, error.userMessage);\n  }\n\n  if (error instanceof z.ZodError) {\n    return new McpError(\n      ErrorCode.InvalidParams,\n      "Invalid input parameters"  // Don\'t expose field names\n    );\n  }\n\n  // Generic error for unexpected cases\n  return new McpError(\n    ErrorCode.InternalError,\n    "An unexpected error occurred"\n  );\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"secure-logging",children:"Secure Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Redact sensitive fields\nfunction redactSensitive(obj: Record<string, unknown>): Record<string, unknown> {\n  const sensitiveFields = ["password", "token", "apiKey", "secret", "authorization"];\n  const redacted = { ...obj };\n\n  for (const field of sensitiveFields) {\n    if (field in redacted) {\n      redacted[field] = "[REDACTED]";\n    }\n  }\n\n  return redacted;\n}\n\n// Usage\nlogger.info({ args: redactSensitive(args) }, "Tool called");\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(96540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);