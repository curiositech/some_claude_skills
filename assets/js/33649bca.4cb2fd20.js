"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[20166],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},56728:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"skills/sobriety_tools_guardian/index","title":"Sobriety Tools Guardian","description":"Performance optimization and continuous improvement for sobriety.tools recovery app. Use for load time optimization, offline capability, crisis detection, performance monitoring, automated issue detection. Activate on \\"sobriety.tools\\", \\"recovery app perf\\", \\"crisis detection\\", \\"offline meetings\\", \\"HALT check-in\\", \\"sponsor contacts\\". NOT for general Next.js help, unrelated Cloudflare Workers, or non-recovery apps.","source":"@site/docs/skills/sobriety_tools_guardian/index.md","sourceDirName":"skills/sobriety_tools_guardian","slug":"/skills/sobriety_tools_guardian","permalink":"/docs/skills/sobriety_tools_guardian","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"name":"sobriety-tools-guardian","description":"Performance optimization and continuous improvement for sobriety.tools recovery app. Use for load time optimization, offline capability, crisis detection, performance monitoring, automated issue detection. Activate on \\"sobriety.tools\\", \\"recovery app perf\\", \\"crisis detection\\", \\"offline meetings\\", \\"HALT check-in\\", \\"sponsor contacts\\". NOT for general Next.js help, unrelated Cloudflare Workers, or non-recovery apps.","allowed-tools":"Read,Write,Edit,Bash,Grep,Glob,Task,WebFetch","slug":"/skills/sobriety_tools_guardian"}}');var t=i(74848),r=i(28453);const o={name:"sobriety-tools-guardian",description:'Performance optimization and continuous improvement for sobriety.tools recovery app. Use for load time optimization, offline capability, crisis detection, performance monitoring, automated issue detection. Activate on "sobriety.tools", "recovery app perf", "crisis detection", "offline meetings", "HALT check-in", "sponsor contacts". NOT for general Next.js help, unrelated Cloudflare Workers, or non-recovery apps.',"allowed-tools":"Read,Write,Edit,Bash,Grep,Glob,Task,WebFetch",slug:"/skills/sobriety_tools_guardian"},c="Sobriety Tools Guardian",a={},l=[{value:"Why Performance Is Life-or-Death",id:"why-performance-is-life-or-death",level:2},{value:"Stack-Specific Optimization Knowledge",id:"stack-specific-optimization-knowledge",level:2},{value:"Architecture (Know This Cold)",id:"architecture-know-this-cold",level:3},{value:"Critical Performance Paths",id:"critical-performance-paths",level:3},{value:"Offline-First Requirements (NON-NEGOTIABLE)",id:"offline-first-requirements-non-negotiable",level:3},{value:"Crisis Detection Patterns",id:"crisis-detection-patterns",level:2},{value:"Journal Sentiment Signals",id:"journal-sentiment-signals",level:3},{value:"Check-in Analysis",id:"check-in-analysis",level:3},{value:"Performance Monitoring &amp; Logging",id:"performance-monitoring--logging",level:2},{value:"Key Metrics to Track",id:"key-metrics-to-track",level:3},{value:"Automated Performance Regression Detection",id:"automated-performance-regression-detection",level:3},{value:"Automated Issue Detection &amp; Filing",id:"automated-issue-detection--filing",level:2},{value:"Background Performance Scanner",id:"background-performance-scanner",level:3},{value:"Common Anti-Patterns",id:"common-anti-patterns",level:2},{value:"1. Network-Blocking Contact Display",id:"1-network-blocking-contact-display",level:3},{value:"2. Uncached Meeting Searches",id:"2-uncached-meeting-searches",level:3},{value:"3. Large Bundle Blocking Interactivity",id:"3-large-bundle-blocking-interactivity",level:3},{value:"4. Synchronous Check-in Submission",id:"4-synchronous-check-in-submission",level:3},{value:"Performance Optimization Checklist",id:"performance-optimization-checklist",level:2},{value:"Before Every Deploy",id:"before-every-deploy",level:3},{value:"Weekly Audit",id:"weekly-audit",level:3},{value:"Monthly Deep Dive",id:"monthly-deep-dive",level:3},{value:"Scripts Available",id:"scripts-available",level:2},{value:"Integration Points",id:"integration-points",level:2},{value:"With meeting-harvester",id:"with-meeting-harvester",level:3},{value:"With check-in system",id:"with-check-in-system",level:3},{value:"With contacts/sponsors",id:"with-contactssponsors",level:3},{value:"When to Escalate",id:"when-to-escalate",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"sobriety-tools-guardian",children:"Sobriety Tools Guardian"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Mission"}),": Keep sobriety.tools fast enough to save lives. A fentanyl addict in crisis has seconds, not minutes. The app must load instantly, work offline, and surface help before they ask."]}),"\n",(0,t.jsx)(n.h2,{id:"why-performance-is-life-or-death",children:"Why Performance Is Life-or-Death"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CRISIS TIMELINE:\n0-30 seconds:  User opens app in distress\n30-60 seconds: Looking for sponsor number or meeting\n60-120 seconds: Decision point - call someone or use\n2+ minutes:    If still searching, may give up\n\nEVERY SECOND OF LOAD TIME = LIVES AT RISK\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Core truth"}),": This isn't a business app. Slow performance isn't \"bad UX\" - it's abandonment during crisis. The user staring at a spinner might be deciding whether to live or die."]}),"\n",(0,t.jsx)(n.h2,{id:"stack-specific-optimization-knowledge",children:"Stack-Specific Optimization Knowledge"}),"\n",(0,t.jsx)(n.h3,{id:"architecture-know-this-cold",children:"Architecture (Know This Cold)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Next.js 15 (static export) \u2192 Cloudflare Pages\n    \u2193\nSupabase (PostgREST + PostGIS)\n    \u2193\nCloudflare Workers:\n  - meeting-proxy (KV cached, geohash-based)\n  - meeting-harvester (hourly cron)\n  - claude-api (AI features)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"critical-performance-paths",children:"Critical Performance Paths"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Meeting Search (MUST be <500ms)"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"User location \u2192 Geohash (3-char ~150km cell)\n    \u2192 KV cache lookup (edge, ~5ms)\n    \u2192 Cache HIT: Return immediately\n    \u2192 Cache MISS: Supabase RPC find_current_meetings\n        \u2192 PostGIS ST_DWithin query\n        \u2192 Store in KV, return\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Bottleneck"}),": Cold Supabase queries. ",(0,t.jsx)(n.strong,{children:"Fix"}),": Pre-warm top 30 metros via /warm endpoint."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Sponsor/Contact List (MUST be <200ms)"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"User opens contacts \u2192 Local IndexedDB first\n    \u2192 Show cached contacts instantly\n    \u2192 Background sync with Supabase\n    \u2192 Update UI if changes\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Anti-pattern"}),": Waiting for network before showing contacts. In crisis, show stale data immediately."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Check-in Flow (MUST be <100ms to first input)"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Open check-in \u2192 Pre-rendered form shell\n    \u2192 Load previous patterns async\n    \u2192 Submit optimistically\n"})}),"\n",(0,t.jsx)(n.h3,{id:"offline-first-requirements-non-negotiable",children:"Offline-First Requirements (NON-NEGOTIABLE)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Service Worker must cache:\nconst CRISIS_CRITICAL = [\n  '/contacts',           // Sponsor phone numbers\n  '/safety-plan',        // User's safety plan\n  '/meetings?saved=true', // Saved meetings list\n  '/crisis',             // Crisis resources page\n];\n\n// These MUST work with zero network:\n// 1. View sponsor contacts\n// 2. View safety plan\n// 3. View saved meetings (even if stale)\n// 4. Record check-in (sync when online)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"crisis-detection-patterns",children:"Crisis Detection Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"journal-sentiment-signals",children:"Journal Sentiment Signals"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// RED FLAGS (surface help proactively):\nconst CRISIS_INDICATORS = {\n  anger_spike: 'HALT angry score jumps 3+ points',\n  ex_mentions: 'Mentions ex-partner 3+ times in week',\n  isolation: 'No check-ins for 3+ days after daily streak',\n  time_distortion: 'Check-ins at unusual hours (2-5am)',\n  negative_spiral: 'Consecutive declining mood scores',\n};\n\n// When detected: Surface sponsor contact, safety plan link\n// DO NOT: Be preachy or alarming. Gentle nudge only.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"check-in-analysis",children:"Check-in Analysis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Detect concerning patterns\nSELECT user_id,\n  AVG(angry_score) as avg_anger,\n  AVG(angry_score) FILTER (WHERE created_at > NOW() - INTERVAL '3 days') as recent_anger,\n  COUNT(*) FILTER (WHERE EXTRACT(HOUR FROM created_at) BETWEEN 2 AND 5) as late_night_checkins\nFROM daily_checkins\nWHERE created_at > NOW() - INTERVAL '30 days'\nGROUP BY user_id\nHAVING AVG(angry_score) FILTER (WHERE created_at > NOW() - INTERVAL '3 days') >\n       AVG(angry_score) + 2;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"performance-monitoring--logging",children:"Performance Monitoring & Logging"}),"\n",(0,t.jsx)(n.h3,{id:"key-metrics-to-track",children:"Key Metrics to Track"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Client-side (log to analytics)\nconst PERF_METRICS = {\n  ttfb: 'Time to First Byte',\n  fcp: 'First Contentful Paint',\n  lcp: 'Largest Contentful Paint',\n  tti: 'Time to Interactive',\n\n  // App-specific critical paths\n  contacts_visible: 'Time until sponsor list renders',\n  meeting_results: 'Time until first meeting card shows',\n  checkin_interactive: 'Time until check-in form accepts input',\n};\n\n// Log slow paths\nif (contactsVisibleTime > 500) {\n  logPerf('contacts_slow', { duration: contactsVisibleTime, network: navigator.connection?.effectiveType });\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"automated-performance-regression-detection",children:"Automated Performance Regression Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# scripts/perf-audit.sh - Run in CI\nlighthouse https://sobriety.tools/meetings --output=json --output-path=./perf.json\nSCORE=$(jq \'.categories.performance.score\' perf.json)\nif (( $(echo "$SCORE < 0.9" | bc -l) )); then\n  echo "Performance regression: $SCORE"\n  # Create GitHub issue automatically\nfi\n'})}),"\n",(0,t.jsx)(n.h2,{id:"automated-issue-detection--filing",children:"Automated Issue Detection & Filing"}),"\n",(0,t.jsx)(n.h3,{id:"background-performance-scanner",children:"Background Performance Scanner"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Run hourly via Cloudflare Worker cron\nasync function performanceAudit() {\n  const checks = [\n    checkMeetingCacheHealth(),\n    checkSupabaseQueryTimes(),\n    checkStaticAssetSizes(),\n    checkServiceWorkerCoverage(),\n  ];\n\n  const issues = await Promise.all(checks);\n  const problems = issues.flat().filter(i => i.severity === 'high');\n\n  for (const problem of problems) {\n    await createGitHubIssue({\n      title: `[Auto] Perf: ${problem.title}`,\n      body: problem.description + '\\n\\n' + problem.suggestedFix,\n      labels: ['performance', 'automated'],\n    });\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-anti-patterns",children:"Common Anti-Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"1-network-blocking-contact-display",children:"1. Network-Blocking Contact Display"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Symptom"}),": Contacts page shows spinner while fetching\n",(0,t.jsx)(n.strong,{children:"Problem"}),": User in crisis sees loading state instead of sponsor number\n",(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// WRONG\nconst { data: contacts } = useQuery(['contacts'], fetchContacts);\n\n// RIGHT\nconst { data: contacts } = useQuery(['contacts'], fetchContacts, {\n  initialData: () => getCachedContacts(), // IndexedDB\n  staleTime: Infinity, // Never refetch automatically\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-uncached-meeting-searches",children:"2. Uncached Meeting Searches"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Symptom"}),": Every search hits Supabase\n",(0,t.jsx)(n.strong,{children:"Problem"}),": 200-500ms latency on every search\n",(0,t.jsx)(n.strong,{children:"Solution"}),": Geohash-based KV caching (already implemented in meeting-proxy)"]}),"\n",(0,t.jsx)(n.h3,{id:"3-large-bundle-blocking-interactivity",children:"3. Large Bundle Blocking Interactivity"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Symptom"}),": High TTI despite fast TTFB\n",(0,t.jsx)(n.strong,{children:"Problem"}),": JavaScript bundle blocks main thread\n",(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Lazy load non-critical features\nconst JournalAI = dynamic(() => import('./JournalAI'), { ssr: false });\nconst Charts = dynamic(() => import('./Charts'), { loading: () => <ChartSkeleton /> });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-synchronous-check-in-submission",children:"4. Synchronous Check-in Submission"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Symptom"}),": Button stays disabled during network request\n",(0,t.jsx)(n.strong,{children:"Problem"}),": User thinks it didn't work, closes app\n",(0,t.jsx)(n.strong,{children:"Solution"}),": Optimistic UI + background sync queue"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-optimization-checklist",children:"Performance Optimization Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"before-every-deploy",children:"Before Every Deploy"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Bundle size delta < 5KB"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","No new synchronous network calls in critical paths"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Lighthouse performance score >= 90"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Offline mode tested (disable network in DevTools)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"weekly-audit",children:"Weekly Audit"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Review slow query logs in Supabase"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Check KV cache hit rate (should be >80%)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Analyze Real User Metrics (RUM) for P95 load times"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test on 3G throttled connection"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"monthly-deep-dive",children:"Monthly Deep Dive"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Profile React renders (why did this re-render?)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Audit third-party scripts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Review and prune unused dependencies"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test crisis flows end-to-end on real device"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"scripts-available",children:"Scripts Available"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Script"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scripts/perf-audit.ts"})}),(0,t.jsx)(n.td,{children:"Run Lighthouse + custom checks, file issues"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scripts/cache-health.ts"})}),(0,t.jsx)(n.td,{children:"Check KV cache hit rates and staleness"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scripts/crisis-path-test.ts"})}),(0,t.jsx)(n.td,{children:"Automated test of crisis-critical flows"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scripts/bundle-analyzer.ts"})}),(0,t.jsx)(n.td,{children:"Track bundle size over time"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"integration-points",children:"Integration Points"}),"\n",(0,t.jsx)(n.h3,{id:"with-meeting-harvester",children:"With meeting-harvester"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"After harvest, warm cache for top metros"}),"\n",(0,t.jsx)(n.li,{children:"Monitor harvest duration and meeting counts"}),"\n",(0,t.jsx)(n.li,{children:"Alert if harvest fails (stale data = wrong meeting times)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"with-check-in-system",children:"With check-in system"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Analyze patterns for crisis detection"}),"\n",(0,t.jsx)(n.li,{children:"Track submission success rate"}),"\n",(0,t.jsx)(n.li,{children:"Monitor offline queue depth"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"with-contactssponsors",children:"With contacts/sponsors"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure offline availability"}),"\n",(0,t.jsx)(n.li,{children:"Track time-to-display"}),"\n",(0,t.jsx)(n.li,{children:"Monitor sync failures"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"when-to-escalate",children:"When to Escalate"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"File GitHub issue immediately if:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Lighthouse score drops below 85"}),"\n",(0,t.jsx)(n.li,{children:"P95 meeting search > 1 second"}),"\n",(0,t.jsx)(n.li,{children:"Contacts page has any loading state > 200ms"}),"\n",(0,t.jsx)(n.li,{children:"Service Worker fails to cache crisis pages"}),"\n",(0,t.jsx)(n.li,{children:'Any user-reported "couldn\'t load" during crisis hours (evenings/weekends)'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"This is a recovery app. Performance isn't a feature - it's the difference between someone getting help and someone dying alone."})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);