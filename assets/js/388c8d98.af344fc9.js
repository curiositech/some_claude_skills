"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[19162],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}},44926:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"skills/design_justice/references/offline-first-patterns","title":"Offline-First Patterns for Intermittent Access","description":"The Problem","source":"@site/docs/skills/design_justice/references/offline-first-patterns.md","sourceDirName":"skills/design_justice/references","slug":"/skills/design_justice/references/offline-first-patterns","permalink":"/docs/skills/design_justice/references/offline-first-patterns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Offline-First Patterns for Intermittent Access","sidebar_label":"Offline-First Patterns for ...","sidebar_position":3}}');var i=t(74848),a=t(28453);const r={title:"Offline-First Patterns for Intermittent Access",sidebar_label:"Offline-First Patterns for ...",sidebar_position:3},o="Offline-First Patterns for Intermittent Access",l={},c=[{value:"The Problem",id:"the-problem",level:2},{value:"Pattern: Auto-Save Everything",id:"pattern-auto-save-everything",level:2},{value:"Implementation",id:"implementation",level:3},{value:"Usage in Forms",id:"usage-in-forms",level:3},{value:"Pattern: Visible Sync Status",id:"pattern-visible-sync-status",level:2},{value:"The Status Indicator",id:"the-status-indicator",level:3},{value:"Placement",id:"placement",level:3},{value:"Pattern: Background Sync",id:"pattern-background-sync",level:2},{value:"Service Worker Setup",id:"service-worker-setup",level:3},{value:"Registering Sync",id:"registering-sync",level:3},{value:"Pattern: Progressive Enhancement",id:"pattern-progressive-enhancement",level:2},{value:"Text-First Views",id:"text-first-views",level:3},{value:"Low-Bandwidth Mode",id:"low-bandwidth-mode",level:3},{value:"Pattern: Resume Anywhere",id:"pattern-resume-anywhere",level:2},{value:"Session Persistence",id:"session-persistence",level:3},{value:"&quot;Continue Where You Left Off&quot; UI",id:"continue-where-you-left-off-ui",level:3},{value:"Pattern: Offline Page",id:"pattern-offline-page",level:2},{value:"Graceful Degradation",id:"graceful-degradation",level:3},{value:"Testing Checklist",id:"testing-checklist",level:2},{value:"Anti-Patterns to Avoid",id:"anti-patterns-to-avoid",level:2},{value:"\u274c &quot;Please Connect to Internet&quot;",id:"-please-connect-to-internet",level:3},{value:"\u274c Silent Data Loss",id:"-silent-data-loss",level:3},{value:"\u274c Required Real-Time Validation",id:"-required-real-time-validation",level:3},{value:"\u274c Session Timeouts Without Warning",id:"-session-timeouts-without-warning",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"offline-first-patterns-for-intermittent-access",children:"Offline-First Patterns for Intermittent Access"})}),"\n",(0,i.jsx)(n.h2,{id:"the-problem",children:"The Problem"}),"\n",(0,i.jsx)(n.p,{children:"Traditional web apps assume:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Stable, always-on internet"}),"\n",(0,i.jsx)(n.li,{children:"Users can retry failed requests"}),"\n",(0,i.jsx)(n.li,{children:"Sessions complete in one sitting"}),"\n",(0,i.jsx)(n.li,{children:"Form state survives page refreshes"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Reality for vulnerable populations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Public library computers have 30-60 minute session limits"}),"\n",(0,i.jsx)(n.li,{children:"Mobile data runs out mid-month"}),"\n",(0,i.jsx)(n.li,{children:"Shelter wifi is unreliable and shared"}),"\n",(0,i.jsx)(n.li,{children:"Users may have ONE chance to complete a critical form"}),"\n",(0,i.jsx)(n.li,{children:"Internet cafes charge by the minute"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pattern-auto-save-everything",children:"Pattern: Auto-Save Everything"}),"\n",(0,i.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// hooks/useAutoSave.ts\nimport { useEffect, useMemo, useCallback } from 'react';\n\ninterface SavedState<T> {\n  data: T;\n  savedAt: string;\n  synced: boolean;\n  version: number;\n}\n\nexport function useAutoSave<T>(\n  key: string,\n  data: T,\n  options: { debounceMs?: number } = {}\n) {\n  const { debounceMs = 500 } = options;\n\n  // Save on every change (debounced)\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      const state: SavedState<T> = {\n        data,\n        savedAt: new Date().toISOString(),\n        synced: navigator.onLine,\n        version: Date.now()\n      };\n      localStorage.setItem(key, JSON.stringify(state));\n    }, debounceMs);\n\n    return () => clearTimeout(timeout);\n  }, [key, data, debounceMs]);\n\n  // Restore saved data on mount\n  const savedData = useMemo(() => {\n    try {\n      const saved = localStorage.getItem(key);\n      if (saved) {\n        const parsed: SavedState<T> = JSON.parse(saved);\n        return parsed.data;\n      }\n    } catch {\n      // Corrupted data - start fresh\n    }\n    return null;\n  }, [key]);\n\n  // Clear saved data\n  const clearSaved = useCallback(() => {\n    localStorage.removeItem(key);\n  }, [key]);\n\n  return { savedData, clearSaved };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"usage-in-forms",children:"Usage in Forms"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"function ExpungementWizard() {\n  const [formData, setFormData] = useState<WizardData>(initialData);\n\n  // Auto-save to localStorage\n  const { savedData, clearSaved } = useAutoSave(\n    'expungement-wizard-progress',\n    formData\n  );\n\n  // Restore on mount\n  useEffect(() => {\n    if (savedData) {\n      setFormData(savedData);\n      // Show \"Welcome back\" message\n    }\n  }, []);\n\n  // On successful submission\n  const handleSubmit = async () => {\n    await submitForm(formData);\n    clearSaved(); // Only clear after confirmed submission\n  };\n\n  return (/* ... */);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-visible-sync-status",children:"Pattern: Visible Sync Status"}),"\n",(0,i.jsx)(n.h3,{id:"the-status-indicator",children:"The Status Indicator"}),"\n",(0,i.jsx)(n.p,{children:"Users need to know their data is safe. Always show sync status."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// components/SyncStatus.tsx\ninterface SyncStatusProps {\n  status: 'saved' | 'saving' | 'synced' | 'offline' | 'error';\n  lastSaved?: Date;\n}\n\nexport function SyncStatus({ status, lastSaved }: SyncStatusProps) {\n  const messages = {\n    saved: '\u2713 Saved to this device',\n    saving: 'Saving...',\n    synced: '\u2713 Up to date',\n    offline: '\u26a1 Saved locally (will sync when online)',\n    error: '\u26a0 Save failed - trying again...'\n  };\n\n  const colors = {\n    saved: 'text-olive',      // Green-ish\n    saving: 'text-mustard',   // Yellow\n    synced: 'text-olive',\n    offline: 'text-burnt-orange',\n    error: 'text-terracotta'  // Not aggressive red\n  };\n\n  return (\n    <div className={`text-sm ${colors[status]} flex items-center gap-2`}>\n      <span>{messages[status]}</span>\n      {lastSaved && status !== 'saving' && (\n        <span className=\"text-brown/60\">\n          ({formatTimeAgo(lastSaved)})\n        </span>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"placement",children:"Placement"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always visible"})," during form filling (sticky header or footer)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not dismissible"})," - users shouldn't be able to hide it"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Calm colors"})," - no alarming red unless truly critical"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pattern-background-sync",children:"Pattern: Background Sync"}),"\n",(0,i.jsx)(n.h3,{id:"service-worker-setup",children:"Service Worker Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// sw.ts (Service Worker)\nconst CACHE_NAME = 'expungement-guide-v1';\nconst SYNC_TAG = 'form-sync';\n\n// Cache critical assets\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(CACHE_NAME).then((cache) => {\n      return cache.addAll([\n        '/',\n        '/eligibility',\n        '/offline.html',\n        // Critical CSS and JS\n      ]);\n    })\n  );\n});\n\n// Handle offline navigation\nself.addEventListener('fetch', (event) => {\n  if (event.request.mode === 'navigate') {\n    event.respondWith(\n      fetch(event.request).catch(() => {\n        return caches.match('/offline.html');\n      })\n    );\n  }\n});\n\n// Background sync when connection returns\nself.addEventListener('sync', (event) => {\n  if (event.tag === SYNC_TAG) {\n    event.waitUntil(syncPendingForms());\n  }\n});\n\nasync function syncPendingForms() {\n  const pending = await getPendingSubmissions();\n  for (const submission of pending) {\n    try {\n      await fetch('/api/submit', {\n        method: 'POST',\n        body: JSON.stringify(submission.data)\n      });\n      await markAsSynced(submission.id);\n    } catch {\n      // Will retry on next sync event\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"registering-sync",children:"Registering Sync"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// When user submits form offline\nasync function submitForm(data: FormData) {\n  if (navigator.onLine) {\n    // Direct submission\n    return await fetch('/api/submit', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    });\n  } else {\n    // Queue for background sync\n    await saveToIndexedDB('pending-submissions', {\n      data,\n      timestamp: Date.now()\n    });\n\n    // Register sync (will fire when online)\n    const registration = await navigator.serviceWorker.ready;\n    await registration.sync.register('form-sync');\n\n    return { queued: true };\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-progressive-enhancement",children:"Pattern: Progressive Enhancement"}),"\n",(0,i.jsx)(n.h3,{id:"text-first-views",children:"Text-First Views"}),"\n",(0,i.jsx)(n.p,{children:"Provide critical information without requiring JavaScript or heavy assets."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// pages/[state]/index.tsx\nexport default function StatePage({ state }) {\n  return (\n    <article>\n      {/* Critical info loads immediately, no JS needed */}\n      <h1>{state.name} Expungement Guide</h1>\n      <p>{state.summary.overview}</p>\n\n      {/* Key eligibility info in plain text */}\n      <section>\n        <h2>Am I Eligible?</h2>\n        <ul>\n          {state.eligibilityCriteria.map(c => (\n            <li key={c}>{c}</li>\n          ))}\n        </ul>\n      </section>\n\n      {/* Interactive wizard loads after */}\n      <Suspense fallback={<p>Loading interactive guide...</p>}>\n        <EligibilityWizard state={state} />\n      </Suspense>\n    </article>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"low-bandwidth-mode",children:"Low-Bandwidth Mode"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Detect slow connections\nfunction useConnectionQuality() {\n  const [quality, setQuality] = useState<'fast' | 'slow' | 'offline'>('fast');\n\n  useEffect(() => {\n    const connection = (navigator as any).connection;\n\n    function updateQuality() {\n      if (!navigator.onLine) {\n        setQuality('offline');\n      } else if (connection?.effectiveType === '2g' ||\n                 connection?.effectiveType === 'slow-2g') {\n        setQuality('slow');\n      } else {\n        setQuality('fast');\n      }\n    }\n\n    updateQuality();\n    connection?.addEventListener('change', updateQuality);\n    window.addEventListener('online', updateQuality);\n    window.addEventListener('offline', updateQuality);\n\n    return () => {\n      connection?.removeEventListener('change', updateQuality);\n      window.removeEventListener('online', updateQuality);\n      window.removeEventListener('offline', updateQuality);\n    };\n  }, []);\n\n  return quality;\n}\n\n// Conditional rendering based on connection\nfunction ImageOrPlaceholder({ src, alt, lowBandwidthText }) {\n  const quality = useConnectionQuality();\n\n  if (quality === 'slow' || quality === 'offline') {\n    return <div className=\"bg-cream p-4 text-center\">{lowBandwidthText}</div>;\n  }\n\n  return <img src={src} alt={alt} loading=\"lazy\" />;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-resume-anywhere",children:"Pattern: Resume Anywhere"}),"\n",(0,i.jsx)(n.h3,{id:"session-persistence",children:"Session Persistence"}),"\n",(0,i.jsx)(n.p,{children:"Multi-step flows must survive browser crashes, session timeouts, and device switches."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Save current step and all answers\ninterface WizardSession {\n  currentStep: number;\n  totalSteps: number;\n  answers: Record<string, any>;\n  startedAt: string;\n  lastActivityAt: string;\n  completedSteps: number[];\n}\n\nfunction saveWizardSession(session: WizardSession) {\n  // Save to localStorage (immediate)\n  localStorage.setItem('wizard-session', JSON.stringify(session));\n\n  // Also save to server if logged in (background)\n  if (user.isAuthenticated) {\n    queueSync('wizard-session', session);\n  }\n}\n\n// Restore session with merge strategy\nfunction restoreWizardSession(): WizardSession | null {\n  const local = localStorage.getItem('wizard-session');\n  const server = user.isAuthenticated ? await fetchServerSession() : null;\n\n  if (!local && !server) return null;\n  if (!server) return JSON.parse(local);\n  if (!local) return server;\n\n  // Merge: use whichever is more recent\n  const localSession = JSON.parse(local);\n  return new Date(localSession.lastActivityAt) > new Date(server.lastActivityAt)\n    ? localSession\n    : server;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"continue-where-you-left-off-ui",children:'"Continue Where You Left Off" UI'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'function WizardEntry() {\n  const [existingSession, setExistingSession] = useState<WizardSession | null>(null);\n\n  useEffect(() => {\n    const session = restoreWizardSession();\n    if (session) setExistingSession(session);\n  }, []);\n\n  if (existingSession) {\n    return (\n      <div className="bg-cream p-6 rounded-lg border border-mustard">\n        <h2 className="text-lg font-semibold text-brown">\n          Welcome Back!\n        </h2>\n        <p className="mt-2 text-brown/80">\n          You were on step {existingSession.currentStep} of {existingSession.totalSteps}.\n          Would you like to continue?\n        </p>\n        <div className="mt-4 flex gap-4">\n          <button\n            onClick={() => resumeSession(existingSession)}\n            className="px-4 py-2 bg-burnt-orange text-cream rounded"\n          >\n            Continue Where I Left Off\n          </button>\n          <button\n            onClick={() => {\n              clearSession();\n              setExistingSession(null);\n            }}\n            className="px-4 py-2 border border-brown text-brown rounded"\n          >\n            Start Over\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return <WizardStart />;\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-offline-page",children:"Pattern: Offline Page"}),"\n",(0,i.jsx)(n.h3,{id:"graceful-degradation",children:"Graceful Degradation"}),"\n",(0,i.jsx)(n.p,{children:"When offline, show helpful information instead of an error."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'\x3c!-- public/offline.html --\x3e\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>Offline - National Expungement Guide</title>\n  <style>\n    body {\n      font-family: system-ui, sans-serif;\n      background: #f5f0e6;\n      color: #4a3728;\n      padding: 2rem;\n      max-width: 600px;\n      margin: 0 auto;\n    }\n    h1 { color: #2d3d28; }\n    .tip {\n      background: #fff;\n      border-left: 4px solid #d4a03a;\n      padding: 1rem;\n      margin: 1rem 0;\n    }\n  </style>\n</head>\n<body>\n  <h1>You\'re Offline</h1>\n  <p>Don\'t worry - your progress has been saved to this device.</p>\n\n  <div class="tip">\n    <strong>What you can still do:</strong>\n    <ul>\n      <li>Your form answers are saved</li>\n      <li>When you\'re back online, everything will sync</li>\n      <li>Downloaded PDFs are still available</li>\n    </ul>\n  </div>\n\n  <div class="tip">\n    <strong>To get back online:</strong>\n    <ul>\n      <li>Check your wifi or mobile data connection</li>\n      <li>If at a library, the session may have expired</li>\n      <li>Try refreshing this page when connected</li>\n    </ul>\n  </div>\n\n  <p>\n    <strong>Need help now?</strong> Call 211 for local assistance or\n    visit your local legal aid office in person.\n  </p>\n</body>\n</html>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u25a1 App works with airplane mode enabled\n\u25a1 Form data survives browser crash (close tab mid-form)\n\u25a1 "Saved" indicator visible at all times during form filling\n\u25a1 Works on 2G connection speed (Chrome DevTools throttling)\n\u25a1 Service worker caches critical pages\n\u25a1 Background sync queues submissions when offline\n\u25a1 "Resume" prompt appears when returning to incomplete form\n\u25a1 Offline page is helpful, not just an error\n\u25a1 No data loss tested: fill form, disconnect, reconnect, submit\n\u25a1 IndexedDB storage doesn\'t exceed reasonable limits (~50MB)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"anti-patterns-to-avoid",children:"Anti-Patterns to Avoid"}),"\n",(0,i.jsx)(n.h3,{id:"-please-connect-to-internet",children:'\u274c "Please Connect to Internet"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// WRONG - Unhelpful\nif (!navigator.onLine) {\n  return <div>Please connect to the internet to continue.</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-silent-data-loss",children:"\u274c Silent Data Loss"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// WRONG - Data lost on navigation\nfunction Form() {\n  const [data, setData] = useState({});\n  // No persistence! User loses everything if they navigate away\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-required-real-time-validation",children:"\u274c Required Real-Time Validation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// WRONG - Blocks offline users\nasync function validateField(value) {\n  const response = await fetch('/api/validate', { body: value });\n  // Fails offline - user can't proceed\n}\n\n// RIGHT - Client-side validation with server enhancement\nfunction validateField(value) {\n  // Basic validation always works\n  if (!value) return 'Required';\n  if (value.length < 3) return 'Too short';\n\n  // Enhanced validation when online (non-blocking)\n  if (navigator.onLine) {\n    queueServerValidation(value);\n  }\n\n  return null; // Valid for now\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-session-timeouts-without-warning",children:"\u274c Session Timeouts Without Warning"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// WRONG - Surprise timeout\nsetTimeout(() => {\n  logout();\n  redirect('/');\n}, 30 * 60 * 1000); // 30 min timeout, no warning\n\n// RIGHT - Warning before timeout\nsetTimeout(() => {\n  showModal({\n    title: \"Session Expiring\",\n    message: \"You've been inactive. Your progress is saved. \" +\n             \"Click 'Continue' to keep working.\",\n    actions: [\n      { label: 'Continue', onClick: extendSession },\n      { label: 'Save & Exit', onClick: saveAndLogout }\n    ]\n  });\n}, 25 * 60 * 1000); // Warn at 25 min\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);