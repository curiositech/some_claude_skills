"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[23620],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(96540);const a={},r=t.createContext(a);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},84596:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"skills/recovery_social_features/references/messaging","title":"Safe Messaging","description":"Recovery-appropriate messaging with crisis detection and safety features.","source":"@site/docs/skills/recovery_social_features/references/messaging.md","sourceDirName":"skills/recovery_social_features/references","slug":"/skills/recovery_social_features/references/messaging","permalink":"/docs/skills/recovery_social_features/references/messaging","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Safe Messaging","sidebar_label":"Safe Messaging","sidebar_position":4}}');var a=s(74848),r=s(28453);const i={title:"Safe Messaging",sidebar_label:"Safe Messaging",sidebar_position:4},o="Safe Messaging",c={},d=[{value:"useMessages Hook",id:"usemessages-hook",level:2},{value:"Message Input with Crisis Detection",id:"message-input-with-crisis-detection",level:2},{value:"Crisis Keywords List",id:"crisis-keywords-list",level:2},{value:"Best Practices",id:"best-practices",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"safe-messaging",children:"Safe Messaging"})}),"\n",(0,a.jsx)(n.p,{children:"Recovery-appropriate messaging with crisis detection and safety features."}),"\n",(0,a.jsx)(n.h2,{id:"usemessages-hook",children:"useMessages Hook"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// hooks/useMessages.ts\n'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/supabase';\n\ninterface Message {\n  id: string;\n  senderId: string;\n  senderName: string;\n  content: string;\n  createdAt: string;\n  isOwn: boolean;\n}\n\nexport function useMessages(conversationId: string) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const loadMessages = useCallback(async () => {\n    const userId = (await supabase.auth.getUser()).data.user?.id;\n\n    const { data } = await supabase\n      .from('messages')\n      .select(`\n        id,\n        content,\n        created_at,\n        sender_id,\n        sender:profiles!sender_id(display_name)\n      `)\n      .eq('conversation_id', conversationId)\n      .is('deleted_at', null)\n      .order('created_at', { ascending: true });\n\n    if (data) {\n      setMessages(data.map((m) => ({\n        id: m.id,\n        senderId: m.sender_id,\n        senderName: m.sender.display_name,\n        content: m.content,\n        createdAt: m.created_at,\n        isOwn: m.sender_id === userId,\n      })));\n    }\n    setIsLoading(false);\n  }, [conversationId]);\n\n  useEffect(() => {\n    loadMessages();\n\n    // Real-time subscription\n    const subscription = supabase\n      .channel(`messages:${conversationId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'messages',\n          filter: `conversation_id=eq.${conversationId}`,\n        },\n        async (payload) => {\n          const userId = (await supabase.auth.getUser()).data.user?.id;\n          const { data: sender } = await supabase\n            .from('profiles')\n            .select('display_name')\n            .eq('id', payload.new.sender_id)\n            .single();\n\n          setMessages((prev) => [\n            ...prev,\n            {\n              id: payload.new.id,\n              senderId: payload.new.sender_id,\n              senderName: sender?.display_name || 'Unknown',\n              content: payload.new.content,\n              createdAt: payload.new.created_at,\n              isOwn: payload.new.sender_id === userId,\n            },\n          ]);\n        }\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [conversationId, loadMessages]);\n\n  const sendMessage = async (content: string) => {\n    const userId = (await supabase.auth.getUser()).data.user?.id;\n\n    await supabase.from('messages').insert({\n      conversation_id: conversationId,\n      sender_id: userId,\n      content,\n    });\n  };\n\n  return { messages, sendMessage, isLoading };\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"message-input-with-crisis-detection",children:"Message Input with Crisis Detection"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// components/MessageInput.tsx\n'use client';\n\nimport { useState, useRef } from 'react';\n\ninterface Props {\n  onSend: (content: string) => void;\n  placeholder?: string;\n}\n\n// Crisis keywords that should show resources\nconst CRISIS_KEYWORDS = [\n  'suicide', 'kill myself', 'want to die', 'end it all',\n  'relapse', 'using again', 'fell off the wagon',\n];\n\nexport function MessageInput({ onSend, placeholder = \"Type a message...\" }: Props) {\n  const [value, setValue] = useState('');\n  const [showCrisisPrompt, setShowCrisisPrompt] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const checkForCrisisKeywords = (text: string) => {\n    const lower = text.toLowerCase();\n    return CRISIS_KEYWORDS.some((kw) => lower.includes(kw));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setValue(newValue);\n\n    // Show crisis resources if needed\n    if (checkForCrisisKeywords(newValue)) {\n      setShowCrisisPrompt(true);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (value.trim()) {\n      onSend(value.trim());\n      setValue('');\n      setShowCrisisPrompt(false);\n    }\n  };\n\n  return (\n    <div>\n      {showCrisisPrompt && (\n        <div className=\"mb-2 p-3 bg-red-900/30 border border-red-700 rounded-lg\">\n          <p className=\"text-sm text-red-300 mb-2\">\n            It sounds like you might be going through a hard time.\n          </p>\n          <a\n            href=\"/crisis\"\n            className=\"text-sm text-red-400 underline\"\n          >\n            Tap here for crisis resources \u2192\n          </a>\n        </div>\n      )}\n\n      <form onSubmit={handleSubmit} className=\"flex gap-2\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={value}\n          onChange={handleChange}\n          placeholder={placeholder}\n          className=\"flex-1 px-4 py-3 bg-leather-800 rounded\"\n        />\n        <button\n          type=\"submit\"\n          disabled={!value.trim()}\n          className=\"px-4 py-3 bg-ember-500 rounded min-h-[44px] disabled:opacity-50\"\n        >\n          Send\n        </button>\n      </form>\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"crisis-keywords-list",children:"Crisis Keywords List"}),"\n",(0,a.jsx)(n.p,{children:"Keywords that trigger crisis resource prompts:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const CRISIS_KEYWORDS = [\n  // Suicidal ideation\n  'suicide', 'kill myself', 'want to die', 'end it all',\n  // Relapse indicators\n  'relapse', 'using again', 'fell off the wagon',\n  // Self-harm\n  'hurt myself', 'cutting', 'self-harm',\n];\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Non-blocking"})," - Crisis prompts suggest resources, don't block messages"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Privacy-first"})," - Don't log or report crisis keywords automatically"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Helpful tone"})," - Gentle, non-judgmental language"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Direct resources"})," - Link to crisis page, not external sites"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Offline capable"})," - Cache crisis resources for offline access"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);