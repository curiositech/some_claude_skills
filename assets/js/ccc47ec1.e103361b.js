"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[26540],{28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>a});var t=s(96540);const i={},r=t.createContext(i);function d(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:n},e.children)}},81749:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"skills/recovery_social_features/references/friendships","title":"Friend Connections","description":"Peer-to-peer connections with mutual consent and real-time updates.","source":"@site/docs/skills/recovery_social_features/references/friendships.md","sourceDirName":"skills/recovery_social_features/references","slug":"/skills/recovery_social_features/references/friendships","permalink":"/docs/skills/recovery_social_features/references/friendships","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Friend Connections","sidebar_label":"Friend Connections","sidebar_position":2}}');var i=s(74848),r=s(28453);const d={title:"Friend Connections",sidebar_label:"Friend Connections",sidebar_position:2},a="Friend Connections",o={},c=[{value:"useFriendships Hook",id:"usefriendships-hook",level:2},{value:"Friend Request Button",id:"friend-request-button",level:2},{value:"Pending Friend Requests Component",id:"pending-friend-requests-component",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"friend-connections",children:"Friend Connections"})}),"\n",(0,i.jsx)(n.p,{children:"Peer-to-peer connections with mutual consent and real-time updates."}),"\n",(0,i.jsx)(n.h2,{id:"usefriendships-hook",children:"useFriendships Hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// hooks/useFriendships.ts\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\n\ninterface Friendship {\n  id: string;\n  status: 'pending' | 'accepted' | 'blocked';\n  isRequester: boolean;\n  profile: {\n    id: string;\n    displayName: string;\n    avatarIcon?: string;\n  };\n  createdAt: string;\n}\n\nexport function useFriendships() {\n  const [friends, setFriends] = useState<Friendship[]>([]);\n  const [pendingReceived, setPendingReceived] = useState<Friendship[]>([]);\n  const [pendingSent, setPendingSent] = useState<Friendship[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    loadFriendships();\n\n    // Subscribe to real-time updates\n    const subscription = supabase\n      .channel('friendships')\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'friendships' },\n        () => loadFriendships()\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  const loadFriendships = async () => {\n    const userId = (await supabase.auth.getUser()).data.user?.id;\n    if (!userId) return;\n\n    const { data } = await supabase\n      .from('friendships')\n      .select(`\n        id,\n        status,\n        requester_id,\n        addressee_id,\n        created_at,\n        requester:profiles!requester_id(id, display_name, avatar_icon),\n        addressee:profiles!addressee_id(id, display_name, avatar_icon)\n      `)\n      .or(`requester_id.eq.${userId},addressee_id.eq.${userId}`);\n\n    if (!data) return;\n\n    const mapped = data.map((f) => {\n      const isRequester = f.requester_id === userId;\n      const otherProfile = isRequester ? f.addressee : f.requester;\n\n      return {\n        id: f.id,\n        status: f.status,\n        isRequester,\n        profile: {\n          id: otherProfile.id,\n          displayName: otherProfile.display_name,\n          avatarIcon: otherProfile.avatar_icon,\n        },\n        createdAt: f.created_at,\n      };\n    });\n\n    setFriends(mapped.filter((f) => f.status === 'accepted'));\n    setPendingReceived(mapped.filter((f) => f.status === 'pending' && !f.isRequester));\n    setPendingSent(mapped.filter((f) => f.status === 'pending' && f.isRequester));\n    setIsLoading(false);\n  };\n\n  const sendRequest = async (targetUserId: string) => {\n    await supabase.from('friendships').insert({\n      requester_id: (await supabase.auth.getUser()).data.user?.id,\n      addressee_id: targetUserId,\n      status: 'pending',\n    });\n  };\n\n  const acceptRequest = async (friendshipId: string) => {\n    await supabase\n      .from('friendships')\n      .update({ status: 'accepted' })\n      .eq('id', friendshipId);\n  };\n\n  const rejectRequest = async (friendshipId: string) => {\n    await supabase.from('friendships').delete().eq('id', friendshipId);\n  };\n\n  const removeFriend = async (friendshipId: string) => {\n    await supabase.from('friendships').delete().eq('id', friendshipId);\n  };\n\n  return {\n    friends,\n    pendingReceived,\n    pendingSent,\n    isLoading,\n    sendRequest,\n    acceptRequest,\n    rejectRequest,\n    removeFriend,\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"friend-request-button",children:"Friend Request Button"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'// components/FriendRequest.tsx\n\'use client\';\n\nimport { useFriendships } from \'@/hooks/useFriendships\';\n\ninterface Props {\n  userId: string;\n  displayName: string;\n}\n\nexport function FriendRequestButton({ userId, displayName }: Props) {\n  const { friends, pendingSent, sendRequest } = useFriendships();\n\n  const isFriend = friends.some((f) => f.profile.id === userId);\n  const isPending = pendingSent.some((f) => f.profile.id === userId);\n\n  if (isFriend) {\n    return (\n      <span className="px-3 py-1 bg-green-900/30 text-green-400 rounded text-sm">\n        Friends\n      </span>\n    );\n  }\n\n  if (isPending) {\n    return (\n      <span className="px-3 py-1 bg-leather-700 text-leather-400 rounded text-sm">\n        Request Sent\n      </span>\n    );\n  }\n\n  return (\n    <button\n      onClick={() => sendRequest(userId)}\n      className="px-3 py-1 bg-ember-500 rounded text-sm min-h-[44px]"\n    >\n      Add Friend\n    </button>\n  );\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pending-friend-requests-component",children:"Pending Friend Requests Component"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'export function PendingFriendRequests() {\n  const { pendingReceived, acceptRequest, rejectRequest } = useFriendships();\n\n  if (pendingReceived.length === 0) return null;\n\n  return (\n    <div className="p-4 bg-leather-800 rounded-lg">\n      <h3 className="font-semibold mb-3">Friend Requests</h3>\n      <ul className="space-y-3">\n        {pendingReceived.map((request) => (\n          <li key={request.id} className="flex items-center justify-between">\n            <span>{request.profile.displayName}</span>\n            <div className="flex gap-2">\n              <button\n                onClick={() => acceptRequest(request.id)}\n                className="px-3 py-2 bg-green-600 rounded min-h-[44px]"\n              >\n                Accept\n              </button>\n              <button\n                onClick={() => rejectRequest(request.id)}\n                className="px-3 py-2 bg-leather-700 rounded min-h-[44px]"\n              >\n                Decline\n              </button>\n            </div>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);