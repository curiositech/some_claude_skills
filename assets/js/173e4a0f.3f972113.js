"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[79072],{22628:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"skills/design_justice/references/authentication-patterns","title":"Authentication Patterns for Unstable Phone Access","description":"The Problem","source":"@site/docs/skills/design_justice/references/authentication-patterns.md","sourceDirName":"skills/design_justice/references","slug":"/skills/design_justice/references/authentication-patterns","permalink":"/docs/skills/design_justice/references/authentication-patterns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Authentication Patterns for Unstable Phone Access","sidebar_label":"Authentication Patterns for...","sidebar_position":1}}');var s=i(74848),r=i(28453);const a={title:"Authentication Patterns for Unstable Phone Access",sidebar_label:"Authentication Patterns for...",sidebar_position:1},o="Authentication Patterns for Unstable Phone Access",l={},c=[{value:"The Problem",id:"the-problem",level:2},{value:"Pattern: Email-First Authentication",id:"pattern-email-first-authentication",level:2},{value:"Implementation",id:"implementation",level:3},{value:"Recovery Pathways (Multiple Required)",id:"recovery-pathways-multiple-required",level:3},{value:"Pattern: Printable Backup Codes",id:"pattern-printable-backup-codes",level:2},{value:"Generation",id:"generation",level:3},{value:"UI Requirements",id:"ui-requirements",level:3},{value:"Pattern: Trusted Intermediary Recovery",id:"pattern-trusted-intermediary-recovery",level:2},{value:"Flow",id:"flow",level:3},{value:"Implementation",id:"implementation-1",level:3},{value:"Pattern: No-Signup Essential Functions",id:"pattern-no-signup-essential-functions",level:2},{value:"What Should Work Without Login",id:"what-should-work-without-login",level:3},{value:"Implementation: Guest Mode with Upgrade",id:"implementation-guest-mode-with-upgrade",level:3},{value:"Anti-Patterns to Avoid",id:"anti-patterns-to-avoid",level:2},{value:"\u274c Phone Number Required at Signup",id:"-phone-number-required-at-signup",level:3},{value:"\u274c SMS-Only 2FA",id:"-sms-only-2fa",level:3},{value:"\u274c Device-Locked Sessions",id:"-device-locked-sessions",level:3},{value:"\u274c Account Lock on Phone Change",id:"-account-lock-on-phone-change",level:3},{value:"Testing Checklist",id:"testing-checklist",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentication-patterns-for-unstable-phone-access",children:"Authentication Patterns for Unstable Phone Access"})}),"\n",(0,s.jsx)(n.h2,{id:"the-problem",children:"The Problem"}),"\n",(0,s.jsx)(n.p,{children:"Traditional authentication assumes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Stable phone number"}),"\n",(0,s.jsx)(n.li,{children:"Consistent device access"}),"\n",(0,s.jsx)(n.li,{children:"Reliable SMS delivery"}),"\n",(0,s.jsx)(n.li,{children:"Ability to install authenticator apps"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Reality for recovery/reentry populations:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Phone numbers change with housing changes"}),"\n",(0,s.jsx)(n.li,{children:"Prepaid phones disconnect for non-payment"}),"\n",(0,s.jsx)(n.li,{children:"Devices are lost, stolen, or pawned"}),"\n",(0,s.jsx)(n.li,{children:"Shared phones among family/friends"}),"\n",(0,s.jsx)(n.li,{children:"No consistent access to same device"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pattern-email-first-authentication",children:"Pattern: Email-First Authentication"}),"\n",(0,s.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Schema: Phone is OPTIONAL\ninterface User {\n  email: string;           // Required, primary identifier\n  phone?: string;          // Optional\n  backupCodes: string[];   // Always generated\n  trustedContacts?: {      // Case worker recovery\n    email: string;\n    relationship: string;\n    verified: boolean;\n  }[];\n}\n\n// Signup flow\nconst signupSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(8),\n  phone: z.string().optional(), // Explicitly optional\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"recovery-pathways-multiple-required",children:"Recovery Pathways (Multiple Required)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Email recovery"})," (always available)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backup codes"})," (printable, one-time use)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Trusted contact verification"})," (case worker)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security questions"})," (as last resort)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Never have SMS as the ONLY path."}),"\n",(0,s.jsx)(n.h2,{id:"pattern-printable-backup-codes",children:"Pattern: Printable Backup Codes"}),"\n",(0,s.jsx)(n.h3,{id:"generation",children:"Generation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function generateBackupCodes(count: number = 10): string[] {\n  return Array.from({ length: count }, () =>\n    crypto.randomBytes(4).toString('hex').toUpperCase()\n  );\n}\n\n// Display format for printing\nfunction formatForPrint(codes: string[]): string {\n  return codes.map((code, i) =>\n    `${i + 1}. ${code.slice(0, 4)}-${code.slice(4)}`\n  ).join('\\n');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ui-requirements",children:"UI Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Large, clear font (16px minimum)"}),"\n",(0,s.jsx)(n.li,{children:'"Print this page" button prominent'}),"\n",(0,s.jsx)(n.li,{children:'Instructions: "Write these down and keep in a safe place"'}),"\n",(0,s.jsx)(n.li,{children:"Option to regenerate (invalidates old codes)"}),"\n",(0,s.jsx)(n.li,{children:"Show how many codes remain"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pattern-trusted-intermediary-recovery",children:"Pattern: Trusted Intermediary Recovery"}),"\n",(0,s.jsx)(n.h3,{id:"flow",children:"Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"User requests recovery via trusted contact"}),"\n",(0,s.jsx)(n.li,{children:"System emails case worker with verification link"}),"\n",(0,s.jsx)(n.li,{children:"Case worker confirms user identity (in person or call)"}),"\n",(0,s.jsx)(n.li,{children:"Case worker clicks verification link"}),"\n",(0,s.jsx)(n.li,{children:"User receives password reset email"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"implementation-1",children:"Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface TrustedContactRecovery {\n  userId: string;\n  contactEmail: string;\n  requestedAt: Date;\n  verificationToken: string;\n  expiresAt: Date;  // 24 hours\n  verified: boolean;\n  verifiedAt?: Date;\n}\n\n// Case worker verification page\n// Includes: User's name, photo (if on file), security questions\n// Case worker must confirm they verified identity\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pattern-no-signup-essential-functions",children:"Pattern: No-Signup Essential Functions"}),"\n",(0,s.jsx)(n.h3,{id:"what-should-work-without-login",children:"What Should Work Without Login"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Requires Login?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Eligibility checker"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Information/guides"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Form download"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Court locations"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Save progress"}),(0,s.jsx)(n.td,{children:"\u2705 Yes (or use localStorage)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Submit application"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Track status"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"implementation-guest-mode-with-upgrade",children:"Implementation: Guest Mode with Upgrade"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Store progress in localStorage\nconst guestProgress = {\n  formData: { ... },\n  currentStep: 3,\n  startedAt: '2024-01-15',\n};\n\n// On signup, merge guest data into account\nasync function upgradeGuestToUser(guestData, newUserId) {\n  await db.applications.create({\n    userId: newUserId,\n    ...guestData.formData,\n    status: 'draft',\n  });\n  localStorage.removeItem('guestProgress');\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"anti-patterns-to-avoid",children:"Anti-Patterns to Avoid"}),"\n",(0,s.jsx)(n.h3,{id:"-phone-number-required-at-signup",children:"\u274c Phone Number Required at Signup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// WRONG\nconst signupSchema = z.object({\n  email: z.string().email(),\n  phone: z.string().min(10), // Required!\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-sms-only-2fa",children:"\u274c SMS-Only 2FA"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// WRONG\nasync function send2FA(user) {\n  await sms.send(user.phone, code); // Only option!\n}\n\n// RIGHT\nasync function send2FA(user, method: '2fa_method') {\n  switch (method) {\n    case 'email': await email.send(user.email, code); break;\n    case 'sms': await sms.send(user.phone, code); break;\n    case 'backup': return verifyBackupCode(user, code); break;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-device-locked-sessions",children:"\u274c Device-Locked Sessions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// WRONG\nif (request.deviceFingerprint !== session.deviceFingerprint) {\n  throw new Error('Unrecognized device');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-account-lock-on-phone-change",children:"\u274c Account Lock on Phone Change"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// WRONG\nif (user.phone !== submittedPhone) {\n  await lockAccount(user, 'Phone number changed');\n}\n\n// RIGHT\nif (user.phone !== submittedPhone) {\n  await sendVerificationEmail(user.email,\n    'Your phone number was updated. Click here if this wasn\\'t you.'\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u25a1 Can complete signup with only email\n\u25a1 Can recover account without phone\n\u25a1 Backup codes work and are printable\n\u25a1 Case worker verification flow works\n\u25a1 Core features work without login\n\u25a1 Session works across devices\n\u25a1 Phone number change doesn't lock account\n\u25a1 Clear indication of which fields are optional\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);