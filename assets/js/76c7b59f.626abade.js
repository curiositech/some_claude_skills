"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[70812],{28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(96540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}},46738:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"skills/supabase_admin/index","title":"Supabase Administration Expert","description":"Supabase administration, RLS policies, migrations, and schema design. Use for database architecture, Row Level Security, performance tuning, auth integration. Activate on \\"Supabase\\", \\"RLS\\", \\"migration\\", \\"policy\\", \\"schema\\", \\"auth.uid()\\". NOT for Supabase Auth UI configuration (use dashboard), edge functions (use cloudflare-worker-dev), or general SQL without Supabase context.","source":"@site/docs/skills/supabase_admin/index.md","sourceDirName":"skills/supabase_admin","slug":"/skills/supabase_admin","permalink":"/docs/skills/supabase_admin","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"name":"supabase-admin","description":"Supabase administration, RLS policies, migrations, and schema design. Use for database architecture, Row Level Security, performance tuning, auth integration. Activate on \\"Supabase\\", \\"RLS\\", \\"migration\\", \\"policy\\", \\"schema\\", \\"auth.uid()\\". NOT for Supabase Auth UI configuration (use dashboard), edge functions (use cloudflare-worker-dev), or general SQL without Supabase context.","allowed-tools":"Read,Write,Edit,Bash,Grep,Glob,mcp__supabase__*","slug":"/skills/supabase_admin"}}');var r=s(74848),t=s(28453);const a={name:"supabase-admin",description:'Supabase administration, RLS policies, migrations, and schema design. Use for database architecture, Row Level Security, performance tuning, auth integration. Activate on "Supabase", "RLS", "migration", "policy", "schema", "auth.uid()". NOT for Supabase Auth UI configuration (use dashboard), edge functions (use cloudflare-worker-dev), or general SQL without Supabase context.',"allowed-tools":"Read,Write,Edit,Bash,Grep,Glob,mcp__supabase__*",slug:"/skills/supabase_admin"},l="Supabase Administration Expert",c={},d=[{value:"When to Use",id:"when-to-use",level:2},{value:"Core Competencies",id:"core-competencies",level:2},{value:"1. Row Level Security (RLS)",id:"1-row-level-security-rls",level:3},{value:"2. Migration Best Practices",id:"2-migration-best-practices",level:3},{value:"3. Auth Integration",id:"3-auth-integration",level:3},{value:"4. Common Schema Patterns",id:"4-common-schema-patterns",level:3},{value:"5. Debugging RLS Issues",id:"5-debugging-rls-issues",level:3},{value:"Quick Reference",id:"quick-reference",level:2},{value:"References",id:"references",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"supabase-administration-expert",children:"Supabase Administration Expert"})}),"\n",(0,r.jsx)(n.p,{children:"Master Supabase schema design, Row Level Security policies, migrations, and performance optimization for production applications."}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"USE this skill for:"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Row Level Security (RLS) policy design and debugging"}),"\n",(0,r.jsx)(n.li,{children:"Database migrations and schema changes"}),"\n",(0,r.jsx)(n.li,{children:"Auth integration (triggers, profile creation)"}),"\n",(0,r.jsx)(n.li,{children:"Query performance optimization"}),"\n",(0,r.jsxs)(n.li,{children:["Supabase-specific SQL patterns (",(0,r.jsx)(n.code,{children:"auth.uid()"}),", ",(0,r.jsx)(n.code,{children:"auth.jwt()"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"DO NOT use for:"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Supabase Auth UI configuration \u2192 use Supabase dashboard docs"}),"\n",(0,r.jsxs)(n.li,{children:["Edge Functions \u2192 use ",(0,r.jsx)(n.code,{children:"cloudflare-worker-dev"})," skill"]}),"\n",(0,r.jsx)(n.li,{children:"General PostgreSQL without Supabase context \u2192 use standard SQL resources"}),"\n",(0,r.jsx)(n.li,{children:"Client-side Supabase SDK usage \u2192 use Supabase JS docs"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-competencies",children:"Core Competencies"}),"\n",(0,r.jsx)(n.h3,{id:"1-row-level-security-rls",children:"1. Row Level Security (RLS)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Always Enable RLS on User Tables:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE your_table ENABLE ROW LEVEL SECURITY;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Policy Patterns:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'-- Public read, authenticated write\nCREATE POLICY "Public read" ON posts FOR SELECT USING (true);\nCREATE POLICY "Owners can write" ON posts FOR INSERT\n  WITH CHECK (auth.uid() = user_id);\n\n-- Owner-only access\nCREATE POLICY "Users own their data" ON profiles\n  FOR ALL USING (auth.uid() = id);\n\n-- Role-based access\nCREATE POLICY "Admins can do anything" ON content\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = \'admin\'\n    )\n  );\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Performance-Critical: Index auth.uid() Columns:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- 100x performance improvement for RLS policies\nCREATE INDEX idx_posts_user_id ON posts(user_id);\nCREATE INDEX idx_profiles_id ON profiles(id);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Subquery Optimization for JWT Functions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'-- BAD: JWT parsed for every row\nCREATE POLICY "slow" ON posts FOR SELECT\n  USING (user_id = auth.uid());\n\n-- GOOD: JWT parsed once via subquery\nCREATE POLICY "fast" ON posts FOR SELECT\n  USING (user_id = (SELECT auth.uid()));\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-migration-best-practices",children:"2. Migration Best Practices"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"File Naming Convention:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"supabase/migrations/\n\u251c\u2500\u2500 001_initial_schema.sql\n\u251c\u2500\u2500 002_add_profiles_trigger.sql\n\u251c\u2500\u2500 003_forum_tables.sql\n\u2514\u2500\u2500 004_add_rls_policies.sql\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Migration Template:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Migration: 005_feature_name\n-- Description: What this migration does\n-- Author: name\n-- Date: YYYY-MM-DD\n\n-- Up migration\nBEGIN;\n\n-- Your DDL here\nCREATE TABLE ...;\nALTER TABLE ...;\nCREATE POLICY ...;\n\nCOMMIT;\n\n-- Down migration (as comment for reference)\n-- DROP TABLE ...;\n-- DROP POLICY ...;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Safe Migration Patterns:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Add column with default (no table lock)\nALTER TABLE users ADD COLUMN status text DEFAULT 'active';\n\n-- Add NOT NULL constraint safely\nALTER TABLE users ADD COLUMN email text;\nUPDATE users SET email = 'unknown@example.com' WHERE email IS NULL;\nALTER TABLE users ALTER COLUMN email SET NOT NULL;\n\n-- Create index concurrently (no lock)\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-auth-integration",children:"3. Auth Integration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Auto-create Profile on Signup:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Function to create profile\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n  INSERT INTO public.profiles (id, email, display_name)\n  VALUES (\n    NEW.id,\n    NEW.email,\n    COALESCE(NEW.raw_user_meta_data->>'display_name', split_part(NEW.email, '@', 1))\n  );\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- Trigger on auth.users\nCREATE TRIGGER on_auth_user_created\n  AFTER INSERT ON auth.users\n  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check Auth Status in Policies:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Authenticated users only\nCREATE POLICY \"Authenticated access\" ON data\n  FOR SELECT USING (auth.role() = 'authenticated');\n\n-- Get current user's ID\nSELECT auth.uid();\n\n-- Get current user's JWT claims\nSELECT auth.jwt();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-common-schema-patterns",children:"4. Common Schema Patterns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Timestamps with Defaults:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE posts (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,\n  content text NOT NULL,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n);\n\n-- Auto-update updated_at\nCREATE OR REPLACE FUNCTION update_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER update_posts_updated_at\n  BEFORE UPDATE ON posts\n  FOR EACH ROW EXECUTE FUNCTION update_updated_at();\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Soft Delete Pattern:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'ALTER TABLE posts ADD COLUMN deleted_at timestamptz;\n\nCREATE POLICY "Hide deleted" ON posts\n  FOR SELECT USING (deleted_at IS NULL);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Full-Text Search:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Add search vector column\nALTER TABLE posts ADD COLUMN search_vector tsvector;\n\n-- Create GIN index\nCREATE INDEX idx_posts_search ON posts USING GIN(search_vector);\n\n-- Update function\nCREATE OR REPLACE FUNCTION posts_search_update()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.search_vector := to_tsvector('english', COALESCE(NEW.title, '') || ' ' || COALESCE(NEW.content, ''));\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Search query\nSELECT * FROM posts\nWHERE search_vector @@ plainto_tsquery('english', 'search terms');\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-debugging-rls-issues",children:"5. Debugging RLS Issues"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common Problem: Empty Results, No Error"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Check if RLS is enabled\nSELECT tablename, rowsecurity FROM pg_tables WHERE schemaname = 'public';\n\n-- List all policies\nSELECT * FROM pg_policies WHERE tablename = 'your_table';\n\n-- Test as specific role\nSET ROLE anon;\nSELECT * FROM your_table LIMIT 1;\nRESET ROLE;\n\n-- Test with specific user\nSET request.jwt.claims TO '{\"sub\": \"user-uuid-here\"}';\nSELECT * FROM your_table;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Diagnostic Query:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Check what the current user can see\nSELECT\n  auth.uid() as current_user,\n  auth.role() as current_role,\n  (SELECT count(*) FROM your_table) as visible_rows;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Task"}),(0,r.jsx)(n.th,{children:"Command"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Enable RLS"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ALTER TABLE t ENABLE ROW LEVEL SECURITY;"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Create policy"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'CREATE POLICY "name" ON t FOR action USING (condition);'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Drop policy"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'DROP POLICY "name" ON t;'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Check policies"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SELECT * FROM pg_policies WHERE tablename = 't';"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Current user"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SELECT auth.uid();"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Force RLS for owner"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ALTER TABLE t FORCE ROW LEVEL SECURITY;"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.code,{children:"/references/"})," for detailed guides:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rls-patterns.md"})," - Advanced RLS policy patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"migration-checklist.md"})," - Pre-deployment checklist"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"performance-tuning.md"})," - Query and index optimization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"social-schema.md"})," - Schema patterns for social features"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);