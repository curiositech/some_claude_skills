"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[64054],{24405:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"skills/recovery_coach_patterns/index","title":"\ud83c\udfe0 Recovery Coach Patterns","description":"Follow Recovery Coach codebase patterns and conventions. Use when writing new code, components, API routes, or database queries. Activates for general development, code organization, styling, and architectural decisions in this project.","source":"@site/docs/skills/recovery_coach_patterns/index.md","sourceDirName":"skills/recovery_coach_patterns","slug":"/skills/recovery_coach_patterns/","permalink":"/docs/skills/recovery_coach_patterns/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Recovery Coach Patterns","sidebar_position":1}}');var s=t(74848),i=t(28453);const a={sidebar_label:"Recovery Coach Patterns",sidebar_position:1},o="\ud83c\udfe0 Recovery Coach Patterns",c={},l=[{value:"Allowed Tools",id:"allowed-tools",level:2},{value:"Tags",id:"tags",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"Project Structure",id:"project-structure",level:2},{value:"API Route Pattern",id:"api-route-pattern",level:2},{value:"React Component Pattern",id:"react-component-pattern",level:2},{value:"Database Query Pattern",id:"database-query-pattern",level:2},{value:"Design System",id:"design-system",level:2},{value:"Color Palette (Therapeutic)",id:"color-palette-therapeutic",level:3},{value:"Time-Based Themes",id:"time-based-themes",level:3},{value:"Component Styling",id:"component-styling",level:3},{value:"Testing Pattern",id:"testing-pattern",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Pre-Commit Checklist",id:"pre-commit-checklist",level:2},{value:"Common Imports",id:"common-imports",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"-recovery-coach-patterns",children:"\ud83c\udfe0 Recovery Coach Patterns"})}),"\n",(0,s.jsx)(n.p,{children:"Follow Recovery Coach codebase patterns and conventions. Use when writing new code, components, API routes, or database queries. Activates for general development, code organization, styling, and architectural decisions in this project."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"allowed-tools",children:"Allowed Tools"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Read, Write, Edit, Bash(npm:*, npx:*)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tags",children:"Tags"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"recovery"})," ",(0,s.jsx)(n.code,{children:"patterns"})," ",(0,s.jsx)(n.code,{children:"next-js"})]}),"\n",(0,s.jsx)(n.h1,{id:"recovery-coach-development-patterns",children:"Recovery Coach Development Patterns"}),"\n",(0,s.jsx)(n.p,{children:"This skill helps you follow the established patterns and conventions in the Recovery Coach codebase."}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"USE this skill for:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Writing new components, pages, or API routes in Recovery Coach"}),"\n",(0,s.jsx)(n.li,{children:"Following established code organization patterns"}),"\n",(0,s.jsx)(n.li,{children:"Implementing database queries with Drizzle ORM"}),"\n",(0,s.jsx)(n.li,{children:"Understanding project architecture and conventions"}),"\n",(0,s.jsx)(n.li,{children:"Styling components to match the design system"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u274c ",(0,s.jsx)(n.strong,{children:"DO NOT use for:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Crisis intervention implementation \u2192 use ",(0,s.jsx)(n.code,{children:"crisis-response-protocol"})]}),"\n",(0,s.jsx)(n.li,{children:"General Next.js questions \u2192 use Next.js docs"}),"\n",(0,s.jsxs)(n.li,{children:["AI/LLM integration patterns \u2192 use ",(0,s.jsx)(n.code,{children:"modern-drug-rehab-computer"})]}),"\n",(0,s.jsxs)(n.li,{children:["Content moderation \u2192 use ",(0,s.jsx)(n.code,{children:"recovery-community-moderator"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"src/\n\u251c\u2500\u2500 app/              # Next.js App Router\n\u2502   \u251c\u2500\u2500 api/          # API routes (REST endpoints)\n\u2502   \u2502   \u251c\u2500\u2500 auth/     # Authentication endpoints\n\u2502   \u2502   \u251c\u2500\u2500 check-in/ # Daily check-in endpoints\n\u2502   \u2502   \u251c\u2500\u2500 chat/     # AI coaching endpoints\n\u2502   \u2502   \u2514\u2500\u2500 admin/    # Admin-only endpoints\n\u2502   \u251c\u2500\u2500 admin/        # Admin dashboard page\n\u2502   \u251c\u2500\u2500 settings/     # User settings page\n\u2502   \u2514\u2500\u2500 page.tsx      # Home page\n\u251c\u2500\u2500 components/       # React components\n\u2502   \u251c\u2500\u2500 ui/           # Base UI components (Button, Card, etc.)\n\u2502   \u2514\u2500\u2500 *.tsx         # Feature components\n\u251c\u2500\u2500 lib/              # Core business logic\n\u2502   \u251c\u2500\u2500 ai/           # Anthropic integration\n\u2502   \u251c\u2500\u2500 hipaa/        # HIPAA compliance utilities\n\u2502   \u251c\u2500\u2500 auth.ts       # Authentication\n\u2502   \u251c\u2500\u2500 db.ts         # Database connection\n\u2502   \u2514\u2500\u2500 rate-limit.ts # Rate limiting\n\u251c\u2500\u2500 db/               # Database schema (Drizzle ORM)\n\u2502   \u251c\u2500\u2500 schema.ts     # Table definitions\n\u2502   \u2514\u2500\u2500 secure-db.ts  # RLS-enforced queries\n\u2514\u2500\u2500 test/             # Test utilities\n\nfeatures/             # Feature manifests (YAML)\ndocs/                 # Documentation\nscripts/              # Build and utility scripts\n"})}),"\n",(0,s.jsx)(n.h2,{id:"api-route-pattern",children:"API Route Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// src/app/api/[feature]/route.ts\nimport { NextResponse } from 'next/server';\nimport { getSession } from '@/lib/auth';\nimport { createRateLimiter } from '@/lib/rate-limit';\nimport { logPHIAccess } from '@/lib/hipaa/audit';\nimport { z } from 'zod';\n\n// 1. Define rate limiter\nconst rateLimiter = createRateLimiter({\n  windowMs: 60000,\n  maxRequests: 30,\n  keyPrefix: 'api:feature'\n});\n\n// 2. Define input schema\nconst RequestSchema = z.object({\n  field: z.string().min(1).max(1000),\n});\n\nexport async function POST(request: Request) {\n  // 3. Check authentication\n  const session = await getSession();\n  if (!session) {\n    return NextResponse.json(\n      { error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  // 4. Apply rate limiting\n  const rateLimitResult = await rateLimiter.check(session.userId);\n  if (!rateLimitResult.allowed) {\n    return NextResponse.json(\n      { error: 'Rate limit exceeded' },\n      { status: 429, headers: rateLimitResult.headers }\n    );\n  }\n\n  // 5. Parse and validate input\n  const body = await request.json();\n  const parsed = RequestSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json(\n      { error: 'Invalid input', details: parsed.error.issues },\n      { status: 400 }\n    );\n  }\n\n  // 6. Perform operation\n  const result = await performOperation(session.userId, parsed.data);\n\n  // 7. Audit log (if PHI)\n  await logPHIAccess(session.userId, 'feature', result.id, 'CREATE');\n\n  // 8. Return response\n  return NextResponse.json(result);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"react-component-pattern",children:"React Component Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// src/components/FeatureComponent.tsx\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/Button';\nimport { Card, CardHeader, CardContent } from '@/components/ui/Card';\n\ninterface FeatureProps {\n  id: string;\n  initialData?: FeatureData;\n  onComplete?: (result: Result) => void;\n}\n\nexport function FeatureComponent({\n  id,\n  initialData,\n  onComplete\n}: FeatureProps) {\n  const [data, setData] = useState<FeatureData | null>(initialData ?? null);\n  const [loading, setLoading] = useState(!initialData);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!initialData) {\n      fetchData();\n    }\n  }, [id]);\n\n  async function fetchData() {\n    try {\n      setLoading(true);\n      const res = await fetch(`/api/feature/${id}`);\n      if (!res.ok) throw new Error('Failed to fetch');\n      const data = await res.json();\n      setData(data);\n    } catch (e) {\n      setError(e instanceof Error ? e.message : 'Unknown error');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (loading) {\n    return <div className=\"animate-pulse\">Loading...</div>;\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-destructive\">\n        <CardContent>Error: {error}</CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>Feature Title</CardHeader>\n      <CardContent>\n        {/* Content */}\n      </CardContent>\n    </Card>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"database-query-pattern",children:"Database Query Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Use secure-db for user data (RLS enforced)\nimport { db, users, checkIns } from '@/db/secure-db';\nimport { eq, desc } from 'drizzle-orm';\n\n// Get user's own data (RLS automatically filters)\nasync function getUserCheckIns(userId: string) {\n  return db\n    .select()\n    .from(checkIns)\n    .where(eq(checkIns.userId, userId))\n    .orderBy(desc(checkIns.createdAt))\n    .limit(30);\n}\n\n// For admin queries, use requireAdmin\nimport { requireAdmin } from '@/db/secure-db';\n\nasync function getAdminStats() {\n  const admin = await requireAdmin();\n  if (!admin) throw new Error('Admin required');\n\n  // Now can query across all users\n  return db.select({ count: count() }).from(users);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"design-system",children:"Design System"}),"\n",(0,s.jsx)(n.h3,{id:"color-palette-therapeutic",children:"Color Palette (Therapeutic)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-css",children:"/* From globals.css */\n--navy: #1a365d;      /* Primary - trust, stability */\n--teal: #319795;      /* Secondary - calm, healing */\n--coral: #ed8936;     /* Accent - warmth, energy */\n--cream: #fffaf0;     /* Background - comfort */\n"})}),"\n",(0,s.jsx)(n.h3,{id:"time-based-themes",children:"Time-Based Themes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function getTimeTheme(): 'dawn' | 'day' | 'dusk' | 'night' {\n  const hour = new Date().getHours();\n  if (hour >= 5 && hour < 9) return 'dawn';\n  if (hour >= 9 && hour < 17) return 'day';\n  if (hour >= 17 && hour < 21) return 'dusk';\n  return 'night';\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"component-styling",children:"Component Styling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Use Tailwind with design tokens\n<Button\n  className="bg-navy hover:bg-navy/90 text-white"\n  variant="default"\n>\n  Primary Action\n</Button>\n\n<Card className="bg-cream border-teal/20">\n  <CardContent className="text-navy">\n    Therapeutic content\n  </CardContent>\n</Card>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"testing-pattern",children:"Testing Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// src/lib/__tests__/feature.test.ts\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\n\ndescribe('Feature', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('loads and displays data', async () => {\n    vi.mocked(fetch).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ data: 'test' })\n    } as Response);\n\n    render(<FeatureComponent id=\"123\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText('test')).toBeInTheDocument();\n    });\n  });\n\n  it('handles errors gracefully', async () => {\n    vi.mocked(fetch).mockRejectedValueOnce(new Error('Network error'));\n\n    render(<FeatureComponent id=\"123\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/error/i)).toBeInTheDocument();\n    });\n  });\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Use structured error responses\ninterface APIError {\n  error: string;\n  code?: string;\n  details?: unknown;\n}\n\n// In API routes\nreturn NextResponse.json<APIError>(\n  {\n    error: 'Validation failed',\n    code: 'VALIDATION_ERROR',\n    details: zodError.issues\n  },\n  { status: 400 }\n);\n\n// In components\ntry {\n  await submitData();\n} catch (e) {\n  if (e instanceof APIError) {\n    toast.error(e.message);\n  } else {\n    toast.error('An unexpected error occurred');\n    console.error(e); // Log for debugging, not shown to user\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.p,{children:"Required variables (validated at startup):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Authentication\nSESSION_SECRET=           # 32+ random characters\n\n# AI Integration\nANTHROPIC_API_KEY=        # Claude API key\n\n# Database\nDATABASE_URL=             # SQLite path or connection string\n\n# Optional\nVAPID_PUBLIC_KEY=         # Push notifications\nVAPID_PRIVATE_KEY=\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pre-commit-checklist",children:"Pre-Commit Checklist"}),"\n",(0,s.jsx)(n.p,{children:"Before committing any changes:"}),"\n",(0,s.jsxs)(n.ol,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.code,{children:"npm run lint"})," passes"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.code,{children:"npm run test"})," passes"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.code,{children:"npm run feature:validate"})," passes"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Feature manifest updated (if applicable)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","No secrets in code"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","HIPAA compliance maintained (audit logs)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Accessibility considered (semantic HTML, ARIA)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-imports",children:"Common Imports"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Authentication\nimport { getSession, requireAuth } from '@/lib/auth';\n\n// Database\nimport { db } from '@/db/secure-db';\nimport { eq, desc, and } from 'drizzle-orm';\n\n// Audit\nimport { logPHIAccess, logSecurityEvent } from '@/lib/hipaa/audit';\n\n// Rate limiting\nimport { createRateLimiter } from '@/lib/rate-limit';\n\n// Validation\nimport { z } from 'zod';\n\n// UI Components\nimport { Button } from '@/components/ui/Button';\nimport { Card, CardHeader, CardContent } from '@/components/ui/Card';\nimport { Input } from '@/components/ui/Input';\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var r=t(96540);const s={},i=r.createContext(s);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);