"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[67363],{28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var a=r(96540);const t={},s=a.createContext(t);function i(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(s.Provider,{value:n},e.children)}},75281:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"skills/form_validation_architect/references/file-upload","title":"File Upload with Progress Tracking","description":"Production patterns for handling file uploads in forms with validation, progress indicators, and error handling.","source":"@site/docs/skills/form_validation_architect/references/file-upload.md","sourceDirName":"skills/form_validation_architect/references","slug":"/skills/form_validation_architect/references/file-upload","permalink":"/docs/skills/form_validation_architect/references/file-upload","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"File Upload with Progress Tracking","sidebar_label":"File Upload with Progress T...","sidebar_position":2}}');var t=r(74848),s=r(28453);const i={title:"File Upload with Progress Tracking",sidebar_label:"File Upload with Progress T...",sidebar_position:2},l="File Upload with Progress Tracking",o={},d=[{value:"Pattern 1: Basic File Upload with Validation",id:"pattern-1-basic-file-upload-with-validation",level:2},{value:"Pattern 2: Preview Before Upload",id:"pattern-2-preview-before-upload",level:2},{value:"Pattern 3: Upload Progress with XMLHttpRequest",id:"pattern-3-upload-progress-with-xmlhttprequest",level:2},{value:"Pattern 4: Multiple File Upload",id:"pattern-4-multiple-file-upload",level:2},{value:"Pattern 5: Drag and Drop",id:"pattern-5-drag-and-drop",level:2},{value:"Pattern 6: Chunked Upload (Large Files)",id:"pattern-6-chunked-upload-large-files",level:2},{value:"Pattern 7: Image Compression Before Upload",id:"pattern-7-image-compression-before-upload",level:2},{value:"Production Checklist",id:"production-checklist",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Resources",id:"resources",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"file-upload-with-progress-tracking",children:"File Upload with Progress Tracking"})}),"\n",(0,t.jsx)(n.p,{children:"Production patterns for handling file uploads in forms with validation, progress indicators, and error handling."}),"\n",(0,t.jsx)(n.h2,{id:"pattern-1-basic-file-upload-with-validation",children:"Pattern 1: Basic File Upload with Validation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\nconst ACCEPTED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\nconst schema = z.object({\n  avatar: z\n    .instanceof(File)\n    .refine((file) => file.size <= MAX_FILE_SIZE, {\n      message: 'File must be less than 5MB'\n    })\n    .refine((file) => ACCEPTED_TYPES.includes(file.type), {\n      message: 'Only JPEG, PNG, and WebP images allowed'\n    })\n});\n\nfunction FileUploadForm() {\n  const { register, handleSubmit, formState: { errors } } = useForm({\n    resolver: zodResolver(schema)\n  });\n\n  const onSubmit = async (data: { avatar: File }) => {\n    const formData = new FormData();\n    formData.append('avatar', data.avatar);\n\n    await fetch('/api/upload', {\n      method: 'POST',\n      body: formData\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      <label htmlFor=\"avatar\">Profile Picture</label>\n      <input\n        id=\"avatar\"\n        type=\"file\"\n        accept=\"image/jpeg,image/png,image/webp\"\n        {...register('avatar', {\n          // Convert FileList to File\n          setValueAs: (files: FileList) => files[0]\n        })}\n      />\n      {errors.avatar && (\n        <span className=\"error\">{errors.avatar.message}</span>\n      )}\n\n      <button type=\"submit\">Upload</button>\n    </form>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-2-preview-before-upload",children:"Pattern 2: Preview Before Upload"}),"\n",(0,t.jsx)(n.p,{children:"Show image preview before submitting."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'function ImageUploadWithPreview() {\n  const [preview, setPreview] = useState<string | null>(null);\n  const { register, watch } = useForm();\n\n  const file = watch(\'image\')?.[0];\n\n  useEffect(() => {\n    if (!file) {\n      setPreview(null);\n      return;\n    }\n\n    const objectUrl = URL.createObjectURL(file);\n    setPreview(objectUrl);\n\n    // Cleanup\n    return () => URL.revokeObjectURL(objectUrl);\n  }, [file]);\n\n  return (\n    <div>\n      <input\n        type="file"\n        accept="image/*"\n        {...register(\'image\')}\n      />\n\n      {preview && (\n        <div className="preview">\n          <img src={preview} alt="Preview" style={{ maxWidth: 300 }} />\n          <button\n            type="button"\n            onClick={() => {\n              setPreview(null);\n              setValue(\'image\', null);\n            }}\n          >\n            Remove\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-3-upload-progress-with-xmlhttprequest",children:"Pattern 3: Upload Progress with XMLHttpRequest"}),"\n",(0,t.jsx)(n.p,{children:"Track upload progress for large files."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function UploadWithProgress() {\n  const [progress, setProgress] = useState(0);\n  const [uploading, setUploading] = useState(false);\n\n  const uploadFile = async (file: File) => {\n    setUploading(true);\n    setProgress(0);\n\n    const formData = new FormData();\n    formData.append('file', file);\n\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n\n      // Track upload progress\n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          const percentComplete = (e.loaded / e.total) * 100;\n          setProgress(percentComplete);\n        }\n      });\n\n      xhr.addEventListener('load', () => {\n        setUploading(false);\n        if (xhr.status === 200) {\n          resolve(JSON.parse(xhr.responseText));\n        } else {\n          reject(new Error('Upload failed'));\n        }\n      });\n\n      xhr.addEventListener('error', () => {\n        setUploading(false);\n        reject(new Error('Network error'));\n      });\n\n      xhr.open('POST', '/api/upload');\n      xhr.send(formData);\n    });\n  };\n\n  return (\n    <div>\n      <input\n        type=\"file\"\n        onChange={(e) => {\n          const file = e.target.files?.[0];\n          if (file) uploadFile(file);\n        }}\n        disabled={uploading}\n      />\n\n      {uploading && (\n        <div className=\"progress-container\">\n          <div\n            className=\"progress-bar\"\n            style={{ width: `${progress}%` }}\n          />\n          <span>{Math.round(progress)}%</span>\n        </div>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-4-multiple-file-upload",children:"Pattern 4: Multiple File Upload"}),"\n",(0,t.jsx)(n.p,{children:"Handle multiple files with individual progress tracking."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface FileUpload {\n  id: string;\n  file: File;\n  progress: number;\n  status: 'pending' | 'uploading' | 'complete' | 'error';\n  error?: string;\n}\n\nfunction MultiFileUpload() {\n  const [uploads, setUploads] = useState<FileUpload[]>([]);\n\n  const handleFileSelect = (files: FileList) => {\n    const newUploads = Array.from(files).map((file) => ({\n      id: Math.random().toString(36),\n      file,\n      progress: 0,\n      status: 'pending' as const\n    }));\n\n    setUploads((prev) => [...prev, ...newUploads]);\n\n    // Start uploading\n    newUploads.forEach((upload) => uploadFile(upload));\n  };\n\n  const uploadFile = async (upload: FileUpload) => {\n    setUploads((prev) =>\n      prev.map((u) =>\n        u.id === upload.id ? { ...u, status: 'uploading' } : u\n      )\n    );\n\n    const formData = new FormData();\n    formData.append('file', upload.file);\n\n    try {\n      const xhr = new XMLHttpRequest();\n\n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          const progress = (e.loaded / e.total) * 100;\n          setUploads((prev) =>\n            prev.map((u) =>\n              u.id === upload.id ? { ...u, progress } : u\n            )\n          );\n        }\n      });\n\n      await new Promise((resolve, reject) => {\n        xhr.addEventListener('load', () => {\n          if (xhr.status === 200) resolve(xhr.response);\n          else reject(new Error('Upload failed'));\n        });\n        xhr.addEventListener('error', reject);\n        xhr.open('POST', '/api/upload');\n        xhr.send(formData);\n      });\n\n      setUploads((prev) =>\n        prev.map((u) =>\n          u.id === upload.id ? { ...u, status: 'complete', progress: 100 } : u\n        )\n      );\n    } catch (error) {\n      setUploads((prev) =>\n        prev.map((u) =>\n          u.id === upload.id\n            ? { ...u, status: 'error', error: error.message }\n            : u\n        )\n      );\n    }\n  };\n\n  const removeUpload = (id: string) => {\n    setUploads((prev) => prev.filter((u) => u.id !== id));\n  };\n\n  return (\n    <div>\n      <input\n        type=\"file\"\n        multiple\n        onChange={(e) => {\n          if (e.target.files) handleFileSelect(e.target.files);\n        }}\n      />\n\n      <div className=\"upload-list\">\n        {uploads.map((upload) => (\n          <div key={upload.id} className=\"upload-item\">\n            <span>{upload.file.name}</span>\n\n            {upload.status === 'uploading' && (\n              <div className=\"progress\">\n                <div style={{ width: `${upload.progress}%` }} />\n              </div>\n            )}\n\n            {upload.status === 'complete' && (\n              <span className=\"success\">\u2713 Uploaded</span>\n            )}\n\n            {upload.status === 'error' && (\n              <span className=\"error\">{upload.error}</span>\n            )}\n\n            <button onClick={() => removeUpload(upload.id)}>\n              Remove\n            </button>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-5-drag-and-drop",children:"Pattern 5: Drag and Drop"}),"\n",(0,t.jsx)(n.p,{children:"Enhance UX with drag-and-drop support."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'function DragDropUpload() {\n  const [isDragging, setIsDragging] = useState(false);\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n\n    const files = Array.from(e.dataTransfer.files);\n    handleFiles(files);\n  };\n\n  const handleFiles = (files: File[]) => {\n    files.forEach((file) => {\n      // Validate and upload\n      if (file.size > MAX_FILE_SIZE) {\n        alert(`${file.name} is too large`);\n        return;\n      }\n      uploadFile(file);\n    });\n  };\n\n  return (\n    <div\n      className={`dropzone ${isDragging ? \'dragging\' : \'\'}`}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n    >\n      <input\n        type="file"\n        multiple\n        onChange={(e) => {\n          if (e.target.files) handleFiles(Array.from(e.target.files));\n        }}\n        style={{ display: \'none\' }}\n        id="file-input"\n      />\n\n      <label htmlFor="file-input" className="drop-label">\n        {isDragging ? (\n          <>Drop files here</>\n        ) : (\n          <>\n            Drag & drop files here, or <span className="link">browse</span>\n          </>\n        )}\n      </label>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Styles"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-css",children:".dropzone {\n  border: 2px dashed #ccc;\n  border-radius: 8px;\n  padding: 40px;\n  text-align: center;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.dropzone.dragging {\n  border-color: #4CAF50;\n  background: #f0f9f0;\n}\n\n.dropzone .link {\n  color: #2196F3;\n  text-decoration: underline;\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-6-chunked-upload-large-files",children:"Pattern 6: Chunked Upload (Large Files)"}),"\n",(0,t.jsx)(n.p,{children:"Split large files into chunks for reliable uploads."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const CHUNK_SIZE = 1024 * 1024; // 1MB chunks\n\nasync function uploadFileInChunks(file: File) {\n  const totalChunks = Math.ceil(file.size / CHUNK_SIZE);\n  const uploadId = Math.random().toString(36);\n\n  for (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {\n    const start = chunkIndex * CHUNK_SIZE;\n    const end = Math.min(start + CHUNK_SIZE, file.size);\n    const chunk = file.slice(start, end);\n\n    const formData = new FormData();\n    formData.append('chunk', chunk);\n    formData.append('uploadId', uploadId);\n    formData.append('chunkIndex', chunkIndex.toString());\n    formData.append('totalChunks', totalChunks.toString());\n    formData.append('fileName', file.name);\n\n    await fetch('/api/upload-chunk', {\n      method: 'POST',\n      body: formData\n    });\n\n    // Update progress\n    const progress = ((chunkIndex + 1) / totalChunks) * 100;\n    console.log(`Upload progress: ${progress}%`);\n  }\n\n  // Finalize upload (merge chunks on server)\n  await fetch('/api/finalize-upload', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ uploadId, fileName: file.name })\n  });\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Server-side (Node.js example)"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Receive chunk\napp.post('/api/upload-chunk', async (req, res) => {\n  const { uploadId, chunkIndex, totalChunks, fileName } = req.body;\n  const chunk = req.files.chunk;\n\n  const chunkDir = path.join('/tmp/uploads', uploadId);\n  await fs.mkdir(chunkDir, { recursive: true });\n\n  const chunkPath = path.join(chunkDir, `chunk-${chunkIndex}`);\n  await chunk.mv(chunkPath);\n\n  res.json({ success: true });\n});\n\n// Merge chunks\napp.post('/api/finalize-upload', async (req, res) => {\n  const { uploadId, fileName } = req.body;\n  const chunkDir = path.join('/tmp/uploads', uploadId);\n\n  const finalPath = path.join('/uploads', fileName);\n  const writeStream = fs.createWriteStream(finalPath);\n\n  const chunkFiles = await fs.readdir(chunkDir);\n  chunkFiles.sort((a, b) => {\n    const aIndex = parseInt(a.split('-')[1]);\n    const bIndex = parseInt(b.split('-')[1]);\n    return aIndex - bIndex;\n  });\n\n  for (const chunkFile of chunkFiles) {\n    const chunkPath = path.join(chunkDir, chunkFile);\n    const data = await fs.readFile(chunkPath);\n    writeStream.write(data);\n  }\n\n  writeStream.end();\n  await fs.rm(chunkDir, { recursive: true });\n\n  res.json({ success: true, url: `/uploads/${fileName}` });\n});\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"pattern-7-image-compression-before-upload",children:"Pattern 7: Image Compression Before Upload"}),"\n",(0,t.jsx)(n.p,{children:"Reduce file size client-side before uploading."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"async function compressImage(file: File, maxWidth = 1920): Promise<Blob> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d')!;\n\n    img.onload = () => {\n      const scaleFactor = Math.min(1, maxWidth / img.width);\n      canvas.width = img.width * scaleFactor;\n      canvas.height = img.height * scaleFactor;\n\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n      canvas.toBlob(\n        (blob) => {\n          if (blob) resolve(blob);\n          else reject(new Error('Compression failed'));\n        },\n        'image/jpeg',\n        0.9 // Quality (0-1)\n      );\n    };\n\n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n}\n\n// Usage\nasync function handleImageUpload(file: File) {\n  if (file.size > 2 * 1024 * 1024) {\n    // Compress if > 2MB\n    const compressed = await compressImage(file);\n    uploadFile(compressed);\n  } else {\n    uploadFile(file);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u25a1 File size validation (client + server)\n\u25a1 File type validation (MIME type check)\n\u25a1 Progress indicator for uploads &gt;1MB\n\u25a1 Error handling with retry capability\n\u25a1 Cancel upload functionality\n\u25a1 Image compression for large files\n\u25a1 Chunked upload for files &gt;10MB\n\u25a1 Drag-and-drop support\n\u25a1 Preview for image uploads\n\u25a1 Accessible file input labels\n\u25a1 Security: virus scanning on server\n\u25a1 Security: filename sanitization\n\u25a1 Security: storage quota enforcement\n\u25a1 HTTPS required for uploads\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate MIME type on server"}),": Don't trust client-side checks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rename files"}),": Avoid executing uploaded scripts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Store outside web root"}),": Prevent direct access"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Virus scanning"}),": Use ClamAV or similar"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate limiting"}),": Prevent abuse"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"}),": Require login for uploads"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Server-side validation (Node.js)\nimport fileType from 'file-type';\n\napp.post('/upload', async (req, res) => {\n  const file = req.files.upload;\n\n  // Validate actual file type\n  const type = await fileType.fromBuffer(file.data);\n  if (!['image/jpeg', 'image/png'].includes(type.mime)) {\n    return res.status(400).json({ error: 'Invalid file type' });\n  }\n\n  // Generate safe filename\n  const ext = type.ext;\n  const safeName = `${Date.now()}-${Math.random().toString(36)}.${ext}`;\n\n  // Store outside public directory\n  await file.mv(`/var/uploads/${safeName}`);\n\n  res.json({ url: `/files/${safeName}` });\n});\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/File_API",children:"MDN: File API"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/FormData",children:"MDN: FormData"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://react-dropzone.js.org/",children:"react-dropzone"})," - Popular drag-and-drop library"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://uppy.io/",children:"Uppy"})," - Full-featured upload library"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}}}]);