"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[21433],{9600:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"skills/real_time_collaboration_engine/references/websocket-scaling","title":"WebSocket Scaling Strategies","description":"Production patterns for scaling WebSocket connections to millions of concurrent users.","source":"@site/docs/skills/real_time_collaboration_engine/references/websocket-scaling.md","sourceDirName":"skills/real_time_collaboration_engine/references","slug":"/skills/real_time_collaboration_engine/references/websocket-scaling","permalink":"/docs/skills/real_time_collaboration_engine/references/websocket-scaling","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"WebSocket Scaling Strategies","sidebar_label":"WebSocket Scaling Strategies","sidebar_position":3}}');var r=s(74848),i=s(28453);const o={title:"WebSocket Scaling Strategies",sidebar_label:"WebSocket Scaling Strategies",sidebar_position:3},c="WebSocket Scaling Strategies",a={},l=[{value:"The Challenge",id:"the-challenge",level:2},{value:"Architecture Patterns",id:"architecture-patterns",level:2},{value:"Pattern 1: Horizontal Scaling with Redis Pub/Sub",id:"pattern-1-horizontal-scaling-with-redis-pubsub",level:3},{value:"Pattern 2: Sticky Sessions with Load Balancer",id:"pattern-2-sticky-sessions-with-load-balancer",level:3},{value:"Pattern 3: Namespace/Room-Based Sharding",id:"pattern-3-namespaceroom-based-sharding",level:3},{value:"Pattern 4: Microservice-Based Architecture",id:"pattern-4-microservice-based-architecture",level:3},{value:"Connection Management",id:"connection-management",level:2},{value:"Pattern 5: Connection Pooling",id:"pattern-5-connection-pooling",level:3},{value:"Pattern 6: Heartbeat/Ping-Pong",id:"pattern-6-heartbeatping-pong",level:3},{value:"Message Optimization",id:"message-optimization",level:2},{value:"Pattern 7: Message Batching",id:"pattern-7-message-batching",level:3},{value:"Pattern 8: Message Compression",id:"pattern-8-message-compression",level:3},{value:"Monitoring and Metrics",id:"monitoring-and-metrics",level:2},{value:"Pattern 9: Real-Time Metrics",id:"pattern-9-real-time-metrics",level:3},{value:"Cloud Scaling",id:"cloud-scaling",level:2},{value:"AWS Architecture",id:"aws-architecture",level:3},{value:"Kubernetes Architecture",id:"kubernetes-architecture",level:3},{value:"Cost Optimization",id:"cost-optimization",level:2},{value:"Pattern 10: Regional Sharding",id:"pattern-10-regional-sharding",level:3},{value:"Capacity Planning",id:"capacity-planning",level:2},{value:"Formulas",id:"formulas",level:3},{value:"Production Checklist",id:"production-checklist",level:2},{value:"Load Testing",id:"load-testing",level:2},{value:"Using Artillery",id:"using-artillery",level:3},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"websocket-scaling-strategies",children:"WebSocket Scaling Strategies"})}),"\n",(0,r.jsx)(n.p,{children:"Production patterns for scaling WebSocket connections to millions of concurrent users."}),"\n",(0,r.jsx)(n.h2,{id:"the-challenge",children:"The Challenge"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Single server limits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js: ~10,000 concurrent WebSocket connections"}),"\n",(0,r.jsx)(n.li,{children:"Memory: 1MB per connection"}),"\n",(0,r.jsx)(n.li,{children:"CPU: Context switching overhead"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1 million users"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Requires: 100 servers (10k connections each)"}),"\n",(0,r.jsx)(n.li,{children:"Memory: 1TB total"}),"\n",(0,r.jsx)(n.li,{children:"Challenge: Cross-server communication"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"architecture-patterns",children:"Architecture Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-1-horizontal-scaling-with-redis-pubsub",children:"Pattern 1: Horizontal Scaling with Redis Pub/Sub"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Users on different servers can't communicate"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Redis as message bus"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"User A (Server 1) \u2192 Redis \u2192 User B (Server 2)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Server setup\nimport { createServer } from 'http';\nimport { Server } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\nimport { createClient } from 'redis';\n\nconst httpServer = createServer();\nconst io = new Server(httpServer);\n\n// Redis clients\nconst pubClient = createClient({ url: 'redis://localhost:6379' });\nconst subClient = pubClient.duplicate();\n\nPromise.all([pubClient.connect(), subClient.connect()]).then(() => {\n  // Use Redis adapter\n  io.adapter(createAdapter(pubClient, subClient));\n});\n\n// Now rooms work across servers!\nio.to('room-123').emit('message', { text: 'Hello' });\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Redis throughput: ~100k messages/second"}),"\n",(0,r.jsx)(n.li,{children:"Latency: <5ms additional overhead"}),"\n",(0,r.jsx)(n.li,{children:"Can scale to millions of connections"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"pattern-2-sticky-sessions-with-load-balancer",children:"Pattern 2: Sticky Sessions with Load Balancer"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": HTTP polling falls back requires same server"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Route user to same server"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"nginx config"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'upstream websocket_servers {\n  # Sticky sessions based on IP\n  ip_hash;\n\n  server ws1.example.com:3000;\n  server ws2.example.com:3000;\n  server ws3.example.com:3000;\n}\n\nserver {\n  listen 80;\n\n  location /socket.io/ {\n    proxy_pass http://websocket_servers;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_set_header Host $host;\n\n    # Sticky sessions\n    proxy_set_header X-Real-IP $remote_addr;\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Alternatives to ip_hash"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Cookie-based (",(0,r.jsx)(n.code,{children:"sticky"})," module)"]}),"\n",(0,r.jsx)(n.li,{children:"Session ID-based"}),"\n",(0,r.jsx)(n.li,{children:"Consistent hashing"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"pattern-3-namespaceroom-based-sharding",children:"Pattern 3: Namespace/Room-Based Sharding"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Not all users need to be connected"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Shard by room/namespace"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Shard by document ID\nconst documentId = 'doc-123';\nconst shard = Math.abs(hashCode(documentId)) % serverCount;\n\n// Route to specific server\nconst serverUrl = `ws://shard-${shard}.example.com`;\nconst socket = io(serverUrl);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Users only connect to servers with their documents"}),"\n",(0,r.jsx)(n.li,{children:"Natural load distribution"}),"\n",(0,r.jsx)(n.li,{children:"Can scale specific shards"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Consistent hashing\nimport crypto from 'crypto';\n\nfunction getShardForDocument(documentId: string, totalShards: number): number {\n  const hash = crypto.createHash('md5').update(documentId).digest('hex');\n  const hashInt = parseInt(hash.substring(0, 8), 16);\n  return hashInt % totalShards;\n}\n\n// Client connects to correct shard\nconst shard = getShardForDocument('doc-123', 10);\nconst socket = io(`wss://shard-${shard}.example.com`);\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"pattern-4-microservice-based-architecture",children:"Pattern 4: Microservice-Based Architecture"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Monolithic WebSocket server doing too much"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Separate concerns"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Gateway    \u2502  (WebSocket connections)\n\u2502   Servers    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500\u2192 Document Service (CRDT sync)\n       \u251c\u2500\u2192 Presence Service (cursors, users)\n       \u251c\u2500\u2192 Auth Service (authentication)\n       \u2514\u2500\u2192 Notification Service (toasts, alerts)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Scale services independently"}),"\n",(0,r.jsx)(n.li,{children:"Easier to maintain"}),"\n",(0,r.jsx)(n.li,{children:"Can use different languages per service"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Gateway server (handles connections)\nio.on('connection', (socket) => {\n  // Forward to appropriate service\n  socket.on('document-change', async (data) => {\n    const result = await documentService.applyChange(data);\n    io.to(data.documentId).emit('document-updated', result);\n  });\n\n  socket.on('cursor-move', async (data) => {\n    await presenceService.updateCursor(socket.id, data);\n  });\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-5-connection-pooling",children:"Pattern 5: Connection Pooling"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Creating new connections is expensive"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Reuse connections"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"class ConnectionPool {\n  private connections: Map<string, Socket> = new Map();\n  private maxIdleTime = 60000; // 1 minute\n\n  getConnection(userId: string): Socket {\n    if (this.connections.has(userId)) {\n      return this.connections.get(userId)!;\n    }\n\n    const socket = this.createConnection(userId);\n    this.connections.set(userId, socket);\n\n    // Clean up idle connections\n    setTimeout(() => {\n      if (!this.isActive(socket)) {\n        socket.disconnect();\n        this.connections.delete(userId);\n      }\n    }, this.maxIdleTime);\n\n    return socket;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"pattern-6-heartbeatping-pong",children:"Pattern 6: Heartbeat/Ping-Pong"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Dead connections consuming resources"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Detect and close dead connections"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const HEARTBEAT_INTERVAL = 30000; // 30 seconds\nconst HEARTBEAT_TIMEOUT = 5000;   // 5 seconds\n\nio.on('connection', (socket) => {\n  let lastPong = Date.now();\n\n  // Send ping\n  const interval = setInterval(() => {\n    socket.emit('ping');\n  }, HEARTBEAT_INTERVAL);\n\n  // Receive pong\n  socket.on('pong', () => {\n    lastPong = Date.now();\n  });\n\n  // Check for timeout\n  const timeoutCheck = setInterval(() => {\n    if (Date.now() - lastPong > HEARTBEAT_TIMEOUT) {\n      console.log('Connection timeout, closing');\n      socket.disconnect();\n    }\n  }, HEARTBEAT_INTERVAL);\n\n  socket.on('disconnect', () => {\n    clearInterval(interval);\n    clearInterval(timeoutCheck);\n  });\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"message-optimization",children:"Message Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-7-message-batching",children:"Pattern 7: Message Batching"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Too many small messages"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Batch messages"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"class MessageBatcher {\n  private batch: any[] = [];\n  private batchInterval = 100; // ms\n  private timer: NodeJS.Timeout | null = null;\n\n  add(message: any): void {\n    this.batch.push(message);\n\n    if (!this.timer) {\n      this.timer = setTimeout(() => {\n        this.flush();\n      }, this.batchInterval);\n    }\n  }\n\n  private flush(): void {\n    if (this.batch.length > 0) {\n      socket.emit('batch', this.batch);\n      this.batch = [];\n    }\n    this.timer = null;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Impact"}),": 1000 messages/sec \u2192 10 batches/sec (100x reduction)"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"pattern-8-message-compression",children:"Pattern 8: Message Compression"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Large payloads waste bandwidth"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Compress messages"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import pako from 'pako';\n\n// Compression middleware\nio.use((socket, next) => {\n  // Compress outgoing\n  const originalEmit = socket.emit.bind(socket);\n  socket.emit = function (event: string, data: any) {\n    const compressed = pako.deflate(JSON.stringify(data));\n    return originalEmit(event, compressed);\n  };\n\n  // Decompress incoming\n  socket.onAny((event, data) => {\n    if (data instanceof Buffer) {\n      const decompressed = pako.inflate(data, { to: 'string' });\n      socket.emit(event, JSON.parse(decompressed));\n    }\n  });\n\n  next();\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Impact"}),": 100KB payload \u2192 20KB compressed (80% reduction)"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-and-metrics",children:"Monitoring and Metrics"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-9-real-time-metrics",children:"Pattern 9: Real-Time Metrics"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Track"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Active connections per server"}),"\n",(0,r.jsx)(n.li,{children:"Messages per second"}),"\n",(0,r.jsx)(n.li,{children:"Average latency"}),"\n",(0,r.jsx)(n.li,{children:"Error rate"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { register, Counter, Gauge, Histogram } from 'prom-client';\n\n// Metrics\nconst connectionsGauge = new Gauge({\n  name: 'websocket_connections',\n  help: 'Number of active WebSocket connections'\n});\n\nconst messagesCounter = new Counter({\n  name: 'websocket_messages_total',\n  help: 'Total WebSocket messages',\n  labelNames: ['type', 'direction']\n});\n\nconst latencyHistogram = new Histogram({\n  name: 'websocket_message_latency_ms',\n  help: 'Message round-trip latency',\n  buckets: [10, 50, 100, 500, 1000, 5000]\n});\n\n// Update metrics\nio.on('connection', (socket) => {\n  connectionsGauge.inc();\n\n  socket.on('message', (data) => {\n    messagesCounter.inc({ type: 'message', direction: 'inbound' });\n    const latency = Date.now() - data.timestamp;\n    latencyHistogram.observe(latency);\n  });\n\n  socket.on('disconnect', () => {\n    connectionsGauge.dec();\n  });\n});\n\n// Expose metrics endpoint\napp.get('/metrics', (req, res) => {\n  res.set('Content-Type', register.contentType);\n  res.end(register.metrics());\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cloud-scaling",children:"Cloud Scaling"}),"\n",(0,r.jsx)(n.h3,{id:"aws-architecture",children:"AWS Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502  Application     \u2502\n                     \u2502  Load Balancer   \u2502\n                     \u2502  (ALB)           \u2502\n                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502               \u2502               \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 WebSocket \u2502   \u2502 WebSocket \u2502  \u2502 WebSocket \u2502\n        \u2502 Server 1  \u2502   \u2502 Server 2  \u2502  \u2502 Server 3  \u2502\n        \u2502 (EC2)     \u2502   \u2502 (EC2)     \u2502  \u2502 (EC2)     \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502              \u2502              \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  ElastiCache    \u2502\n                    \u2502  (Redis)        \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Auto-scaling"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# EC2 Auto Scaling Group\nScalingPolicy:\n  MetricType: Custom\n  Metric: WebSocketConnections\n  TargetValue: 8000  # Scale at 80% of 10k limit\n  ScaleUp: Add 1 instance\n  ScaleDown: Remove 1 instance (drain connections first)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"kubernetes-architecture",children:"Kubernetes Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: websocket-server\nspec:\n  replicas: 5\n  selector:\n    matchLabels:\n      app: websocket\n  template:\n    metadata:\n      labels:\n        app: websocket\n    spec:\n      containers:\n      - name: server\n        image: myapp/websocket:latest\n        ports:\n        - containerPort: 3000\n        env:\n        - name: REDIS_URL\n          value: redis://redis-service:6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: websocket-service\nspec:\n  type: LoadBalancer\n  selector:\n    app: websocket\n  ports:\n  - port: 80\n    targetPort: 3000\n  sessionAffinity: ClientIP  # Sticky sessions\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Horizontal Pod Autoscaler"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: websocket-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: websocket-server\n  minReplicas: 3\n  maxReplicas: 50\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 70\n  - type: Pods\n    pods:\n      metric:\n        name: websocket_connections\n      target:\n        type: AverageValue\n        averageValue: "8000"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cost-optimization",children:"Cost Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"pattern-10-regional-sharding",children:"Pattern 10: Regional Sharding"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Global latency"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Deploy regionally"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  US-East   \u2502     \u2502  EU-West   \u2502     \u2502  AP-South  \u2502\n\u2502  Cluster   \u2502     \u2502  Cluster   \u2502     \u2502  Cluster   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                  \u2502                  \u2502\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502   Global    \u2502\n                  \u2502   Redis     \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Latency reduction"}),": 200ms \u2192 20ms for nearby users"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"capacity-planning",children:"Capacity Planning"}),"\n",(0,r.jsx)(n.h3,{id:"formulas",children:"Formulas"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Connections per server"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Max Connections = (Available RAM - OS Overhead) / Memory per Connection\n                = (16 GB - 2 GB) / 1 MB\n                = 14,000 connections\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Servers needed"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Servers = Total Users / Connections per Server\n        = 1,000,000 / 10,000\n        = 100 servers\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Monthly cost"})," (AWS t3.large, $0.0832/hour):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Cost = Servers \xd7 Hours per Month \xd7 Rate\n     = 100 \xd7 730 \xd7 $0.0832\n     = $6,074 per month\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u25a1 Redis Pub/Sub for cross-server communication\n\u25a1 Sticky sessions configured\n\u25a1 Heartbeat/ping-pong to detect dead connections\n\u25a1 Message batching (100-200ms)\n\u25a1 Message compression for large payloads\n\u25a1 Monitoring (connections, messages/sec, latency)\n\u25a1 Auto-scaling based on connection count\n\u25a1 Regional deployment for low latency\n\u25a1 Load testing (simulate peak load)\n\u25a1 Graceful shutdown (drain connections)\n\u25a1 Circuit breaker for downstream services\n\u25a1 Rate limiting per user\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"load-testing",children:"Load Testing"}),"\n",(0,r.jsx)(n.h3,{id:"using-artillery",children:"Using Artillery"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# load-test.yml\nconfig:\n  target: "wss://localhost:3000"\n  phases:\n    - duration: 60\n      arrivalRate: 100  # 100 connections/sec\n      name: "Ramp up"\n    - duration: 300\n      arrivalRate: 1000  # 1000 connections/sec\n      name: "Sustained load"\n  engines:\n    socketio: {}\n\nscenarios:\n  - engine: socketio\n    flow:\n      - emit:\n          channel: "join-room"\n          data:\n            roomId: "{{ $randomString() }}"\n      - think: 5\n      - loop:\n          - emit:\n              channel: "message"\n              data:\n                text: "Hello {{ $randomString() }}"\n          - think: 2\n        count: 10\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"artillery run load-test.yml\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://socket.io/docs/v4/using-multiple-nodes/",children:"Socket.IO Scaling"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/socketio/socket.io-redis-adapter",children:"Redis Adapter"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-target-groups.html#websockets",children:"AWS ALB WebSocket"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/",children:"Kubernetes HPA"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);