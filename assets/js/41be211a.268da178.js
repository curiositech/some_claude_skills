"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[94108],{28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var s=t(96540);const i={},r=s.createContext(i);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:n},e.children)}},59801:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"skills/vitest_testing_patterns/index","title":"\u2705 Vitest Testing Patterns","description":"Write tests using Vitest and React Testing Library. Use when creating unit tests, component tests, integration tests, or mocking dependencies. Activates for test file creation, mock patterns, coverage, and testing best practices.","source":"@site/docs/skills/vitest_testing_patterns/index.md","sourceDirName":"skills/vitest_testing_patterns","slug":"/skills/vitest_testing_patterns/","permalink":"/docs/skills/vitest_testing_patterns/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Vitest Testing Patterns","sidebar_position":1}}');var i=t(74848),r=t(28453);const c={sidebar_label:"Vitest Testing Patterns",sidebar_position:1},o="\u2705 Vitest Testing Patterns",a={},l=[{value:"Allowed Tools",id:"allowed-tools",level:2},{value:"Tags",id:"tags",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"Test Infrastructure",id:"test-infrastructure",level:2},{value:"File Organization",id:"file-organization",level:2},{value:"Core Testing Patterns",id:"core-testing-patterns",level:2},{value:"1. API Route Tests",id:"1-api-route-tests",level:3},{value:"2. Component Tests",id:"2-component-tests",level:3},{value:"3. Library/Utility Tests",id:"3-libraryutility-tests",level:3},{value:"Mocking Patterns",id:"mocking-patterns",level:2},{value:"Module Mocking",id:"module-mocking",level:3},{value:"Function Mocking",id:"function-mocking",level:3},{value:"Chained Mock Pattern (Drizzle ORM)",id:"chained-mock-pattern-drizzle-orm",level:3},{value:"Timer Mocking",id:"timer-mocking",level:3},{value:"Query Priorities",id:"query-priorities",level:2},{value:"Async Patterns",id:"async-patterns",level:2},{value:"Test Cleanup",id:"test-cleanup",level:2},{value:"Accessibility Testing",id:"accessibility-testing",level:2},{value:"Common Matchers",id:"common-matchers",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-vitest-testing-patterns",children:"\u2705 Vitest Testing Patterns"})}),"\n",(0,i.jsx)(n.p,{children:"Write tests using Vitest and React Testing Library. Use when creating unit tests, component tests, integration tests, or mocking dependencies. Activates for test file creation, mock patterns, coverage, and testing best practices."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"allowed-tools",children:"Allowed Tools"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Read, Write, Edit, Bash(npm:*, npx:*)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"tags",children:"Tags"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"testing"})," ",(0,i.jsx)(n.code,{children:"code"})," ",(0,i.jsx)(n.code,{children:"automation"})," ",(0,i.jsx)(n.code,{children:"jest"})," ",(0,i.jsx)(n.code,{children:"react"})]}),"\n",(0,i.jsx)(n.h1,{id:"vitest-testing-patterns",children:"Vitest Testing Patterns"}),"\n",(0,i.jsx)(n.p,{children:"This skill helps you write effective tests using Vitest and React Testing Library following project conventions."}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"USE this skill for:"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Writing unit tests for utilities and functions"}),"\n",(0,i.jsx)(n.li,{children:"Creating component tests with React Testing Library"}),"\n",(0,i.jsx)(n.li,{children:"Setting up mocks for API calls, databases, or external services"}),"\n",(0,i.jsx)(n.li,{children:"Integration testing patterns"}),"\n",(0,i.jsx)(n.li,{children:"Understanding test coverage and CI setup"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u274c ",(0,i.jsx)(n.strong,{children:"DO NOT use for:"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Jest-specific patterns \u2192 similar but check Jest docs for differences"}),"\n",(0,i.jsx)(n.li,{children:"End-to-end testing \u2192 use Playwright or Cypress skills"}),"\n",(0,i.jsx)(n.li,{children:"Performance testing \u2192 use dedicated performance tools"}),"\n",(0,i.jsx)(n.li,{children:"API contract testing \u2192 use OpenAPI/Pact patterns"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-infrastructure",children:"Test Infrastructure"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Configuration"}),": ",(0,i.jsx)(n.code,{children:"vitest.config.ts"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Environment: jsdom"}),"\n",(0,i.jsxs)(n.li,{children:["Setup file: ",(0,i.jsx)(n.code,{children:"src/test/setup.ts"})]}),"\n",(0,i.jsx)(n.li,{children:"Coverage: v8 provider"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Commands"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm test              # Watch mode\nnpm run test:run      # Single run\nnpm run test:coverage # With coverage\n"})}),"\n",(0,i.jsx)(n.h2,{id:"file-organization",children:"File Organization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/\n\u251c\u2500\u2500 app/api/__tests__/        # API route tests\n\u251c\u2500\u2500 components/__tests__/     # Component tests\n\u251c\u2500\u2500 lib/__tests__/            # Library/utility tests\n\u2514\u2500\u2500 lib/{feature}/__tests__/  # Feature-specific tests\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Name tests as ",(0,i.jsx)(n.code,{children:"{name}.test.ts"})," or ",(0,i.jsx)(n.code,{children:"{name}.test.tsx"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"core-testing-patterns",children:"Core Testing Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"1-api-route-tests",children:"1. API Route Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { GET, POST } from '../route';\nimport { NextRequest } from 'next/server';\n\n// Mock dependencies\nvi.mock('@/lib/auth', () => ({\n  getSession: vi.fn(),\n}));\n\nvi.mock('@/db', () => ({\n  db: {\n    select: vi.fn().mockReturnThis(),\n    from: vi.fn().mockReturnThis(),\n    where: vi.fn().mockResolvedValue([]),\n  },\n}));\n\ndescribe('GET /api/feature', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('returns 401 when not authenticated', async () => {\n    vi.mocked(getSession).mockResolvedValue(null);\n\n    const request = new NextRequest('http://localhost/api/feature');\n    const response = await GET(request);\n\n    expect(response.status).toBe(401);\n  });\n\n  it('returns data when authenticated', async () => {\n    vi.mocked(getSession).mockResolvedValue({ userId: 'user-123' });\n    vi.mocked(db.select).mockReturnValue({\n      from: vi.fn().mockReturnValue({\n        where: vi.fn().mockResolvedValue([{ id: '1', name: 'Test' }]),\n      }),\n    });\n\n    const request = new NextRequest('http://localhost/api/feature');\n    const response = await GET(request);\n    const data = await response.json();\n\n    expect(response.status).toBe(200);\n    expect(data).toHaveLength(1);\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-component-tests",children:"2. Component Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { describe, it, expect, vi } from 'vitest';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { FeatureComponent } from '../FeatureComponent';\n\n// Mock hooks\nvi.mock('@/hooks/useAuth', () => ({\n  useAuth: vi.fn().mockReturnValue({\n    user: { id: 'user-123', name: 'Test User' },\n    isLoading: false,\n  }),\n}));\n\ndescribe('FeatureComponent', () => {\n  it('renders loading state', () => {\n    vi.mocked(useAuth).mockReturnValueOnce({\n      user: null,\n      isLoading: true,\n    });\n\n    render(<FeatureComponent />);\n    expect(screen.getByText(/loading/i)).toBeInTheDocument();\n  });\n\n  it('handles user interaction', async () => {\n    const user = userEvent.setup();\n    const onSubmit = vi.fn();\n\n    render(<FeatureComponent onSubmit={onSubmit} />);\n\n    await user.type(screen.getByRole('textbox'), 'Test input');\n    await user.click(screen.getByRole('button', { name: /submit/i }));\n\n    expect(onSubmit).toHaveBeenCalledWith('Test input');\n  });\n\n  it('displays error state', async () => {\n    vi.mocked(fetch).mockRejectedValueOnce(new Error('Network error'));\n\n    render(<FeatureComponent />);\n\n    await waitFor(() => {\n      expect(screen.getByRole('alert')).toHaveTextContent(/error/i);\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-libraryutility-tests",children:"3. Library/Utility Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport { processData, formatDate } from '../utils';\n\ndescribe('processData', () => {\n  it('transforms input correctly', () => {\n    const input = { raw: 'data' };\n    const result = processData(input);\n\n    expect(result).toEqual({\n      processed: true,\n      data: 'DATA',\n    });\n  });\n\n  it('throws on invalid input', () => {\n    expect(() => processData(null)).toThrow('Invalid input');\n  });\n});\n\ndescribe('formatDate', () => {\n  beforeEach(() => {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2025-01-15T10:00:00Z'));\n  });\n\n  afterEach(() => {\n    vi.useRealTimers();\n  });\n\n  it('formats relative dates', () => {\n    const yesterday = new Date('2025-01-14T10:00:00Z');\n    expect(formatDate(yesterday)).toBe('yesterday');\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"mocking-patterns",children:"Mocking Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"module-mocking",children:"Module Mocking"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Mock entire module\nvi.mock('@/lib/auth', () => ({\n  getSession: vi.fn(),\n  requireAuth: vi.fn(),\n}));\n\n// Mock with partial implementation\nvi.mock('date-fns', async () => {\n  const actual = await vi.importActual('date-fns');\n  return {\n    ...actual,\n    format: vi.fn(() => '2025-01-15'),\n  };\n});\n\n// Mock default export (like Anthropic SDK)\nvi.mock('@anthropic-ai/sdk', () => ({\n  default: class MockAnthropic {\n    messages = {\n      create: vi.fn().mockResolvedValue({\n        content: [{ type: 'text', text: 'Mock response' }],\n        usage: { input_tokens: 10, output_tokens: 20 },\n      }),\n    };\n  },\n}));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"function-mocking",children:"Function Mocking"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Create mock function\nconst mockFn = vi.fn();\n\n// Set return values\nmockFn.mockReturnValue('sync value');\nmockFn.mockResolvedValue('async value');\nmockFn.mockRejectedValue(new Error('Failed'));\n\n// One-time behavior\nmockFn.mockReturnValueOnce('first call only');\n\n// Custom implementation\nmockFn.mockImplementation((arg) => arg.toUpperCase());\n\n// Verify calls\nexpect(mockFn).toHaveBeenCalled();\nexpect(mockFn).toHaveBeenCalledTimes(2);\nexpect(mockFn).toHaveBeenCalledWith('expected', 'args');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"chained-mock-pattern-drizzle-orm",children:"Chained Mock Pattern (Drizzle ORM)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"vi.mock('@/db', () => ({\n  db: {\n    select: vi.fn().mockReturnValue({\n      from: vi.fn().mockReturnValue({\n        where: vi.fn().mockReturnValue({\n          orderBy: vi.fn().mockReturnValue({\n            limit: vi.fn().mockResolvedValue([{ id: '1' }]),\n          }),\n        }),\n      }),\n    }),\n    insert: vi.fn().mockReturnValue({\n      values: vi.fn().mockReturnValue({\n        returning: vi.fn().mockResolvedValue([{ id: 'new-1' }]),\n      }),\n    }),\n  },\n}));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"timer-mocking",children:"Timer Mocking"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"describe('debounced function', () => {\n  beforeEach(() => {\n    vi.useFakeTimers();\n  });\n\n  afterEach(() => {\n    vi.useRealTimers();\n  });\n\n  it('debounces calls', async () => {\n    const callback = vi.fn();\n    const debounced = debounce(callback, 300);\n\n    debounced();\n    debounced();\n    debounced();\n\n    expect(callback).not.toHaveBeenCalled();\n\n    vi.advanceTimersByTime(300);\n\n    expect(callback).toHaveBeenCalledTimes(1);\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"query-priorities",children:"Query Priorities"}),"\n",(0,i.jsx)(n.p,{children:"Use queries in this order (most to least preferred):"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"getByRole"})," - Accessible queries (buttons, links, headings)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"getByLabelText"})," - Form fields with labels"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"getByPlaceholderText"})," - Inputs with placeholders"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"getByText"})," - Non-interactive elements"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"getByTestId"})," - Last resort (data-testid)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Preferred\nscreen.getByRole('button', { name: /submit/i });\nscreen.getByRole('heading', { level: 1 });\nscreen.getByLabelText(/email/i);\n\n// Avoid unless necessary\nscreen.getByTestId('submit-button');\n"})}),"\n",(0,i.jsx)(n.h2,{id:"async-patterns",children:"Async Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Wait for element to appear\nawait waitFor(() => {\n  expect(screen.getByText('Loaded')).toBeInTheDocument();\n});\n\n// Find (built-in waitFor)\nconst element = await screen.findByText('Loaded');\n\n// Wait for element to disappear\nawait waitFor(() => {\n  expect(screen.queryByText('Loading')).not.toBeInTheDocument();\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-cleanup",children:"Test Cleanup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { cleanup } from '@testing-library/react';\n\nafterEach(() => {\n  cleanup();            // React cleanup (automatic with setup.ts)\n  vi.clearAllMocks();   // Reset mock call counts\n  vi.resetAllMocks();   // Reset mocks to initial state\n  vi.restoreAllMocks(); // Restore original implementations\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"accessibility-testing",children:"Accessibility Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { axe, toHaveNoViolations } from 'jest-axe';\n\nexpect.extend(toHaveNoViolations);\n\nit('has no accessibility violations', async () => {\n  const { container } = render(<Component />);\n  const results = await axe(container);\n  expect(results).toHaveNoViolations();\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-matchers",children:"Common Matchers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// jest-dom matchers (from setup.ts)\nexpect(element).toBeInTheDocument();\nexpect(element).toBeVisible();\nexpect(element).toBeDisabled();\nexpect(element).toHaveTextContent('text');\nexpect(element).toHaveAttribute('href', '/path');\nexpect(element).toHaveClass('active');\nexpect(input).toHaveValue('input value');\n"})}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://vitest.dev/guide/mocking",children:"Vitest Mocking Guide"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://testing-library.com/docs/react-testing-library/intro",children:"React Testing Library"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://testing-library.com/docs/queries/about",children:"Testing Library Queries"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);