"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[33235],{15325:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"skills/modern_auth_2026/index","title":"\u2699\ufe0f Modern Auth 2026","description":"Modern authentication implementation for 2026 - passkeys (WebAuthn), OAuth (Google, Apple), magic links, and cross-device sync. Use for passwordless-first authentication, social login setup, Supabase Auth, Next.js auth flows, and multi-factor authentication. Activate on \\"passkeys\\", \\"WebAuthn\\", \\"Google Sign-In\\", \\"Apple Sign-In\\", \\"magic link\\", \\"passwordless\\", \\"authentication\\", \\"login\\", \\"OAuth\\", \\"social login\\". NOT for session management without auth (use standard JWT docs), authorization/RBAC (use security-auditor), or API key management (use api-architect).","source":"@site/docs/skills/modern_auth_2026/index.md","sourceDirName":"skills/modern_auth_2026","slug":"/skills/modern_auth_2026/","permalink":"/docs/skills/modern_auth_2026/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Modern Auth 2026","sidebar_position":1}}');var t=s(74848),r=s(28453);const a={sidebar_label:"Modern Auth 2026",sidebar_position:1},l="\u2699\ufe0f Modern Auth 2026",o={},c=[{value:"Allowed Tools",id:"allowed-tools",level:2},{value:"Tags",id:"tags",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"2026 Authentication Landscape",id:"2026-authentication-landscape",level:2},{value:"Industry Adoption Stats",id:"industry-adoption-stats",level:3},{value:"Key Standards",id:"key-standards",level:3},{value:"Architecture: Passwordless-First Design",id:"architecture-passwordless-first-design",level:2},{value:"Recommended Auth Hierarchy (2026)",id:"recommended-auth-hierarchy-2026",level:3},{value:"Security Tier Comparison",id:"security-tier-comparison",level:3},{value:"Passkeys (WebAuthn) Implementation",id:"passkeys-webauthn-implementation",level:2},{value:"How Passkeys Work",id:"how-passkeys-work",level:3},{value:"Library Recommendations",id:"library-recommendations",level:3},{value:"Next.js Passkey Implementation",id:"nextjs-passkey-implementation",level:3},{value:"OAuth: Google Sign-In",id:"oauth-google-sign-in",level:2},{value:"Setup Requirements",id:"setup-requirements",level:3},{value:"Implementation",id:"implementation",level:3},{value:"OAuth: Apple Sign-In",id:"oauth-apple-sign-in",level:2},{value:"App Store Requirements (2024+)",id:"app-store-requirements-2024",level:3},{value:"Setup Requirements",id:"setup-requirements-1",level:3},{value:"Implementation",id:"implementation-1",level:3},{value:"Magic Links (Email Passwordless)",id:"magic-links-email-passwordless",level:2},{value:"Best Practices",id:"best-practices",level:3},{value:"Email Template Customization",id:"email-template-customization",level:3},{value:"Recovery Flows",id:"recovery-flows",level:2},{value:"Email Recovery (Password Reset)",id:"email-recovery-password-reset",level:3},{value:"Account Recovery Hierarchy",id:"account-recovery-hierarchy",level:3},{value:"Implementing Backup Passkeys",id:"implementing-backup-passkeys",level:3},{value:"Cross-Device Sync",id:"cross-device-sync",level:2},{value:"How Passkey Sync Works",id:"how-passkey-sync-works",level:3},{value:"Cross-Platform Authentication (QR Code)",id:"cross-platform-authentication-qr-code",level:3},{value:"Supabase Auth Configuration Checklist",id:"supabase-auth-configuration-checklist",level:2},{value:"Dashboard Settings",id:"dashboard-settings",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Common Issues &amp; Solutions",id:"common-issues--solutions",level:2},{value:"Issue: Sign-up says &quot;Check email&quot; but no email arrives",id:"issue-sign-up-says-check-email-but-no-email-arrives",level:3},{value:"Issue: Apple Sign-In suddenly stops working",id:"issue-apple-sign-in-suddenly-stops-working",level:3},{value:"Issue: Google OAuth redirect error",id:"issue-google-oauth-redirect-error",level:3},{value:"Issue: Passkey not syncing between devices",id:"issue-passkey-not-syncing-between-devices",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Token Management",id:"token-management",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"Secure Defaults",id:"secure-defaults",level:3},{value:"References",id:"references",level:2},{value:"Official Documentation",id:"official-documentation",level:3},{value:"Libraries",id:"libraries",level:3},{value:"Research (2026)",id:"research-2026",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\ufe0f-modern-auth-2026",children:"\u2699\ufe0f Modern Auth 2026"})}),"\n",(0,t.jsx)(n.p,{children:'Modern authentication implementation for 2026 - passkeys (WebAuthn), OAuth (Google, Apple), magic links, and cross-device sync. Use for passwordless-first authentication, social login setup, Supabase Auth, Next.js auth flows, and multi-factor authentication. Activate on "passkeys", "WebAuthn", "Google Sign-In", "Apple Sign-In", "magic link", "passwordless", "authentication", "login", "OAuth", "social login". NOT for session management without auth (use standard JWT docs), authorization/RBAC (use security-auditor), or API key management (use api-architect).'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"allowed-tools",children:"Allowed Tools"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Read, Write, Edit, Bash, Grep, Glob, WebSearch, mcp__supabase__*\n"})}),"\n",(0,t.jsx)(n.h2,{id:"tags",children:"Tags"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"authentication"})," ",(0,t.jsx)(n.code,{children:"passkeys"})," ",(0,t.jsx)(n.code,{children:"webauthn"})," ",(0,t.jsx)(n.code,{children:"oauth"})," ",(0,t.jsx)(n.code,{children:"passwordless"})," ",(0,t.jsx)(n.code,{children:"supabase"})," ",(0,t.jsx)(n.code,{children:"mfa"})," ",(0,t.jsx)(n.code,{children:"social-login"})]}),"\n",(0,t.jsx)(n.h1,{id:"modern-authentication-expert-2026",children:"Modern Authentication Expert (2026)"}),"\n",(0,t.jsx)(n.p,{children:"Master passwordless-first authentication with passkeys, OAuth, magic links, and cross-device sync for modern web and mobile applications."}),"\n",(0,t.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"USE this skill for:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Implementing passkeys/WebAuthn authentication"}),"\n",(0,t.jsx)(n.li,{children:"Google and Apple OAuth social login"}),"\n",(0,t.jsx)(n.li,{children:"Supabase Auth configuration and troubleshooting"}),"\n",(0,t.jsx)(n.li,{children:"Magic link/OTP passwordless flows"}),"\n",(0,t.jsx)(n.li,{children:"Cross-device authentication sync"}),"\n",(0,t.jsx)(n.li,{children:"MFA implementation (TOTP, passkeys as 2FA)"}),"\n",(0,t.jsx)(n.li,{children:"Email/SMS recovery flows"}),"\n",(0,t.jsx)(n.li,{children:"App Store compliance for social login"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u274c ",(0,t.jsx)(n.strong,{children:"DO NOT use for:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Session management without auth context \u2192 use standard JWT patterns"}),"\n",(0,t.jsxs)(n.li,{children:["Authorization/RBAC policies \u2192 use ",(0,t.jsx)(n.code,{children:"security-auditor"})," skill"]}),"\n",(0,t.jsxs)(n.li,{children:["API key management \u2192 use ",(0,t.jsx)(n.code,{children:"api-architect"})," skill"]}),"\n",(0,t.jsxs)(n.li,{children:["Supabase RLS policies \u2192 use ",(0,t.jsx)(n.code,{children:"supabase-admin"})," skill"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2026-authentication-landscape",children:"2026 Authentication Landscape"}),"\n",(0,t.jsx)(n.h3,{id:"industry-adoption-stats",children:"Industry Adoption Stats"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Passkeys:"})," 87% of US/UK companies now use passkeys (FIDO Alliance)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Google:"})," 800+ million accounts use passkeys"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Amazon:"})," 175 million users created passkeys in first year"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Trend:"})," Passwordless is the security baseline, not a luxury"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"key-standards",children:"Key Standards"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Standard"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{children:"Status"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"WebAuthn L2"}),(0,t.jsx)(n.td,{children:"Browser passkey API"}),(0,t.jsx)(n.td,{children:"Fully supported"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"FIDO2/CTAP2"}),(0,t.jsx)(n.td,{children:"Cross-platform passkeys"}),(0,t.jsx)(n.td,{children:"Mature"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"OAuth 2.1"}),(0,t.jsx)(n.td,{children:"Simplified OAuth"}),(0,t.jsx)(n.td,{children:"Replacing 2.0"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"OAuth3"}),(0,t.jsx)(n.td,{children:"Short-lived tokens"}),(0,t.jsx)(n.td,{children:"Emerging"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Passkey Sync"}),(0,t.jsx)(n.td,{children:"iCloud/Google sync"}),(0,t.jsx)(n.td,{children:"Production"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"architecture-passwordless-first-design",children:"Architecture: Passwordless-First Design"}),"\n",(0,t.jsx)(n.h3,{id:"recommended-auth-hierarchy-2026",children:"Recommended Auth Hierarchy (2026)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Primary Methods (Phishing-Resistant):\n\u251c\u2500\u2500 1. Passkeys (WebAuthn) \u2190 PREFERRED\n\u2502   \u251c\u2500\u2500 Platform authenticators (Face ID, Touch ID, Windows Hello)\n\u2502   \u2514\u2500\u2500 Roaming authenticators (YubiKey, security keys)\n\u251c\u2500\u2500 2. Social OAuth\n\u2502   \u251c\u2500\u2500 Google Sign-In (synced passkeys)\n\u2502   \u2514\u2500\u2500 Apple Sign-In (privacy-focused)\n\u2502\nFallback Methods (Lower Security):\n\u251c\u2500\u2500 3. Magic Links (email-based)\n\u251c\u2500\u2500 4. Email OTP (time-limited codes)\n\u2514\u2500\u2500 5. SMS OTP (deprecated - SIM swap risk)\n    \u26a0\ufe0f SMS should be last resort only\n\nLegacy (Avoid):\n\u2514\u2500\u2500 6. Password + Email \u2190 DISCOURAGE\n"})}),"\n",(0,t.jsx)(n.h3,{id:"security-tier-comparison",children:"Security Tier Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Phishing-Resistant"}),(0,t.jsx)(n.th,{children:"Device-Bound"}),(0,t.jsx)(n.th,{children:"Sync-Capable"}),(0,t.jsx)(n.th,{children:"Friction"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Passkeys"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Low"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Hardware Key"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"Medium"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Google OAuth"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Low"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Apple OAuth"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Partial"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Low"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Magic Link"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Medium"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Email OTP"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Medium"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SMS OTP"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"Medium"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Password"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u274c No"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"}),(0,t.jsx)(n.td,{children:"Low"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"passkeys-webauthn-implementation",children:"Passkeys (WebAuthn) Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"how-passkeys-work",children:"How Passkeys Work"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'Registration Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Browser \u2502\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Server  \u2502\n\u2502          \u2502      \u2502 WebAuthn \u2502      \u2502          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                  \u2502                  \u2502\n     \u2502  1. User clicks  \u2502                  \u2502\n     \u2502     "Register"   \u2502                  \u2502\n     \u2502                  \u2502  2. Server sends \u2502\n     \u2502                  \u2502\u25c0\u2500 challenge +    \u2502\n     \u2502                  \u2502   user info      \u2502\n     \u2502  3. Device shows \u2502                  \u2502\n     \u2502\u25c0\u2500 biometric      \u2502                  \u2502\n     \u2502                  \u2502                  \u2502\n     \u2502  4. User         \u2502                  \u2502\n     \u2502\u2500\u25b6 authenticates  \u2502                  \u2502\n     \u2502                  \u2502  5. Send public  \u2502\n     \u2502                  \u2502\u2500\u25b6 key + signed   \u2502\n     \u2502                  \u2502   challenge      \u2502\n     \u2502                  \u2502                  \u2502\n     \u2502                  \u2502  6. Server stores\u2502\n     \u2502                  \u2502\u25c0\u2500 public key     \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nKey Points:\n- Private key NEVER leaves device\n- Server only stores public key\n- Biometric data stays local\n- Credential bound to domain (anti-phishing)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"library-recommendations",children:"Library Recommendations"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Frontend:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "@simplewebauthn/browser": "^10.0.0",\n  "next-passkey-webauthn": "^2.0.0"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Backend:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "@simplewebauthn/server": "^10.0.0"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"nextjs-passkey-implementation",children:"Next.js Passkey Implementation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Database Schema (Supabase):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Store passkey credentials\nCREATE TABLE passkey_credentials (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,\n  credential_id text UNIQUE NOT NULL,\n  public_key bytea NOT NULL,\n  counter integer DEFAULT 0,\n  transports text[], -- e.g., ['internal', 'hybrid']\n  device_type text, -- 'platform' or 'cross-platform'\n  backed_up boolean DEFAULT false,\n  created_at timestamptz DEFAULT now(),\n  last_used_at timestamptz\n);\n\nCREATE INDEX idx_passkey_user_id ON passkey_credentials(user_id);\nCREATE INDEX idx_passkey_credential_id ON passkey_credentials(credential_id);\n\n-- RLS policies\nALTER TABLE passkey_credentials ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read own credentials\" ON passkey_credentials\n  FOR SELECT USING (auth.uid() = user_id);\n\nCREATE POLICY \"Users can insert own credentials\" ON passkey_credentials\n  FOR INSERT WITH CHECK (auth.uid() = user_id);\n\nCREATE POLICY \"Users can delete own credentials\" ON passkey_credentials\n  FOR DELETE USING (auth.uid() = user_id);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Registration API Route (app/api/passkeys/register/route.ts):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { generateRegistrationOptions, verifyRegistrationResponse } from '@simplewebauthn/server';\nimport { createClient } from '@/lib/supabase/server';\n\nconst RP_NAME = 'Your App Name';\nconst RP_ID = process.env.NODE_ENV === 'production'\n  ? 'yourapp.com'\n  : 'localhost';\n\nexport async function POST(request: Request) {\n  const supabase = createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    return Response.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const { step, credential } = await request.json();\n\n  if (step === 'options') {\n    // Get existing credentials to exclude\n    const { data: existingCreds } = await supabase\n      .from('passkey_credentials')\n      .select('credential_id')\n      .eq('user_id', user.id);\n\n    const options = await generateRegistrationOptions({\n      rpName: RP_NAME,\n      rpID: RP_ID,\n      userID: user.id,\n      userName: user.email!,\n      userDisplayName: user.user_metadata?.display_name || user.email!,\n      attestationType: 'none', // For privacy\n      excludeCredentials: existingCreds?.map(c => ({\n        id: Buffer.from(c.credential_id, 'base64url'),\n        type: 'public-key',\n      })) || [],\n      authenticatorSelection: {\n        residentKey: 'preferred', // Discoverable credentials\n        userVerification: 'preferred', // Biometric when available\n        authenticatorAttachment: 'platform', // Device-bound (not roaming keys)\n      },\n    });\n\n    // Store challenge in session (or use signed JWT)\n    await supabase.from('auth_challenges').upsert({\n      user_id: user.id,\n      challenge: options.challenge,\n      expires_at: new Date(Date.now() + 5 * 60 * 1000), // 5 min\n    });\n\n    return Response.json(options);\n  }\n\n  if (step === 'verify') {\n    // Get stored challenge\n    const { data: challengeData } = await supabase\n      .from('auth_challenges')\n      .select('challenge')\n      .eq('user_id', user.id)\n      .single();\n\n    const verification = await verifyRegistrationResponse({\n      response: credential,\n      expectedChallenge: challengeData!.challenge,\n      expectedOrigin: process.env.NEXT_PUBLIC_APP_URL!,\n      expectedRPID: RP_ID,\n    });\n\n    if (verification.verified && verification.registrationInfo) {\n      const { credentialID, credentialPublicKey, counter } = verification.registrationInfo;\n\n      await supabase.from('passkey_credentials').insert({\n        user_id: user.id,\n        credential_id: Buffer.from(credentialID).toString('base64url'),\n        public_key: Buffer.from(credentialPublicKey),\n        counter,\n        transports: credential.response.transports,\n        device_type: verification.registrationInfo.credentialDeviceType,\n        backed_up: verification.registrationInfo.credentialBackedUp,\n      });\n\n      return Response.json({ success: true });\n    }\n\n    return Response.json({ error: 'Verification failed' }, { status: 400 });\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Authentication API Route (app/api/passkeys/authenticate/route.ts):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { generateAuthenticationOptions, verifyAuthenticationResponse } from '@simplewebauthn/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function POST(request: Request) {\n  const supabase = createClient();\n  const { step, credential, email } = await request.json();\n\n  if (step === 'options') {\n    // For discoverable credentials, email is optional\n    let userCredentials = [];\n\n    if (email) {\n      const { data: user } = await supabase\n        .from('profiles')\n        .select('id')\n        .eq('email', email)\n        .single();\n\n      if (user) {\n        const { data: creds } = await supabase\n          .from('passkey_credentials')\n          .select('credential_id, transports')\n          .eq('user_id', user.id);\n\n        userCredentials = creds || [];\n      }\n    }\n\n    const options = await generateAuthenticationOptions({\n      rpID: RP_ID,\n      userVerification: 'preferred',\n      allowCredentials: userCredentials.length ? userCredentials.map(c => ({\n        id: Buffer.from(c.credential_id, 'base64url'),\n        type: 'public-key',\n        transports: c.transports,\n      })) : undefined, // Empty = discoverable credential flow\n    });\n\n    // Store challenge\n    await supabase.from('auth_challenges').upsert({\n      challenge_id: options.challenge,\n      challenge: options.challenge,\n      expires_at: new Date(Date.now() + 5 * 60 * 1000),\n    });\n\n    return Response.json(options);\n  }\n\n  if (step === 'verify') {\n    // Find credential\n    const credentialId = Buffer.from(credential.id, 'base64url').toString('base64url');\n\n    const { data: storedCred } = await supabase\n      .from('passkey_credentials')\n      .select('*, profiles!inner(email)')\n      .eq('credential_id', credentialId)\n      .single();\n\n    if (!storedCred) {\n      return Response.json({ error: 'Credential not found' }, { status: 401 });\n    }\n\n    // Get challenge\n    const { data: challengeData } = await supabase\n      .from('auth_challenges')\n      .select('challenge')\n      .eq('challenge_id', credential.response.clientDataJSON.challenge)\n      .single();\n\n    const verification = await verifyAuthenticationResponse({\n      response: credential,\n      expectedChallenge: challengeData!.challenge,\n      expectedOrigin: process.env.NEXT_PUBLIC_APP_URL!,\n      expectedRPID: RP_ID,\n      authenticator: {\n        credentialID: Buffer.from(storedCred.credential_id, 'base64url'),\n        credentialPublicKey: storedCred.public_key,\n        counter: storedCred.counter,\n      },\n    });\n\n    if (verification.verified) {\n      // Update counter\n      await supabase\n        .from('passkey_credentials')\n        .update({\n          counter: verification.authenticationInfo.newCounter,\n          last_used_at: new Date(),\n        })\n        .eq('id', storedCred.id);\n\n      // Create Supabase session\n      const { data: session } = await supabase.auth.admin.generateLink({\n        type: 'magiclink',\n        email: storedCred.profiles.email,\n      });\n\n      return Response.json({\n        success: true,\n        session: session.properties?.hashed_token\n      });\n    }\n\n    return Response.json({ error: 'Verification failed' }, { status: 401 });\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"4. Frontend Hook (hooks/usePasskey.ts):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { startRegistration, startAuthentication } from '@simplewebauthn/browser';\nimport { useState } from 'react';\n\nexport function usePasskey() {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const registerPasskey = async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // Get options from server\n      const optionsRes = await fetch('/api/passkeys/register', {\n        method: 'POST',\n        body: JSON.stringify({ step: 'options' }),\n      });\n      const options = await optionsRes.json();\n\n      // Start WebAuthn registration\n      const credential = await startRegistration(options);\n\n      // Verify with server\n      const verifyRes = await fetch('/api/passkeys/register', {\n        method: 'POST',\n        body: JSON.stringify({ step: 'verify', credential }),\n      });\n\n      if (!verifyRes.ok) {\n        throw new Error('Verification failed');\n      }\n\n      return true;\n    } catch (err: any) {\n      // Handle user cancellation gracefully\n      if (err.name === 'NotAllowedError') {\n        setError('Passkey registration cancelled');\n      } else {\n        setError(err.message);\n      }\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const authenticateWithPasskey = async (email?: string) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const optionsRes = await fetch('/api/passkeys/authenticate', {\n        method: 'POST',\n        body: JSON.stringify({ step: 'options', email }),\n      });\n      const options = await optionsRes.json();\n\n      const credential = await startAuthentication(options);\n\n      const verifyRes = await fetch('/api/passkeys/authenticate', {\n        method: 'POST',\n        body: JSON.stringify({ step: 'verify', credential }),\n      });\n\n      if (!verifyRes.ok) {\n        throw new Error('Authentication failed');\n      }\n\n      const { session } = await verifyRes.json();\n      // Exchange for Supabase session\n      // ...\n      return true;\n    } catch (err: any) {\n      if (err.name === 'NotAllowedError') {\n        setError('Passkey authentication cancelled');\n      } else {\n        setError(err.message);\n      }\n      return false;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const isSupported = typeof window !== 'undefined' &&\n    window.PublicKeyCredential !== undefined;\n\n  return {\n    registerPasskey,\n    authenticateWithPasskey,\n    isSupported,\n    isLoading,\n    error,\n  };\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"oauth-google-sign-in",children:"OAuth: Google Sign-In"}),"\n",(0,t.jsx)(n.h3,{id:"setup-requirements",children:"Setup Requirements"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Google Cloud Console:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create OAuth 2.0 Client ID (Web application)"}),"\n",(0,t.jsxs)(n.li,{children:["Add authorized JavaScript origins: ",(0,t.jsx)(n.code,{children:"https://yourapp.com"})]}),"\n",(0,t.jsxs)(n.li,{children:["Add authorized redirect URIs: ",(0,t.jsx)(n.code,{children:"https://yourapp.supabase.co/auth/v1/callback"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Supabase Dashboard:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication \u2192 Providers \u2192 Google"}),"\n",(0,t.jsx)(n.li,{children:"Add Client ID and Client Secret"}),"\n",(0,t.jsx)(n.li,{children:'Enable "Sign in with Google"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Supabase Client (Next.js):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { createClient } from '@/lib/supabase/client';\n\nasync function signInWithGoogle() {\n  const supabase = createClient();\n\n  const { error } = await supabase.auth.signInWithOAuth({\n    provider: 'google',\n    options: {\n      redirectTo: `${window.location.origin}/auth/callback`,\n      queryParams: {\n        access_type: 'offline', // For refresh tokens\n        prompt: 'consent', // Force consent screen\n      },\n    },\n  });\n\n  if (error) {\n    console.error('Google sign-in error:', error);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Native Mobile (React Native/Expo):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import * as Google from 'expo-auth-session/providers/google';\nimport { createClient } from '@supabase/supabase-js';\n\nexport function useGoogleAuth() {\n  const [request, response, promptAsync] = Google.useIdTokenAuthRequest({\n    clientId: process.env.EXPO_PUBLIC_GOOGLE_CLIENT_ID,\n    iosClientId: process.env.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,\n    androidClientId: process.env.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID,\n  });\n\n  useEffect(() => {\n    if (response?.type === 'success') {\n      const { id_token } = response.params;\n\n      supabase.auth.signInWithIdToken({\n        provider: 'google',\n        token: id_token,\n      });\n    }\n  }, [response]);\n\n  return { signIn: () => promptAsync(), isLoading: !request };\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"oauth-apple-sign-in",children:"OAuth: Apple Sign-In"}),"\n",(0,t.jsx)(n.h3,{id:"app-store-requirements-2024",children:"App Store Requirements (2024+)"}),"\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"Critical Compliance Rule:"})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Apps that use third-party login (Google, Facebook, etc.) must also offer an ",(0,t.jsx)(n.strong,{children:"equivalent privacy-focused option"}),". Sign in with Apple satisfies this requirement."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Required if you offer:"})," Google, Facebook, Twitter, Amazon, WeChat login\n",(0,t.jsx)(n.strong,{children:"Exception:"})," Enterprise/education apps with existing SSO"]}),"\n",(0,t.jsx)(n.h3,{id:"setup-requirements-1",children:"Setup Requirements"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Apple Developer Portal:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Enable "Sign in with Apple" capability'}),"\n",(0,t.jsx)(n.li,{children:"Create Service ID for web"}),"\n",(0,t.jsx)(n.li,{children:"Create Key (.p8 file) for token generation"}),"\n",(0,t.jsxs)(n.li,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"Key expires every 6 months"})," - set calendar reminder!"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Supabase Dashboard:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication \u2192 Providers \u2192 Apple"}),"\n",(0,t.jsx)(n.li,{children:"Add Service ID, Team ID, Key ID"}),"\n",(0,t.jsx)(n.li,{children:"Upload .p8 key file"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"implementation-1",children:"Implementation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Web (Supabase):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"async function signInWithApple() {\n  const supabase = createClient();\n\n  const { error } = await supabase.auth.signInWithOAuth({\n    provider: 'apple',\n    options: {\n      redirectTo: `${window.location.origin}/auth/callback`,\n    },\n  });\n\n  if (error) {\n    console.error('Apple sign-in error:', error);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Native iOS (Swift):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-swift",children:"import AuthenticationServices\n\nfunc handleAppleSignIn() async throws {\n    let appleIDProvider = ASAuthorizationAppleIDProvider()\n    let request = appleIDProvider.createRequest()\n    request.requestedScopes = [.fullName, .email]\n\n    let result = try await performSignIn(request)\n\n    // Extract ID token\n    guard let identityToken = result.credential.identityToken,\n          let tokenString = String(data: identityToken, encoding: .utf8) else {\n        throw AuthError.missingToken\n    }\n\n    // Sign in to Supabase\n    try await supabase.auth.signInWithIdToken(\n        credentials: .init(\n            provider: .apple,\n            idToken: tokenString\n        )\n    )\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"magic-links-email-passwordless",children:"Magic Links (Email Passwordless)"}),"\n",(0,t.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good: Short TTL, single-use\nconst { error } = await supabase.auth.signInWithOtp({\n  email: user.email,\n  options: {\n    emailRedirectTo: `${origin}/auth/callback`,\n    shouldCreateUser: true, // Auto-create on first login\n  },\n});\n\n// Configure in Supabase Dashboard:\n// - Magic Link expiry: 5-10 minutes (shorter is safer)\n// - Rate limit: 3 per hour per email\n"})}),"\n",(0,t.jsx)(n.h3,{id:"email-template-customization",children:"Email Template Customization"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'\x3c!-- Supabase Dashboard \u2192 Auth \u2192 Email Templates \u2192 Magic Link --\x3e\n<h2>Sign in to {{ .SiteURL }}</h2>\n<p>Click the link below to sign in. This link expires in 10 minutes.</p>\n<p><a href="{{ .ConfirmationURL }}">Sign in to Your Account</a></p>\n<p>If you didn\'t request this, you can safely ignore this email.</p>\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"recovery-flows",children:"Recovery Flows"}),"\n",(0,t.jsx)(n.h3,{id:"email-recovery-password-reset",children:"Email Recovery (Password Reset)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Request reset\nawait supabase.auth.resetPasswordForEmail(email, {\n  redirectTo: `${origin}/auth/update-password`,\n});\n\n// Update password (on /auth/update-password page)\nawait supabase.auth.updateUser({ password: newPassword });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"account-recovery-hierarchy",children:"Account Recovery Hierarchy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Recovery Options (in order of security):\n1. Backup Passkey (stored on different device)\n2. Trusted Recovery Contact (delegated access)\n3. Email verification + Security questions\n4. Email-only recovery (last resort)\n5. SMS recovery \u26a0\ufe0f (vulnerable to SIM swap)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"implementing-backup-passkeys",children:"Implementing Backup Passkeys"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Prompt user to register backup device after primary\nfunction PromptBackupPasskey() {\n  const [hasBackup, setHasBackup] = useState(false);\n  const { data: credentials } = usePasskeyCredentials();\n\n  useEffect(() => {\n    // Check if user has only one passkey\n    if (credentials?.length === 1) {\n      setHasBackup(false);\n    }\n  }, [credentials]);\n\n  if (hasBackup) return null;\n\n  return (\n    <div className="bg-amber-50 border border-amber-200 p-4 rounded-lg">\n      <h3>Add a Backup Passkey</h3>\n      <p>Register a passkey on another device to ensure account recovery.</p>\n      <Button onClick={registerPasskey}>Add Backup Device</Button>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"cross-device-sync",children:"Cross-Device Sync"}),"\n",(0,t.jsx)(n.h3,{id:"how-passkey-sync-works",children:"How Passkey Sync Works"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Device A (iPhone)              iCloud Keychain              Device B (Mac)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Create Passkey  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 E2E Encrypt \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Passkey Ready   \u2502\n\u2502 for example.com \u2502           \u2502 & Sync      \u2502           \u2502 to use          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nGoogle Password Manager:\n- Android devices synced\n- Chrome browser synced\n- Windows via Chrome\n\nApple iCloud Keychain:\n- All Apple devices synced\n- Safari on all platforms\n- Shared with Family Sharing (optional)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cross-platform-authentication-qr-code",children:"Cross-Platform Authentication (QR Code)"}),"\n",(0,t.jsx)(n.p,{children:"When user wants to sign in on a device without their passkey:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Device A shows QR code\n// User scans with phone (Device B) that has passkey\n// Phone authenticates via Bluetooth proximity\n\n// This is handled automatically by the browser's WebAuthn implementation\n// No additional code needed - just allow hybrid transports:\n\nconst options = await generateAuthenticationOptions({\n  rpID: RP_ID,\n  authenticatorSelection: {\n    // Allow cross-device (QR code) authentication\n    authenticatorAttachment: undefined, // Don't restrict\n  },\n});\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"supabase-auth-configuration-checklist",children:"Supabase Auth Configuration Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"dashboard-settings",children:"Dashboard Settings"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Authentication \u2192 Settings:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Site URL: ",(0,t.jsx)(n.code,{children:"https://yourapp.com"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Redirect URLs: Add all valid callbacks"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","JWT Expiry: 3600 (1 hour)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable email confirmations: Yes"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Authentication \u2192 Providers \u2192 Email:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable Email: Yes"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Confirm email: Yes (recommended)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Secure email change: Yes"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Double confirm email: No (reduces friction)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Authentication \u2192 Email Templates:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Customize all templates"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test email delivery"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set appropriate expiry times"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Authentication \u2192 Rate Limiting:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Email: 3 per hour"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","SMS: 3 per hour"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Magic links: 3 per 5 minutes"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-env",children:'# Required\nNEXT_PUBLIC_SUPABASE_URL=https://yourproject.supabase.co\nNEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key\nSUPABASE_SERVICE_ROLE_KEY=your-service-key\n\n# Google OAuth\nGOOGLE_CLIENT_ID=your-client-id\nGOOGLE_CLIENT_SECRET=your-client-secret\n\n# Apple OAuth\nAPPLE_SERVICE_ID=your-service-id\nAPPLE_TEAM_ID=your-team-id\nAPPLE_KEY_ID=your-key-id\nAPPLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\\n..."\n\n# Passkeys\nPASSKEY_RP_ID=yourapp.com\nPASSKEY_RP_NAME="Your App Name"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"common-issues--solutions",children:"Common Issues & Solutions"}),"\n",(0,t.jsx)(n.h3,{id:"issue-sign-up-says-check-email-but-no-email-arrives",children:'Issue: Sign-up says "Check email" but no email arrives'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause:"})," Email confirmation not configured in Supabase Dashboard"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Go to Supabase Dashboard \u2192 Authentication \u2192 Providers \u2192 Email"}),"\n",(0,t.jsx)(n.li,{children:'Verify "Confirm email" is enabled'}),"\n",(0,t.jsx)(n.li,{children:"Check email templates are configured"}),"\n",(0,t.jsx)(n.li,{children:"Verify SMTP settings (or use Supabase's built-in email)"}),"\n",(0,t.jsx)(n.li,{children:"Check spam folder"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"issue-apple-sign-in-suddenly-stops-working",children:"Issue: Apple Sign-In suddenly stops working"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause:"})," Apple .p8 key expired (6-month limit)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Generate new key in Apple Developer Portal"}),"\n",(0,t.jsx)(n.li,{children:"Update key in Supabase Dashboard"}),"\n",(0,t.jsx)(n.li,{children:"Set calendar reminder for next expiry"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"issue-google-oauth-redirect-error",children:"Issue: Google OAuth redirect error"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause:"})," Redirect URI mismatch"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Verify redirect URI in Google Cloud Console matches exactly:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"https://yourproject.supabase.co/auth/v1/callback"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Check for trailing slashes"}),"\n",(0,t.jsx)(n.li,{children:"Ensure HTTP vs HTTPS matches"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"issue-passkey-not-syncing-between-devices",children:"Issue: Passkey not syncing between devices"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause:"})," Credential created with wrong attachment type"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Use 'platform' for synced credentials\nauthenticatorAttachment: 'platform', // NOT 'cross-platform'\n\n// 'cross-platform' = hardware security keys (no sync)\n// 'platform' = device biometrics (sync via iCloud/Google)\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"token-management",children:"Token Management"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good: Short-lived access tokens + refresh\nconst session = await supabase.auth.getSession();\n// Access token: 1 hour\n// Refresh token: 7 days (rotate on use)\n\n// \u2705 Good: Secure token storage\n// Browser: HttpOnly cookies (Supabase handles this)\n// Mobile: Secure Keychain/Keystore\n\n// \u274c Bad: Long-lived tokens in localStorage\nlocalStorage.setItem('token', longLivedToken); // DON'T\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Implement rate limiting on auth endpoints\nconst rateLimit = {\n  signIn: { max: 5, windowMs: 15 * 60 * 1000 }, // 5 per 15 min\n  signUp: { max: 3, windowMs: 60 * 60 * 1000 }, // 3 per hour\n  passwordReset: { max: 3, windowMs: 60 * 60 * 1000 },\n  passkey: { max: 10, windowMs: 15 * 60 * 1000 },\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"secure-defaults",children:"Secure Defaults"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Always verify email on signup\nconst { error } = await supabase.auth.signUp({\n  email,\n  password,\n  options: {\n    emailRedirectTo: `${origin}/auth/callback`,\n    // Supabase will only create confirmed user after email click\n  },\n});\n\n// Require email verification for sensitive actions\nasync function sensitiveAction(userId: string) {\n  const { data: user } = await supabase.auth.getUser();\n\n  if (!user?.email_confirmed_at) {\n    throw new Error('Please verify your email first');\n  }\n\n  // Proceed with action...\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(n.h3,{id:"official-documentation",children:"Official Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developers.google.com/identity/passkeys/developer-guides",children:"Google Passkeys Developer Guide"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.apple.com/sign-in-with-apple/",children:"Apple Sign in with Apple"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://supabase.com/docs/guides/auth",children:"Supabase Auth Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.w3.org/TR/webauthn-2/",children:"WebAuthn Spec"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"libraries",children:"Libraries"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://simplewebauthn.dev/",children:"SimpleWebAuthn"})," - Recommended WebAuthn library"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://www.corbado.com/blog/supabase-passkeys",children:"Corbado"})," - Passkey-as-a-service option"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://www.hanko.io/",children:"Hanko"})," - Open-source passkey server"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"research-2026",children:"Research (2026)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.c-sharpcorner.com/article/authentication-trends-in-2026-passkeys-oauth3-and-webauthn/",children:"Authentication Trends in 2026"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://securityboulevard.com/2025/12/passwordless-mfa-in-2026-passkeys-push-mfa-device-trust/",children:"Passwordless & MFA in 2026"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://fidoalliance.org/",children:"FIDO Alliance Passkey Index"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(96540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);