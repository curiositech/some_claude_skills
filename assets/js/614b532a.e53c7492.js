"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[29081],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var a=t(96540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}},62493:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"skills/pwa_expert/references/update-flow","title":"PWA Update Flow","description":"usePWAUpdate Hook","source":"@site/docs/skills/pwa_expert/references/update-flow.md","sourceDirName":"skills/pwa_expert/references","slug":"/skills/pwa_expert/references/update-flow","permalink":"/docs/skills/pwa_expert/references/update-flow","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"PWA Update Flow","sidebar_label":"PWA Update Flow","sidebar_position":6}}');var s=t(74848),r=t(28453);const i={title:"PWA Update Flow",sidebar_label:"PWA Update Flow",sidebar_position:6},l="PWA Update Flow",d={},o=[{value:"usePWAUpdate Hook",id:"usepwaupdate-hook",level:2},{value:"Update Banner Component",id:"update-banner-component",level:2},{value:"Service Worker Message Handler",id:"service-worker-message-handler",level:2},{value:"Check for Updates Manually",id:"check-for-updates-manually",level:2},{value:"Update Strategies",id:"update-strategies",level:2},{value:"1. Immediate Update (Aggressive)",id:"1-immediate-update-aggressive",level:3},{value:"2. User-Prompted Update (Recommended)",id:"2-user-prompted-update-recommended",level:3},{value:"3. Background Update",id:"3-background-update",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"pwa-update-flow",children:"PWA Update Flow"})}),"\n",(0,s.jsx)(n.h2,{id:"usepwaupdate-hook",children:"usePWAUpdate Hook"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// hooks/usePWAUpdate.ts\n'use client';\n\nimport { useState, useEffect } from 'react';\n\nexport function usePWAUpdate() {\n  const [updateAvailable, setUpdateAvailable] = useState(false);\n  const [registration, setRegistration] = useState<ServiceWorkerRegistration | null>(null);\n\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.ready.then((reg) => {\n        setRegistration(reg);\n\n        reg.addEventListener('updatefound', () => {\n          const newWorker = reg.installing;\n          newWorker?.addEventListener('statechange', () => {\n            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n              setUpdateAvailable(true);\n            }\n          });\n        });\n      });\n    }\n  }, []);\n\n  const applyUpdate = () => {\n    if (registration?.waiting) {\n      registration.waiting.postMessage({ type: 'SKIP_WAITING' });\n      window.location.reload();\n    }\n  };\n\n  return { updateAvailable, applyUpdate };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-banner-component",children:"Update Banner Component"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// components/UpdateBanner.tsx\n\'use client\';\n\nimport { usePWAUpdate } from \'@/hooks/usePWAUpdate\';\n\nexport function UpdateBanner() {\n  const { updateAvailable, applyUpdate } = usePWAUpdate();\n\n  if (!updateAvailable) return null;\n\n  return (\n    <div className="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80\n                    bg-ember-600 text-white rounded-lg p-4 shadow-lg z-50">\n      <p className="font-medium mb-2">Update Available</p>\n      <p className="text-sm opacity-90 mb-3">\n        A new version is ready. Reload to get the latest features.\n      </p>\n      <button\n        onClick={applyUpdate}\n        className="w-full py-2 bg-white text-ember-600 rounded font-medium\n                   hover:bg-gray-100 transition-colors"\n      >\n        Reload Now\n      </button>\n    </div>\n  );\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"service-worker-message-handler",children:"Service Worker Message Handler"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// In sw.js\nself.addEventListener('message', (event) => {\n  if (event.data?.type === 'SKIP_WAITING') {\n    self.skipWaiting();\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"check-for-updates-manually",children:"Check for Updates Manually"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Force check for updates\nasync function checkForUpdates() {\n  if ('serviceWorker' in navigator) {\n    const registration = await navigator.serviceWorker.ready;\n    await registration.update();\n  }\n}\n\n// Call periodically or on user action\nuseEffect(() => {\n  const interval = setInterval(checkForUpdates, 60 * 60 * 1000); // Every hour\n  return () => clearInterval(interval);\n}, []);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-strategies",children:"Update Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"1-immediate-update-aggressive",children:"1. Immediate Update (Aggressive)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// In sw.js - takes control immediately\nself.addEventListener('install', (event) => {\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  self.clients.claim();\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-user-prompted-update-recommended",children:"2. User-Prompted Update (Recommended)"}),"\n",(0,s.jsx)(n.p,{children:'Wait for user to click "Update" before reloading. Less disruptive.'}),"\n",(0,s.jsx)(n.h3,{id:"3-background-update",children:"3. Background Update"}),"\n",(0,s.jsx)(n.p,{children:"Update on next visit. User gets new version automatically."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Only skipWaiting when no active clients\nself.addEventListener('install', async (event) => {\n  const clients = await self.clients.matchAll();\n  if (clients.length === 0) {\n    self.skipWaiting();\n  }\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);